<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BtrustOn</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
  />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Oswald:wght@500;700&display=swap"
    rel="stylesheet"
  />

  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            BTrustOn: {
              primary: "#0F172A",
              accent: "#06b6d4",
              darkAccent: "#0891b2",
              surface: "#F8FAFC",
              border: "#E2E8F0",
              text: "#334155",
            },
          },
          fontFamily: {
            sans: ["Inter", "sans-serif"],
            header: ["Oswald", "sans-serif"],
          },
          boxShadow: {
            glass: "0 8px 32px 0 rgba(31, 38, 135, 0.07)",
            float: "0 20px 40px -5px rgba(6, 182, 212, 0.15)",
            glow: "0 0 15px rgba(6, 182, 212, 0.4)",
          },
        },
      },
    };
  </script>
  <style>
    .hidden-view {
      display: none !important;
    }
    .fade-in {
      animation: fadeIn 0.5s cubic-bezier(0.16, 1, 0.3, 1);
    }
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    .no-scrollbar::-webkit-scrollbar {
      display: none;
    }
    .no-scrollbar {
      -ms-overflow-style: none;
      scrollbar-width: none;
    }
    .modal {
      transition: opacity 0.25s ease;
    }
    body.modal-active {
      overflow-x: hidden;
      overflow-y: visible !important;
    }
    .dot-map-bg {
      background-image: radial-gradient(#94a3b8 1px, transparent 1px);
      background-size: 30px 30px;
    }
    /* EditÃ¶r input stilleri */
    .input-field:focus {
        box-shadow: 0 0 0 4px rgba(6, 182, 212, 0.1);
        border-color: #06b6d4;
    }
/* Ã–zel Scrollbar TasarÄ±mÄ± */
    .custom-scrollbar::-webkit-scrollbar {
      width: 6px;
      height: 6px;
    }
    .custom-scrollbar::-webkit-scrollbar-track {
      background: #f1f5f9;
    }
    .custom-scrollbar::-webkit-scrollbar-thumb {
      background-color: #cbd5e1;
      border-radius: 10px;
    }
    .custom-scrollbar::-webkit-scrollbar-thumb:hover {
      background-color: #94a3b8;
    }
/* TOAST NOTIFICATION STYLES */
    #toast-container {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 9999;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    
    .toast {
      min-width: 300px;
      background: white;
      border-left: 4px solid;
      padding: 16px;
      border-radius: 8px;
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      display: flex;
      align-items: center;
      gap: 12px;
      animation: slideIn 0.3s ease-out forwards;
      opacity: 0;
      transform: translateX(100%);
    }

    .toast.success { border-color: #10b981; } /* YeÅŸil */
    .toast.error { border-color: #ef4444; }   /* KÄ±rmÄ±zÄ± */

    .toast i { font-size: 18px; }
    .toast.success i { color: #10b981; }
    .toast.error i { color: #ef4444; }

    .toast-content { flex: 1; }
    .toast-title { font-weight: bold; font-size: 14px; color: #1f2937; display: block; margin-bottom: 2px;}
    .toast-msg { font-size: 12px; color: #6b7280; }

    @keyframes slideIn {
      to { opacity: 1; transform: translateX(0); }
    }
    
    @keyframes fadeOut {
      to { opacity: 0; transform: translateX(10px); }
    }
/* ... BurasÄ± eski CSS kodlarÄ±nÄ±zÄ±n bittiÄŸi yer ... */

    /* ðŸ‘‡ðŸ‘‡ðŸ‘‡ BURAYA YAPIÅžTIRIN ðŸ‘‡ðŸ‘‡ðŸ‘‡ */

    /* --- SIGNATURE INBOX STYLES --- */
    #inbox-panel {
      position: fixed;
      top: 0;
      right: 0;
      width: 400px;
      height: 100vh;
      background: rgba(255, 255, 255, 0.85);
      backdrop-filter: blur(12px); /* Buzlu cam efekti */
      border-left: 1px solid rgba(255, 255, 255, 0.6);
      box-shadow: -10px 0 30px rgba(15, 23, 42, 0.15);
      z-index: 9999;
      transform: translateX(100%); /* BaÅŸlangÄ±Ã§ta gizli */
      transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
    }
    
    #inbox-panel.open {
      transform: translateX(0); /* AÃ§Ä±lÄ±nca gelir */
    }

    .inbox-item {
      position: relative;
      transition: all 0.2s ease;
      border-left: 3px solid transparent;
    }

    .inbox-item:hover {
      background: rgba(6, 182, 212, 0.05); /* Hoverda hafif turkuaz */
    }

    .inbox-item.unread {
      background: white;
      border-left-color: #06b6d4; /* OkunmamÄ±ÅŸsa sol taraf turkuaz */
    }
    
    .inbox-item.unread::after {
      content: '';
      position: absolute;
      top: 15px;
      right: 15px;
      width: 8px;
      height: 8px;
      background: #ef4444; /* KÄ±rmÄ±zÄ± nokta */
      border-radius: 50%;
      box-shadow: 0 0 8px rgba(239, 68, 68, 0.6);
      animation: pulse-red 2s infinite;
    }

    @keyframes pulse-red {
      0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
      70% { transform: scale(1); box-shadow: 0 0 0 6px rgba(239, 68, 68, 0); }
      100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
    }

    /* ðŸ‘†ðŸ‘†ðŸ‘† BURADA BÄ°TÄ°YOR ðŸ‘†ðŸ‘†ðŸ‘† */

  </style> ```
  </style>

  <!-- Supabase Auth client -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const SUPABASE_URL = "https://ncssozhpwzvzeneaumlz.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5jc3Nvemhwd3p2emVuZWF1bWx6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ4MzkyMjgsImV4cCI6MjA4MDQxNTIyOH0.pk9p8_KRcmcbzhulo4dA06uk_3FOFXwVT1vNiYOEfck";

    const supabaseClient = window.supabase.createClient(
    SUPABASE_URL,
    SUPABASE_ANON_KEY
  );
</script>
</head>

</head>
<body class="bg-gray-50 text-BTrustOn-text font-sans antialiased relative">
<div id="toast-container"></div>
  <div
    class="fixed inset-0 z-[-1] dot-map-bg opacity-[0.4] pointer-events-none"
  ></div>
  <div
    class="fixed inset-0 z-[-2] bg-gradient-to-tr from-blue-50 via-white to-cyan-50/30"
  ></div>

  <nav
    class="sticky top-0 z-40 bg-white/70 backdrop-blur-md border-b border-white/50 h-24 transition-all">
    <div
      class="max-w-7xl mx-auto px-4 h-full flex justify-between items-center"
    >
    <div 
  onclick="showMainView()" 
  class="cursor-pointer select-none flex items-center h-full pr-4 gap-0.5"
>
    <span class="text-4xl font-sans font-bold text-[#0A2A43] tracking-tight leading-none">
        BTrust
    </span>

    <span class="text-4xl font-sans font-bold text-transparent bg-clip-text bg-gradient-to-r from-[#00C6FF] to-[#0078FF] leading-none drop-shadow-sm">
        On
    </span>
</div>

    <div class="flex items-center gap-3 text-sm font-medium">

  <button
    id="back-btn"
    onclick="showMainView()"
    class="hidden hidden-view items-center gap-2 text-gray-500 hover:text-BTrustOn-primary transition px-3 py-2 rounded-lg hover:bg-gray-100"
  >
    <i class="fa-solid fa-arrow-left"></i>
    <span class="hidden md:inline" data-i18n="back">BACK</span>
  </button>

  <div id="guest-actions" class="flex items-center gap-3">
    <button
      id="btn-partner-login"
      onclick="openLoginModal()"
      class="text-gray-600 hover:text-BTrustOn-primary px-3 py-2 transition font-semibold"
    >
      <i class="fa-solid fa-lock mr-2 text-xs text-gray-400"></i>
      Partner Login
    </button>

    <button
      id="btn-join-network"
      onclick="toggleModal('modal-join')"
      class="bg-BTrustOn-primary text-white px-5 py-2.5 rounded-full font-bold hover:bg-BTrustOn-accent transition text-xs shadow-lg shadow-blue-900/20 tracking-wide flex items-center gap-2"
    >
      <i class="fa-solid fa-paper-plane"></i>
      <span data-i18n="join">JOIN NETWORK</span>
    </button>
  </div>

  <div id="user-actions" class="hidden flex items-center gap-3 border-l border-gray-200 pl-4 ml-1">
    
    <button
      onclick="toggleInbox()"
      class="relative w-10 h-10 rounded-full bg-white border border-gray-100 text-gray-400 hover:text-BTrustOn-accent hover:border-BTrustOn-accent hover:shadow-[0_0_15px_rgba(6,182,212,0.3)] transition-all duration-300 flex items-center justify-center mr-2 group"
    >
      <i class="fa-solid fa-bell text-lg group-hover:animate-swing"></i>
      
      <span id="nav-badge" class="hidden absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-[10px] font-bold flex items-center justify-center rounded-full border-2 border-white shadow-sm animate-bounce">
        0
      </span>
    </button>

    <button
      id="btn-my-company"
      onclick="openMyCompanyIfExists()"
      class="flex items-center gap-2 px-4 py-2 bg-cyan-50 text-BTrustOn-accent border border-cyan-200 rounded-lg text-xs font-bold hover:bg-cyan-100 hover:border-cyan-300 transition shadow-sm"
    >
      <i class="fa-solid fa-building-user"></i>
      MY COMPANY
    </button>

    <button
      id="btn-partner-logout"
      onclick="partnerLogout()"
      class="text-gray-400 hover:text-red-500 transition px-2 py-2"
      title="Logout"
    >
      <i class="fa-solid fa-right-from-bracket text-lg"></i>
    </button>
  </div>

</div>
    </div>
  </nav>

  <div id="view-dashboard" class="fade-in">
    <header class="pt-4 pb-4 px-4 text-center relative overflow-hidden z-10">
      
      <h1
        id="hero-title"
        class="text-4xl md:text-6xl font-header font-bold text-BTrustOn-primary mb-3 leading-tight tracking-tight drop-shadow-sm py-1"
      ></h1>
      
      <p
        id="hero-desc"
        class="text-base md:text-lg text-gray-500 mb-6 max-w-2xl mx-auto font-light leading-relaxed"
      ></p>

      <div class="w-[95%] md:max-w-3xl mx-auto relative mb-6 z-20 transition-all duration-300">
        
        <div class="absolute inset-0 bg-BTrustOn-accent/20 blur-2xl rounded-full opacity-0 hover:opacity-100 transition-opacity duration-500"></div>

        <div
          class="relative bg-white/90 backdrop-blur-xl p-1.5 md:p-2 rounded-full shadow-2xl flex items-center border border-white/80 ring-4 ring-transparent focus-within:ring-cyan-50/50 focus-within:scale-[1.02] transition-all duration-300"
        >
          <div class="pl-4 pr-3 text-BTrustOn-accent shrink-0">
            <i class="fa-solid fa-magnifying-glass text-lg md:text-xl animate-pulse"></i>
          </div>
          
          <input
            type="text"
            id="search-input"
            onkeyup="handleSearchInput(this.value)" 
            onkeydown="if(event.key === 'Enter') { handleSearchInput(this.value); document.querySelector('main').scrollIntoView({ behavior: 'smooth' }); }"
            class="w-full bg-transparent outline-none text-gray-700 text-base md:text-lg placeholder-gray-400 font-light h-10 md:h-12"
            placeholder=""
          />
          
          <button
            onclick="document.querySelector('main').scrollIntoView({ behavior: 'smooth' });"
            class="shrink-0 bg-BTrustOn-accent hover:bg-BTrustOn-darkAccent text-white rounded-full w-10 h-10 md:w-auto md:h-12 md:px-6 font-bold transition shadow-lg shadow-cyan-500/30 flex items-center justify-center gap-2 group"
          >
            <span class="hidden md:inline" data-i18n="btn_discover">DISCOVER</span>
            <i class="fa-solid fa-compass text-lg group-hover:rotate-45 transition-transform duration-300"></i>
          </button>
        </div>
      </div>
      
      </header>

    <main class="max-w-7xl mx-auto px-6 md:px-12 py-6 pb-24">
      
      <div class="flex flex-col gap-4 mb-5 border-b border-gray-200/50 pb-4">
        
        <div class="bg-white/70 border border-white/60 rounded-2xl shadow-glass px-4 py-4">
          <div class="flex justify-between items-center mb-3">
            <h3 class="text-xs font-bold text-gray-600 uppercase tracking-wider flex items-center gap-2">
              <i class="fa-solid fa-star text-amber-400"></i>
              <span data-i18n="top_title">Top Verified Companies by Trust Score</span>
            </h3>
            <span class="text-[11px] text-gray-400" data-i18n="top_sub">Updated in real-time</span>
          </div>
          <div id="top-companies" class="flex gap-4 overflow-x-auto no-scrollbar pb-1"></div>
        </div>
<div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mt-4">
            
            <div>
              <span id="result-count" class="text-2xl font-bold text-BTrustOn-primary tracking-tight">Loading...</span>
            </div>

            <div class="flex flex-wrap gap-3">
                
                <div class="relative group">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <i class="fa-solid fa-layer-group text-gray-400 text-xs"></i>
                    </div>
                    <select 
                        id="sector-filter" 
                        onchange="filterSector(this.value)"
                        class="appearance-none bg-white border border-gray-200 text-gray-700 text-xs font-bold py-2.5 pl-9 pr-8 rounded-lg shadow-sm hover:border-BTrustOn-accent focus:outline-none focus:ring-1 focus:ring-BTrustOn-accent cursor-pointer transition min-w-[140px]"
                    >
                        <option value="all">All Sectors</option>
                        <option value="construction">Construction</option>
                        <option value="energy">Energy</option>
                        <option value="mining">Mining</option>
                        <option value="manufacturing">Manufacturing</option>
                        <option value="technology">Technology</option>
                        <option value="logistics">Logistics</option>
                    </select>
                    <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                        <i class="fa-solid fa-chevron-down text-gray-400 text-[10px]"></i>
                    </div>
                </div>

                <div class="relative group">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <i class="fa-solid fa-earth-americas text-gray-400 text-xs"></i>
                    </div>
                    <select 
                        id="country-filter" 
                        onchange="handleCountryChange(this.value)"
                        class="appearance-none bg-white border border-gray-200 text-gray-700 text-xs font-bold py-2.5 pl-9 pr-8 rounded-lg shadow-sm hover:border-BTrustOn-accent focus:outline-none focus:ring-1 focus:ring-BTrustOn-accent cursor-pointer transition min-w-[140px]"
                    >
                        <option value="all">All Countries</option>
                    </select>
                    <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                        <i class="fa-solid fa-chevron-down text-gray-400 text-[10px]"></i>
                    </div>
                </div>

                <div class="relative group">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <i class="fa-solid fa-arrow-down-short-wide text-gray-400 text-xs"></i>
                    </div>
                    <select 
                        id="sort-select" 
                        onchange="handleSortChange(this.value)"
                        class="appearance-none bg-white border border-gray-200 text-gray-700 text-xs font-bold py-2.5 pl-9 pr-8 rounded-lg shadow-sm hover:border-BTrustOn-accent focus:outline-none focus:ring-1 focus:ring-BTrustOn-accent cursor-pointer transition"
                    >
                        <option value="score_desc">Trust Score: High to Low</option>
                        <option value="score_asc">Trust Score: Low to High</option>
                        <option value="year_oldest">Experience: Oldest First</option>
                        <option value="year_newest">Experience: Newest First</option>
                        <option value="name_asc">Name: A to Z</option>
                    </select>
                    <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                        <i class="fa-solid fa-chevron-down text-gray-400 text-[10px]"></i>
                    </div>
                </div>
            </div>
        </div>        
      <div id="card-container" class="grid md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 mb-16"></div>

      <section class="mt-4 mb-8">
        <div
          class="flex flex-col md:flex-row md:items-end md:justify-between gap-4 mb-8"
        >
          <div>
            <h2
              class="text-2xl md:text-3xl font-header font-bold text-BTrustOn-primary mb-2"
              data-i18n="how_title"
            >
              How Strabon Works
            </h2>
            <p
              class="text-sm text-gray-500 max-w-xl"
              data-i18n="how_sub"
            >
              Create your company profile, verify your references and let your
              Strabon Trust Scoreâ„¢ increase your visibility.
            </p>
          </div>
        </div>

        <div class="grid md:grid-cols-3 gap-6">
          <div class="bg-white/80 border border-gray-100 rounded-2xl p-6 shadow-glass">
            <div class="w-9 h-9 rounded-xl bg-cyan-50 flex items-center justify-center mb-4">
              <span class="text-xs font-bold text-BTrustOn-accent">01</span>
            </div>
            <h3 class="text-sm font-bold text-BTrustOn-primary mb-2" data-i18n="how_step1_title">Create your profile</h3>
            <p class="text-xs text-gray-500 leading-relaxed" data-i18n="how_step1_desc">Add your company details, sectors, core services, assets and project highlights.</p>
          </div>
          <div class="bg-white/80 border border-gray-100 rounded-2xl p-6 shadow-glass">
            <div class="w-9 h-9 rounded-xl bg-cyan-50 flex items-center justify-center mb-4">
              <span class="text-xs font-bold text-BTrustOn-accent">02</span>
            </div>
            <h3 class="text-sm font-bold text-BTrustOn-primary mb-2" data-i18n="how_step2_title">Verify references</h3>
            <p class="text-xs text-gray-500 leading-relaxed" data-i18n="how_step2_desc">Send verification requests to past clients and partners to build a verified track record.</p>
          </div>
          <div class="bg-white/80 border border-gray-100 rounded-2xl p-6 shadow-glass">
            <div class="w-9 h-9 rounded-xl bg-cyan-50 flex items-center justify-center mb-4">
              <span class="text-xs font-bold text-BTrustOn-accent">03</span>
            </div>
            <h3 class="text-sm font-bold text-BTrustOn-primary mb-2" data-i18n="how_step3_title">Grow with Trust Scoreâ„¢</h3>
            <p class="text-xs text-gray-500 leading-relaxed" data-i18n="how_step3_desc">Higher Strabon Trust Scores mean higher visibility in search results and more qualified leads.</p>
          </div>
        </div>
      </section>

      <section class="mt-4">
  <div class="text-center mb-6">
          <h2 class="text-2xl md:text-3xl font-header font-bold text-BTrustOn-primary mb-3" data-i18n="pricing_title">Pricing for Industrial Networks</h2>
          <p class="text-sm text-gray-500 max-w-2xl mx-auto" data-i18n="pricing_sub">Start free, then upgrade as your company grows. Every plan includes a public profile and access to the Strabon Trust Scoreâ„¢ framework.</p>
        </div>

        <div class="grid md:grid-cols-3 gap-6">
          <div class="bg-white/90 border border-gray-200 rounded-2xl p-7 shadow-glass flex flex-col">
            <h3 class="text-sm font-bold text-BTrustOn-primary mb-1">Free</h3>
            <p class="text-xs text-gray-500 mb-4" data-i18n="price_free_tag">For small teams getting started.</p>
            <div class="mb-6">
              <span class="text-3xl font-header font-bold text-BTrustOn-primary">$0</span>
              <span class="text-xs text-gray-400 ml-1" data-i18n="price_month">/month</span>
            </div>
            <ul class="text-xs text-gray-600 space-y-2 mb-6">
              <li class="flex items-center gap-2"><i class="fa-solid fa-check text-emerald-500 text-[10px]"></i><span data-i18n="price_free_1">Public company profile</span></li>
              <li class="flex items-center gap-2"><i class="fa-solid fa-check text-emerald-500 text-[10px]"></i><span data-i18n="price_free_2">Up to 3 listed services</span></li>
              <li class="flex items-center gap-2"><i class="fa-solid fa-check text-emerald-500 text-[10px]"></i><span data-i18n="price_free_3">Basic Strabon Trust Scoreâ„¢</span></li>
            </ul>
            <button class="mt-auto w-full border border-gray-300 text-xs font-bold text-gray-600 py-3 rounded-xl hover:bg-gray-50 transition" onclick="toggleModal('modal-join')" data-i18n="btn_get_started">GET STARTED</button>
          </div>

          <div class="bg-BTrustOn-primary text-white rounded-2xl p-7 shadow-float relative overflow-hidden flex flex-col">
            <div class="absolute inset-0 bg-gradient-to-br from-BTrustOn-primary via-slate-900 to-cyan-700 opacity-80"></div>
            <div class="relative z-10 flex justify-between items-start mb-4">
              <div>
                <h3 class="text-sm font-bold mb-1">Pro</h3>
                <p class="text-xs text-cyan-200" data-i18n="price_pro_tag">For growth-focused industrial suppliers.</p>
              </div>
              <span class="text-[10px] font-bold bg-amber-400 text-slate-900 px-2 py-1 rounded-full" data-i18n="badge_popular">MOST POPULAR</span>
            </div>
            <div class="relative z-10 mb-6">
              <span class="text-3xl font-header font-bold">$79</span>
              <span class="text-xs text-cyan-100 ml-1" data-i18n="price_month">/month</span>
            </div>
            <ul class="relative z-10 text-xs text-cyan-50 space-y-2 mb-6">
              <li class="flex items-center gap-2"><i class="fa-solid fa-check text-emerald-400 text-[10px]"></i><span data-i18n="price_pro_1">Unlimited services & assets</span></li>
              <li class="flex items-center gap-2"><i class="fa-solid fa-check text-emerald-400 text-[10px]"></i><span data-i18n="price_pro_2">Verified reference module</span></li>
              <li class="flex items-center gap-2"><i class="fa-solid fa-check text-emerald-400 text-[10px]"></i><span data-i18n="price_pro_3">Priority ranking in search</span></li>
              <li class="flex items-center gap-2"><i class="fa-solid fa-check text-emerald-400 text-[10px]"></i><span data-i18n="price_pro_4">Advanced Trust Scoreâ„¢ insights</span></li>
            </ul>
            <button class="relative z-10 mt-auto w-full bg-white text-BTrustOn-primary text-xs font-bold py-3 rounded-xl hover:bg-cyan-100 transition" onclick="toggleModal('modal-join')" data-i18n="btn_choose_pro">CHOOSE PRO</button>
          </div>

          <div class="bg-white/90 border border-gray-200 rounded-2xl p-7 shadow-glass flex flex-col">
            <h3 class="text-sm font-bold text-BTrustOn-primary mb-1">Enterprise</h3>
            <p class="text-xs text-gray-500 mb-4" data-i18n="price_ent_tag">For EPCs and global industrial groups.</p>
            <div class="mb-6">
              <span class="text-3xl font-header font-bold text-BTrustOn-primary">Custom</span>
            </div>
            <ul class="text-xs text-gray-600 space-y-2 mb-6">
              <li class="flex items-center gap-2"><i class="fa-solid fa-check text-emerald-500 text-[10px]"></i><span data-i18n="price_ent_1">Multi-user access & SSO</span></li>
              <li class="flex items-center gap-2"><i class="fa-solid fa-check text-emerald-500 text-[10px]"></i><span data-i18n="price_ent_2">API access to supplier data</span></li>
              <li class="flex items-center gap-2"><i class="fa-solid fa-check text-emerald-500 text-[10px]"></i><span data-i18n="price_ent_3">Dedicated success manager</span></li>
              <li class="flex items-center gap-2"><i class="fa-solid fa-check text-emerald-500 text-[10px]"></i><span data-i18n="price_ent_4">Custom Trust Scoreâ„¢ models</span></li>
            </ul>
            <button class="mt-auto w-full border border-BTrustOn-primary text-xs font-bold text-BTrustOn-primary py-3 rounded-xl hover:bg-BTrustOn-primary hover:text-white transition" onclick="toggleModal('modal-join')" data-i18n="btn_contact_sales">CONTACT SALES</button>
          </div>
        </div>
      </section>
    </main>
  </div>
<div id="view-editor" class="hidden-view fade-in min-h-screen bg-gray-50 pb-20">
     <div class="bg-BTrustOn-primary text-white pt-24 pb-12 px-4">
          <div class="max-w-4xl mx-auto">
              
              <button onclick="openProfile(selectedCompany.id)" class="mb-6 flex items-center gap-2 text-white/60 hover:text-white transition text-xs font-bold tracking-wider group">
                  <i class="fa-solid fa-arrow-left group-hover:-translate-x-1 transition-transform"></i> BACK TO PROFILE
              </button>
              <div class="flex items-center gap-4 mb-4">
                  <div class="w-12 h-12 rounded-full bg-white/10 flex items-center justify-center text-BTrustOn-accent text-xl">
                      <i class="fa-solid fa-user-pen"></i>
                  </div>
                  <div>
                      <h1 class="text-3xl font-header font-bold">Profile Editor</h1>
                      <p class="text-gray-400 text-sm">Manage your company presence on BTrustOn</p>
                  </div>
              </div>
          </div>
      </div>

      <div class="max-w-4xl mx-auto px-4 -mt-8">
          <div class="bg-white rounded-2xl shadow-xl border border-gray-200 overflow-hidden">
              <div class="grid grid-cols-1 md:grid-cols-3 min-h-[600px]">
                  
                  <div class="bg-slate-50 border-r border-gray-200 p-6">
                      <nav class="space-y-2 sticky top-6">
                          <button onclick="scrollToSection('section-general')" 
                                  class="w-full text-left px-4 py-3 rounded-lg bg-white shadow-sm border border-gray-200 text-sm font-bold text-BTrustOn-primary border-l-4 border-l-BTrustOn-accent hover:bg-gray-50 transition">
                              <i class="fa-solid fa-building w-6 text-gray-400"></i> General Info
                          </button>

            
                          <div class="mt-8 p-4 bg-blue-50 rounded-xl border border-blue-100">
                              <div class="flex justify-between items-center mb-2">
                                <h4 class="text-xs font-bold text-blue-800">Profile Strength</h4>
                                <span id="status-percent" class="text-xs font-bold text-blue-600">0%</span>
                              </div>
                              <div class="w-full bg-blue-200 h-1.5 rounded-full mb-2 overflow-hidden">
                                  <div id="progress-bar" class="bg-blue-600 h-1.5 rounded-full transition-all duration-700" style="width: 0%"></div>
                              </div>
                              <p id="status-text" class="text-[10px] text-blue-600">Complete all fields to boost your Trust Score.</p>
                          </div>
                      </nav>
                  </div>

                  <div class="col-span-2 p-8">
                      <form id="editor-form" onsubmit="event.preventDefault(); saveProfileData();">
<div class="flex items-center gap-6 mb-8 border-b border-gray-100 pb-6">
    <div id="edit-logo-preview-container" 
         class="w-24 h-24 rounded-2xl border-2 border-dashed border-gray-300 bg-gray-50 flex items-center justify-center overflow-hidden relative shadow-sm group cursor-pointer"
         onclick="document.getElementById('edit-logo-input').click()">
        
        <i id="edit-logo-icon" class="fa-solid fa-building text-3xl text-gray-300 group-hover:scale-110 transition-transform duration-300"></i>
        
        <img id="edit-logo-img" class="hidden w-full h-full object-cover" />
        
        <div class="absolute inset-0 bg-slate-900/60 hidden group-hover:flex flex-col items-center justify-center text-white transition-all backdrop-blur-[1px]">
            <i class="fa-solid fa-pen-to-square text-xl mb-1"></i>
            <span class="text-[9px] font-bold uppercase tracking-widest">CHANGE</span>
        </div>
    </div>

    <div>
        <h4 class="text-sm font-bold text-gray-700">Company Logo</h4>
        <p class="text-xs text-gray-400 mb-3">Recommended: 400x400px, PNG or JPG.</p>
        
        <input type="file" id="edit-logo-input" class="hidden" accept="image/*" onchange="handleLogoSelect(this)">
        
        <button type="button" onclick="document.getElementById('edit-logo-input').click()" class="bg-white border border-gray-300 text-gray-600 px-4 py-2 rounded-lg text-xs font-bold hover:bg-gray-50 hover:border-gray-400 transition">
            <i class="fa-solid fa-upload mr-1"></i> Upload Logo
        </button>
    </div>
</div>
                        <div class="space-y-12"> 
                            
                            <div id="section-general" class="space-y-6 scroll-mt-6">
                                <h3 class="text-sm font-bold text-gray-400 uppercase tracking-wider border-b border-gray-100 pb-2">
                                  General Information
                                </h3>
                                
                                <div>
                                    <label class="block text-xs font-bold text-gray-500 uppercase tracking-wider mb-1">
                                      Company Name <span class="text-red-500">*</span>
                                    </label>
                                    <input type="text" id="edit-name" class="input-field w-full border border-gray-300 rounded-lg px-4 py-3 text-gray-800 font-bold focus:outline-none transition" placeholder="e.g. Acme Construction" required />
                                </div>

                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-xs font-bold text-gray-500 uppercase tracking-wider mb-1">City <span class="text-red-500">*</span></label>
                                        <input type="text" id="edit-city" class="input-field w-full border border-gray-300 rounded-lg px-4 py-3 text-gray-800 focus:outline-none transition" placeholder="e.g. Istanbul, TR" required />
                                    </div>
                                    <div>
                                        <label class="block text-xs font-bold text-gray-500 uppercase tracking-wider mb-1">Sector <span class="text-red-500">*</span></label>
                                        <select id="edit-sector" class="input-field w-full border border-gray-300 rounded-lg px-4 py-3 text-gray-800 focus:outline-none transition bg-white" required>
                                            <option value="">Select sectorâ€¦</option>
                                            <option value="construction">Construction</option>
                                            <option value="mining">Mining</option>
                                            <option value="energy">Energy</option>
                                            <option value="manufacturing">Manufacturing</option>
                                            <option value="technology">Technology</option>
                                            <option value="logistics">Logistics</option>
                                        </select>
                                    </div>
                                </div>

                                <div>
                                    <label class="block text-xs font-bold text-gray-500 uppercase tracking-wider mb-1">Tagline (Slogan)</label>
                                    <input type="text" id="edit-tagline" class="input-field w-full border border-gray-300 rounded-lg px-4 py-3 text-gray-800 focus:outline-none transition" placeholder="e.g. Building the Future" />
                                </div>

<div class="grid grid-cols-2 gap-4">
    <div>
      <label class="block text-xs font-bold text-gray-500 uppercase tracking-wider mb-1">Website</label>
      <input type="text" id="edit-website" class="input-field w-full border border-gray-300 rounded-lg px-4 py-3 text-gray-800 focus:outline-none transition" placeholder="www.example.com" />
    </div>
    <div>
      <label class="block text-xs font-bold text-gray-500 uppercase tracking-wider mb-1">Phone</label>
      <input 
  type="text" 
  id="edit-phone" 
  class="input-field w-full border border-gray-300 rounded-lg px-4 py-3 text-gray-800 focus:outline-none transition" 
  placeholder="+ (Country Code) Phone Number" 
/>
    </div>
</div>

<div class="mt-4">
    <label class="block text-xs font-bold text-gray-500 uppercase tracking-wider mb-1">
        Public Contact Email <span class="text-gray-400 font-normal lowercase">(optional)</span>
    </label>
    <input 
      type="email" 
      id="edit-email" 
      class="input-field w-full border border-gray-300 rounded-lg px-4 py-3 text-gray-800 focus:outline-none transition" 
      placeholder="info@company.com (If different from login email)" 
    />
</div>
                                <div>
                                    <label class="block text-xs font-bold text-gray-500 uppercase tracking-wider mb-1">Description</label>
                                    <textarea id="edit-desc" rows="4" class="input-field w-full border border-gray-300 rounded-lg px-4 py-3 text-gray-800 focus:outline-none transition" placeholder="Describe your company's core capabilities..."></textarea>
                                </div>

                                <div class="grid grid-cols-3 gap-4">
                                    <div>
                                      <label class="block text-xs font-bold text-gray-500 uppercase tracking-wider mb-1">Type</label>
                                      <select id="edit-type" class="w-full border border-gray-300 rounded-lg px-4 py-3 bg-white outline-none text-sm">
                                          <option value="Operator">Operator / Asset Owner</option>

                                          <option value="Manufacturer">Manufacturer</option>
                                          <option value="Distributor">Distributor / Supplier</option>
                                          <option value="Contractor">Contractor</option>
                                          <option value="Service & Consultancy">Service & Consultancy</option>
                                      </select>
                                    </div>
                                    <div>
                                      <label class="block text-xs font-bold text-gray-500 uppercase tracking-wider mb-1">Size</label>
                                      <select id="edit-size" class="w-full border border-gray-300 rounded-lg px-4 py-3 bg-white outline-none text-sm">
                                          <option value="1-10 employees">1-10</option>
                                          <option value="10-50 employees">10-50</option>
                                          <option value="50-100 employees">50-100</option>
                                          <option value="100-250 employees">100-250</option>
                                          <option value="250+ employees">250+</option>
                                      </select>
                                    </div>
                                    <div>
                                      <label class="block text-xs font-bold text-gray-500 uppercase tracking-wider mb-1">Year</label>
                                      <input type="number" id="edit-year" class="w-full border border-gray-300 rounded-lg px-4 py-3 outline-none text-sm" placeholder="2012">
                                    </div>
                                </div>
                            </div>

                            <div id="section-services" class="space-y-6 scroll-mt-6">
                                <h3 class="text-sm font-bold text-gray-400 uppercase tracking-wider border-b border-gray-100 pb-2">
                                  Services
                                </h3>
                                <div>
                                    <label class="block text-xs font-bold text-gray-500 uppercase tracking-wider mb-1">
                                      Core Services
                                    </label>
                                    <p class="text-[11px] text-gray-400 mb-2">Comma separated list. Example: EPC, Excavation, Maintenance.</p>
                                    <input type="text" id="edit-services" class="input-field w-full border border-gray-300 rounded-lg px-4 py-3 text-gray-800 focus:outline-none transition" placeholder="EPC, Excavation, Maintenance..." />
                                </div>
                            </div>

                            <div class="pt-6 border-t border-gray-100 flex items-center justify-end gap-3 sticky bottom-0 bg-white pb-2">
                                <button type="button" onclick="openProfile(selectedCompany.id)" class="px-6 py-3 rounded-lg font-bold text-gray-500 hover:bg-gray-100 transition">
                                  Cancel
                                </button>
                                <button type="submit" class="bg-BTrustOn-accent hover:bg-BTrustOn-darkAccent text-white px-8 py-3 rounded-lg font-bold shadow-lg shadow-cyan-500/30 transition transform hover:-translate-y-0.5">
                                    <i class="fa-solid fa-save mr-2"></i> Save &amp; Preview
                                </button>
                            </div>
                        </div> 
                      </form>
                  </div> 
              </div> 
          </div>
      </div>
  </div>
  

  <div
    id="view-profile"
    class="hidden-view fade-in min-h-screen bg-white/50 backdrop-blur-sm"
  >
 <div
    class="bg-gradient-to-r from-slate-50 via-white to-cyan-50/60 border-b border-BTrustOn-border pb-12 pt-12 relative overflow-hidden backdrop-blur-xl"
  >
    <div
      class="max-w-7xl mx-auto px-4 flex flex-col md:flex-row gap-8 items-start relative z-10"
    >
    <div id="p-logo-container" 
     class="w-32 h-32 rounded-2xl border border-white shadow-xl flex items-center justify-center bg-white/90 shrink-0 overflow-hidden relative group transition-all"
     onclick="triggerProfileLogoUpload()">
    
    <i id="p-default-icon" class="fa-solid fa-building text-5xl text-gray-300"></i>
    
    <img id="p-logo-image" class="hidden w-full h-full object-cover" alt="Company Logo" />

    <div id="p-logo-overlay" class="hidden absolute inset-0 bg-slate-900/60 flex-col items-center justify-center text-white backdrop-blur-[1px] cursor-pointer">
        <i class="fa-solid fa-camera text-2xl mb-1"></i>
        <span class="text-[9px] font-bold uppercase tracking-widest">UPDATE</span>
    </div>

    <input type="file" id="profile-logo-input" class="hidden" accept="image/*" onchange="uploadLogoDirectly(this)" onclick="event.stopPropagation()">
</div>

      <div class="flex-grow">
        <div class="flex flex-wrap items-center gap-4 mb-3">
          <h1
            id="p-name"
            class="text-4xl font-header font-bold text-BTrustOn-primary"
          >
            Company Name
          </h1>

          <div class="flex flex-wrap items-center gap-2">
            <div id="p-badge" class="flex flex-wrap gap-2"></div>
            <span
              class="text-[11px] text-gray-400 uppercase tracking-wide"
            >
              Top Verified Company
            </span>
          </div>
        </div>

        <div
          class="flex flex-wrap items-center gap-2 text-xs text-gray-500 mb-4"
        >
          <span id="p-type-tag" class="font-semibold text-gray-700">
            Industrial Supplier
          </span>
          <span>â€¢</span>
          <span id="p-size-tag">100â€“250 employees</span>
          <span>â€¢</span>
          <span id="p-year-tag">Founded 2012</span>
        </div>

        <div id="p-tagline-container" class="hidden mb-8 relative pl-6 border-l-4 border-BTrustOn-accent/40 mt-2">
            <i class="fa-solid fa-quote-left absolute -top-3 -left-3 text-3xl text-BTrustOn-accent/10 bg-white/50 backdrop-blur-sm p-1 rounded-full"></i>
            
            <p id="p-tagline" class="text-xl md:text-2xl font-serif italic text-slate-700 leading-relaxed tracking-wide">
                </p>
        </div>
        <p
  id="p-desc"
  class="text-BTrustOn-text text-lg mb-6 font-light max-w-3xl leading-relaxed whitespace-pre-line break-words"
>
  Description
</p>

        <div class="flex flex-wrap gap-4 text-sm">
          <span
            class="flex items-center gap-2 bg-white/70 px-4 py-2 rounded-full border border-gray-200 shadow-sm"
          >
            <i class="fa-solid fa-location-dot text-BTrustOn-accent"></i>
            <span id="p-city" class="font-semibold text-gray-700">City</span>
          </span>

          <span
            class="flex items-center gap-2 bg-white/70 px-4 py-2 rounded-full border border-gray-200 shadow-sm"
          >
            <i class="fa-solid fa-layer-group text-BTrustOn-accent"></i>
            <span id="p-sector" class="capitalize font-semibold text-gray-700"
              >Sector</span
            >
          </span>
        </div>
      </div>

      <div class="flex items-center gap-3 shrink-0 relative z-20">
        
        <button
          id="btn-edit-profile"
          onclick="editMyProfile()"
          class="hidden-view w-12 h-12 rounded-full bg-white text-gray-500 border border-gray-200 hover:bg-BTrustOn-accent hover:text-white hover:border-BTrustOn-accent transition shadow-sm flex items-center justify-center text-lg group relative"
          title="Edit Profile"
        >
          <i class="fa-solid fa-pen"></i>
        </button>
        
        <button
          id="btn-req-quote"
          onclick="openQuoteModal(document.getElementById('p-name').innerText)"
          class="bg-BTrustOn-primary text-white px-6 py-3 rounded-xl font-bold shadow-xl shadow-slate-900/10 hover:bg-BTrustOn-accent transition text-sm flex items-center justify-center gap-2"
        >
          <i class="fa-solid fa-paper-plane"></i>
          <span data-i18n="req_quote">REQUEST QUOTE</span>
        </button>

      </div>
    </div>
  </div>
<main class="max-w-7xl mx-auto px-4 py-8 grid grid-cols-1 lg:grid-cols-12 gap-8">
      
      <div class="lg:col-span-8 space-y-8">
        
        <div class="border-b border-gray-200 flex gap-1 text-xs font-bold text-gray-500 overflow-x-auto no-scrollbar">
          <button onclick="switchProfileTab('overview')" id="tab-overview" class="flex items-center gap-2 px-6 py-3 rounded-t-xl border-b-2 border-BTrustOn-accent bg-cyan-50/50 transition whitespace-nowrap">
            <i class="fa-solid fa-circle-info text-[11px]"></i>
            <span data-i18n="tab_overview">OVERVIEW</span>
          </button>
          <button onclick="switchProfileTab('projects')" id="tab-projects" class="flex items-center gap-2 px-6 py-3 rounded-t-xl border-b-2 border-transparent hover:bg-cyan-50/40 transition whitespace-nowrap">
            <i class="fa-solid fa-diagram-project text-[11px]"></i>
            <span data-i18n="tab_projects">PROJECTS</span>
          </button>
          <button onclick="switchProfileTab('certs')" id="tab-certs" class="flex items-center gap-2 px-6 py-3 rounded-t-xl border-b-2 border-transparent hover:bg-cyan-50/40 transition whitespace-nowrap">
            <i class="fa-solid fa-certificate text-[11px]"></i>
            <span data-i18n="tab_certs">CERTIFICATES</span>
          </button>
          <button onclick="switchProfileTab('assets')" id="tab-assets" class="flex items-center gap-2 px-6 py-3 rounded-t-xl border-b-2 border-transparent hover:bg-cyan-50/40 transition whitespace-nowrap">
            <i class="fa-solid fa-cube text-[11px]"></i>
            <span data-i18n="tab_assets">ASSETS</span>
          </button>
        </div>

        <div id="content-overview">
          <h3 class="font-bold text-BTrustOn-primary mb-4 font-header uppercase text-sm tracking-wider" data-i18n="lbl_services">
            Core Services
          </h3>
          <div id="p-services-grid" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8"></div>
        </div>

        <div id="content-projects" class="hidden-view">
          
          <div class="flex flex-wrap items-center justify-between mb-6 border-b border-gray-100 pb-4">
            <div>
               <h3 class="font-bold text-BTrustOn-primary font-header uppercase text-sm tracking-wider" data-i18n="proj_key_ref">Key Reference Projects</h3>
                           </div>
            
            <button id="btn-add-project" type="button" onclick="openProjectModal()" class="hidden-view items-center gap-2 px-4 py-2 rounded-lg bg-BTrustOn-primary text-white font-bold text-xs hover:bg-BTrustOn-accent transition shadow-lg shadow-blue-900/10">
                <i class="fa-solid fa-plus"></i> <span>ADD NEW PROJECT</span>
            </button>
          </div>

         <div id="p-projects-list" class="grid grid-cols-1 md:grid-cols-2 gap-4 max-h-[600px] overflow-y-auto custom-scrollbar pr-2 pb-2"></div>
        </div>

        <div id="content-certs" class="hidden-view">
  <div class="flex items-center justify-between mb-6 border-b border-gray-100 pb-4">
    <div>
      <h3 class="font-bold text-BTrustOn-primary font-header uppercase text-sm tracking-wider" data-i18n="certs_title">Certifications</h3>
      <span class="text-[11px] text-gray-400" data-i18n="certs_sub">Declared certificates</span>
    </div>

    <button id="btn-add-cert" type="button" onclick="openCertModal()" class="hidden-view items-center gap-2 px-4 py-2 rounded-lg bg-BTrustOn-primary text-white font-bold text-xs hover:bg-BTrustOn-accent transition shadow-lg shadow-blue-900/10">
        <i class="fa-solid fa-plus"></i> <span>ADD CERTIFICATE</span>
    </button>
  </div>
  
  <div id="p-certs-list" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
</div>

        <div id="content-assets" class="hidden-view">
          <div class="bg-white rounded-xl border border-gray-200 overflow-hidden shadow-sm">
            
            <div class="flex flex-wrap items-center justify-between px-6 py-5 border-b border-gray-100 bg-gray-50/30">
              <div class="flex flex-col gap-2">
                <h3 class="font-bold text-BTrustOn-primary font-header uppercase text-sm tracking-wider">Equipment & Assets</h3>
               <div class="flex flex-wrap items-center gap-2 text-[10px]">
                   <span class="inline-flex items-center px-2 py-1 rounded-full bg-emerald-50 text-emerald-700 font-semibold border border-emerald-100">Available</span>
                   
                   <span class="inline-flex items-center px-2 py-1 rounded-full bg-amber-50 text-amber-700 font-semibold border border-amber-100">Under Maintenance</span>
                   
                   <span class="inline-flex items-center px-2 py-1 rounded-full bg-rose-50 text-rose-700 font-semibold border border-rose-100">Out of Service</span>
                </div>
              </div>
              <button id="btn-add-asset" type="button" onclick="openAssetModal()" class="hidden-view items-center gap-2 px-4 py-2 rounded-lg bg-BTrustOn-primary text-white font-bold text-xs hover:bg-BTrustOn-accent transition shadow-lg shadow-blue-900/10">
                <i class="fa-solid fa-plus"></i> <span>ADD NEW ASSET</span>
              </button>
            </div>

            <div class="overflow-x-auto max-h-[500px] overflow-y-auto custom-scrollbar relative">
              <table class="min-w-full text-sm text-left border-collapse">
                <thead class="bg-gray-50 text-gray-400 uppercase font-bold text-[10px] tracking-wider sticky top-0 z-10 shadow-sm">
                  <tr>
                    <th class="py-3 px-6 bg-gray-50">Item Name</th>
                    <th class="py-3 px-6 bg-gray-50">Specs</th>
                    <th class="py-3 px-6 bg-gray-50 text-center">Qty</th>
                    <th class="py-3 px-6 bg-gray-50">Location</th>
                    <th class="py-3 px-6 bg-gray-50">Status</th>
                    <th class="py-3 px-6 bg-gray-50 text-right w-24">Actions</th>
                  </tr>
                </thead>
                <tbody id="p-assets-list" class="divide-y divide-gray-100 bg-white"></tbody>
              </table>
            </div>
          </div>
        </div>

      </div> <div class="lg:col-span-4 space-y-6">
        
        <div class="sticky top-28">
    <div class="bg-white rounded-2xl p-8 shadow-[0_10px_40px_-15px_rgba(0,0,0,0.1)] border border-gray-100 relative overflow-hidden group hover:shadow-[0_20px_50px_-20px_rgba(6,182,212,0.15)] transition-all duration-500">
      
      <div class="absolute top-0 right-0 w-64 h-64 bg-cyan-50/50 rounded-full blur-3xl -mr-32 -mt-32 pointer-events-none"></div>
      
      <div class="relative z-10 text-center">
        <h3 class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-6 flex items-center justify-center gap-2">
          <i class="fa-solid fa-shield-halved text-BTrustOn-accent"></i>
          BTrustOn Scoreâ„¢
        </h3>

        <div class="relative w-40 h-40 mx-auto mb-6">
           <svg class="w-full h-full transform -rotate-90" viewBox="0 0 100 100">
             <circle
               class="text-gray-100"
               stroke-width="8"
               stroke="currentColor"
               fill="transparent"
               r="42"
               cx="50"
               cy="50"
             />
             <circle
               id="p-score-ring"
               class="text-BTrustOn-accent transition-all duration-1500 ease-out"
               stroke-width="8"
               stroke-linecap="round"
               stroke="currentColor"
               fill="transparent"
               r="42"
               cx="50"
               cy="50"
               stroke-dasharray="263.89"
               stroke-dashoffset="263.89" />
           </svg>
           
           <div class="absolute inset-0 flex flex-col items-center justify-center">
             <span id="p-score" class="text-5xl font-header font-bold text-BTrustOn-primary tracking-tighter leading-none">98</span>
             <span id="p-score-label" class="text-[11px] font-bold text-emerald-600 bg-emerald-50 px-2.5 py-0.5 rounded-full mt-1 border border-emerald-100">EXCELLENT</span>
           </div>
        </div>

        <p data-i18n="score_info_main" class="text-xs text-gray-500 leading-relaxed max-w-[260px] mx-auto">
          Calculated from verified references, delivery performance and digital signals.
        </p>
      </div>
    </div>

    <div class="mt-6 bg-white border border-gray-100 rounded-2xl p-6 shadow-sm">
      <h4 class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-4">Contact Info</h4>
      <div class="space-y-4 text-sm text-gray-600">
          <div class="flex items-center gap-3">
              <div class="w-8 h-8 rounded-full bg-gray-50 flex items-center justify-center text-gray-400">
                  <i class="fa-solid fa-globe"></i>
              </div>
              <a id="p-website-link" href="#" target="_blank" class="text-BTrustOn-accent font-semibold hover:underline truncate">-</a>
          </div>
          <div class="flex items-center gap-3">
              <div class="w-8 h-8 rounded-full bg-gray-50 flex items-center justify-center text-gray-400">
                  <i class="fa-solid fa-envelope"></i>
              </div>
              <span id="p-email-text" class="truncate">-</span>
          </div>
          <div class="flex items-center gap-3">
              <div class="w-8 h-8 rounded-full bg-gray-50 flex items-center justify-center text-gray-400">
                  <i class="fa-solid fa-phone"></i>
              </div>
              <span id="p-phone-text" class="truncate">-</span>
          </div>
      </div>
    </div>
</div>
        
      </main>
  
  </div>

  <div
    id="modal-join"
    class="modal opacity-0 pointer-events-none fixed w-full h-full top-0 left-0 flex items-center justify-center z-50"
  >
    <div
      class="modal-overlay absolute w-full h-full bg-slate-900/60 backdrop-blur-sm"
    ></div>
    <div
      class="modal-container bg-white w-11/12 md:max-w-lg mx-auto rounded-2xl shadow-2xl z-50 overflow-y-auto max-h-[90vh] animate-fade-in"
    >
      <div class="py-8 px-8">
        <div
          class="flex justify-between items-center pb-4 border-b border-gray-100 mb-6"
        >
          <div>
            <p
              class="text-2xl font-header font-bold text-BTrustOn-primary"
              data-i18n="join_title"
            >
              Join the Network
            </p>
            <p
              class="text-[11px] text-gray-500 mt-1"
              data-i18n="join_desc"
            >
              Create your company profile. Verification usually takes 24
              hours.
            </p>
          </div>
          <div
            class="cursor-pointer z-50"
            onclick="toggleModal('modal-join')"
          >
            <i
              class="fa-solid fa-xmark text-gray-400 hover:text-red-500 text-xl"
            ></i>
          </div>
        </div>
        <form id="join-form" onsubmit="event.preventDefault(); handleJoin();" class="space-y-5">
  <div>
    <label class="block text-xs font-bold text-gray-600 mb-1.5" data-i18n="field_company">Company Name</label>
    <input type="text" id="join-companyName" class="w-full border border-gray-200 bg-gray-50 rounded-lg px-4 py-3 outline-none" required />
  </div>

  <div class="grid grid-cols-2 gap-4">
    <div>
      <label class="block text-xs font-bold text-gray-600 mb-1.5">Email</label>
      <input type="email" id="join-email" class="w-full border border-gray-200 bg-gray-50 rounded-lg px-4 py-3 outline-none" required />
    </div>
    <div>
      <label class="block text-xs font-bold text-gray-600 mb-1.5">Password</label>
      <input type="password" id="join-password" class="w-full border border-gray-200 bg-gray-50 rounded-lg px-4 py-3 outline-none" placeholder="******" required />
    </div>
  </div>

  <div class="grid grid-cols-2 gap-4">
    
    <div>
      <label class="block text-xs font-bold text-gray-600 mb-1.5">Primary Sector</label>
      <select id="join-sector" class="w-full border border-gray-200 bg-gray-50 rounded-lg px-4 py-3 outline-none cursor-pointer text-gray-700">
        <option value="construction">Construction</option>
        <option value="mining">Mining</option>
        <option value="energy">Energy</option>
        <option value="manufacturing">Manufacturing</option>
        <option value="technology">Technology</option>
        <option value="logistics">Logistics</option>
      </select>
      <p class="text-[10px] text-gray-400 mt-1 leading-tight">Select your main field of activity.</p>
    </div>
    
    <div>
      <label class="block text-xs font-bold text-gray-600 mb-1.5">Business Type</label>
      <select id="join-type" class="w-full border border-gray-200 bg-gray-50 rounded-lg px-4 py-3 outline-none cursor-pointer text-gray-700">
        <option value="Operator">Operator / Asset Owner</option>
        <option value="Manufacturer">Manufacturer</option>
        <option value="Distributor">Distributor / Supplier</option>
        <option value="Contractor">Contractor</option>
        <option value="Service & Consultancy">Service & Consultancy</option>
      </select>
      <p class="text-[10px] text-gray-400 mt-1 leading-tight">Select your role in the supply chain.</p>
    </div>
  </div>

  <div class="mt-4">
      <label class="block text-xs font-bold text-gray-600 mb-1.5" data-i18n="field_city">City</label>
      <input type="text" id="join-city" class="w-full border border-gray-200 bg-gray-50 rounded-lg px-4 py-3 outline-none" required />
  </div>

  <div>
    <label class="block text-xs font-bold text-gray-600 mb-1.5" data-i18n="field_services">Core Services</label>
    <textarea id="join-services" rows="2" class="w-full border border-gray-200 bg-gray-50 rounded-lg px-4 py-3 outline-none" placeholder="EPC, Excavation..."></textarea>
  </div>

  <div class="pt-2">
    <button type="submit" class="w-full bg-BTrustOn-primary text-white font-bold py-4 rounded-xl hover:bg-BTrustOn-accent transition">
      CREATE ACCOUNT & PROFILE
    </button>
  </div>
  <p id="join-error" class="text-xs text-red-500 text-center hidden"></p>
</form>
      </div>
    </div>
  </div>

  <div
    id="modal-quote"
    class="modal opacity-0 pointer-events-none fixed w-full h-full top-0 left-0 flex items-center justify-center z-50"
  >
    <div
      class="modal-overlay absolute w-full h-full bg-slate-900/60 backdrop-blur-sm"
    ></div>
    <div
      class="modal-container bg-white w-11/12 md:max-w-md mx-auto rounded-2xl shadow-2xl z-50 overflow-y-auto max-h-[90vh] animate-fade-in"
    >
      <div class="py-8 px-8">
        <div
          class="flex justify-between items-center pb-4 border-b border-gray-100 mb-6"
        >
          <div class="flex flex-col">
            <p
              class="text-2xl font-header font-bold text-BTrustOn-primary"
              data-i18n="quote_title"
            >
              Request Quote
            </p>
            <p
              class="text-xs text-BTrustOn-accent font-bold mt-1"
              id="quote-target-company"
            >
              Target Company
            </p>
          </div>
          <div
            class="cursor-pointer z-50"
            onclick="toggleModal('modal-quote')"
          >
            <i
              class="fa-solid fa-xmark text-gray-400 hover:text-red-500 text-xl"
            ></i>
          </div>
        </div>
        <form
          action="https://formspree.io/f/mqakpeoy"
          method="POST"
          class="space-y-5"
        >
          <input type="hidden" name="form_type" value="Quote_Request" />
          <input
            type="hidden"
            name="target_company"
            id="input-target-company"
          />
          <div>
            <label
              class="block text-xs font-bold text-gray-600 mb-1.5"
              data-i18n="field_your_name"
              >Your Name</label
            >
            <input
              type="text"
              name="name"
              class="w-full border border-gray-200 bg-gray-50 rounded-lg px-4 py-3 outline-none"
              required
            />
          </div>
          <div>
            <label
              class="block text-xs font-bold text-gray-600 mb-1.5"
              >Email</label
            >
            <input
              type="email"
              name="email"
              class="w-full border border-gray-200 bg-gray-50 rounded-lg px-4 py-3 outline-none"
              required
            />
          </div>
          <div>
            <label
              class="block text-xs font-bold text-gray-600 mb-1.5"
              data-i18n="field_project"
              >Project Details</label
            >
            <textarea
              name="message"
              rows="4"
              class="w-full border border-gray-200 bg-gray-50 rounded-lg px-4 py-3 outline-none"
              required
            ></textarea>
          </div>
          <div class="pt-2">
            <button
              type="submit"
              class="w-full bg-BTrustOn-accent text-white font-bold py-4 rounded-xl hover:bg-blue-600 transition"
              data-i18n="btn_send_quote"
            >
              SEND REQUEST
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <footer class="border-t border-gray-200 bg-white/80 mt-4">
    <div
      class="max-w-7xl mx-auto px-4 py-6 flex flex-col md:flex-row items-center justify-between gap-4 text-xs text-gray-500"
    >
      <div class="flex items-center gap-2">
      <span class="font-header font-bold text-BTrustOn-primary text-sm">BtrustOn</span>
        >
        <span
          >Â© <span id="year-span"></span> Â·
          <span data-i18n="footer_rights">All rights reserved.</span></span
        >
      </div>
      <div class="flex gap-4">
        <a href="#" class="hover:text-BTrustOn-primary" data-i18n="footer_about"
          >About</a
        >
        <a
          href="#"
          class="hover:text-BTrustOn-primary"
          data-i18n="footer_pricing"
          >Pricing</a
        >
        <a
          href="#"
          class="hover:text-BTrustOn-primary"
          data-i18n="footer_privacy"
          >Privacy</a
        >
        <a
          href="#"
          class="hover:text-BTrustOn-primary"
          data-i18n="footer_terms"
          >Terms</a
        >
      </div>
    </div>
  </footer>

<!-- Partner Login Modal -->
<div
  id="login-modal"
  class="fixed inset-0 bg-black/40 hidden items-center justify-center z-50"
>
  <div class="bg-white rounded-xl shadow-lg p-6 w-full max-w-sm">
    <h2 class="text-lg font-bold mb-4">Partner Login</h2>

    <form id="login-form" class="space-y-3">
      <div>
        <label class="block text-sm mb-1">Email</label>
        <input
          type="email"
          name="email"
          required
          class="w-full border rounded px-3 py-2 text-sm"
        />
      </div>

      <div>
        <label class="block text-sm mb-1">Password</label>
        <input
          type="password"
          name="password"
          required
          class="w-full border rounded px-3 py-2 text-sm"
        />
      </div>

      <p id="login-error" class="text-xs text-red-500 hidden"></p>

      <div class="flex justify-end gap-2 mt-4">
        <button
          type="button"
          onclick="closeLoginModal()"
          class="text-sm px-3 py-2"
        >
          Cancel
        </button>
        <button
          type="submit"
          class="text-sm px-4 py-2 rounded bg-blue-600 text-white"
        >
          Login
        </button>
      </div>
    </form>
  </div>
</div>
<div id="asset-modal" class="fixed inset-0 z-[60] flex items-center justify-center opacity-0 pointer-events-none transition-opacity duration-300">
  <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm" onclick="closeAssetModal()"></div>
  
  <div class="bg-white w-full max-w-md mx-4 rounded-2xl shadow-2xl z-10 overflow-hidden transform transition-all">
    <div class="bg-BTrustOn-primary text-white px-6 py-4 flex justify-between items-center">
      <h3 id="asset-modal-title" class="font-bold font-header tracking-wide">Add New Asset</h3>
      <button onclick="closeAssetModal()" class="text-white/70 hover:text-white transition">
        <i class="fa-solid fa-xmark text-xl"></i>
      </button>
    </div>
    
    <div class="p-6">
      <form id="asset-form" onsubmit="event.preventDefault(); saveAsset();" class="space-y-4">
        
        <div>
    <label class="block text-xs font-bold text-gray-500 uppercase tracking-wider mb-1">Description</label>
    <textarea 
      id="edit-desc" 
      rows="4" 
      class="input-field w-full border border-gray-300 rounded-lg px-4 py-3 text-gray-800 focus:outline-none transition resize-y whitespace-normal" 
      placeholder="Describe your company's core capabilities..."
    ></textarea>
</div>

        <div class="grid grid-cols-3 gap-4">
          <div class="col-span-2">
            <label class="block text-xs font-bold text-gray-500 uppercase tracking-wider mb-1">Specs</label>
            <input type="text" id="asset-specs" class="w-full border border-gray-300 rounded-lg px-4 py-2.5 text-sm outline-none transition" placeholder="2022 Model, Low hours">
          </div>
          <div>
            <label class="block text-xs font-bold text-gray-500 uppercase tracking-wider mb-1">Qty</label>
            <input type="number" id="asset-qty" class="w-full border border-gray-300 rounded-lg px-4 py-2.5 text-sm outline-none transition" value="1">
          </div>
        </div>

        <div>
          <label class="block text-xs font-bold text-gray-500 uppercase tracking-wider mb-1">Location</label>
          <input type="text" id="asset-location" class="w-full border border-gray-300 rounded-lg px-4 py-2.5 text-sm outline-none transition" placeholder="e.g. Ankara Warehouse">
        </div>

        <div>
          <label class="block text-xs font-bold text-gray-500 uppercase tracking-wider mb-1">Status</label>
          <select id="asset-status" class="w-full border border-gray-300 rounded-lg px-4 py-2.5 text-sm bg-white outline-none transition">
            <option value="Available">Available</option>
            <option value="Under Maintenance">Under Maintenance</option>
            <option value="Out of Service">Out of Service</option>
          </select>
        </div>

        <div class="pt-4 flex gap-3">
          <button type="button" onclick="closeAssetModal()" class="flex-1 px-4 py-3 rounded-xl border border-gray-300 text-gray-600 font-bold text-xs hover:bg-gray-50 transition">
            CANCEL
          </button>
          <button type="submit" class="flex-1 px-4 py-3 rounded-xl bg-BTrustOn-accent text-white font-bold text-xs hover:bg-BTrustOn-darkAccent transition shadow-lg shadow-cyan-500/20">
            SAVE ASSET
          </button>
        </div>

      </form>
    </div>
  </div>
</div>
<div id="project-modal" class="fixed inset-0 z-[60] flex items-center justify-center opacity-0 pointer-events-none transition-opacity duration-300">
  <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm" onclick="closeProjectModal()"></div>
  
  <div class="bg-white w-full max-w-lg mx-4 rounded-2xl shadow-2xl z-10 overflow-hidden transform transition-all">
    <div class="bg-BTrustOn-primary text-white px-6 py-4 flex justify-between items-center">
      <h3 id="project-modal-title" class="font-bold font-header tracking-wide">Add New Project</h3>
      <button onclick="closeProjectModal()" class="text-white/70 hover:text-white transition">
        <i class="fa-solid fa-xmark text-xl"></i>
      </button>
    </div>
    
    <div class="p-6">
      <form id="project-form" onsubmit="event.preventDefault(); saveProject();" class="space-y-4">
        
        <div>
          <label class="block text-xs font-bold text-gray-500 uppercase tracking-wider mb-1">Project Title</label>
          <input type="text" id="proj-title" class="w-full border border-gray-300 rounded-lg px-4 py-2.5 text-sm focus:border-BTrustOn-accent focus:ring-1 focus:ring-BTrustOn-accent outline-none transition" placeholder="e.g. Copper Mine Expansion" required>
        </div>

        <div>
          <label class="block text-xs font-bold text-gray-500 uppercase tracking-wider mb-1">Location</label>
          <input type="text" id="proj-loc" class="w-full border border-gray-300 rounded-lg px-4 py-2.5 text-sm outline-none transition" placeholder="e.g. Erzincan, TR" required>
        </div>

        <div>
          <label class="block text-xs font-bold text-gray-500 uppercase tracking-wider mb-1">Description</label>
          <textarea id="proj-desc" rows="3" class="w-full border border-gray-300 rounded-lg px-4 py-2.5 text-sm outline-none transition" placeholder="Short details about the scope..."></textarea>
        </div>

        <div class="pt-4 flex gap-3">
          <button type="button" onclick="closeProjectModal()" class="flex-1 px-4 py-3 rounded-xl border border-gray-300 text-gray-600 font-bold text-xs hover:bg-gray-50 transition">
            CANCEL
          </button>
          <button type="submit" class="flex-1 px-4 py-3 rounded-xl bg-BTrustOn-accent text-white font-bold text-xs hover:bg-BTrustOn-darkAccent transition shadow-lg shadow-cyan-500/20">
            SAVE PROJECT
          </button>
        </div>

      </form>
    </div>
  </div>
</div>
<div id="cert-modal" class="fixed inset-0 z-[60] flex items-center justify-center opacity-0 pointer-events-none transition-opacity duration-300">
  <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm" onclick="closeCertModal()"></div>
  
  <div class="bg-white w-full max-w-sm mx-4 rounded-2xl shadow-2xl z-10 overflow-hidden transform transition-all">
    <div class="bg-BTrustOn-primary text-white px-6 py-4 flex justify-between items-center">
      <h3 id="cert-modal-title" class="font-bold font-header tracking-wide">Add Certificate</h3>
      <button onclick="closeCertModal()" class="text-white/70 hover:text-white transition">
        <i class="fa-solid fa-xmark text-xl"></i>
      </button>
    </div>
    
    <div class="p-6">
      <form id="cert-form" onsubmit="event.preventDefault(); saveCert();" class="space-y-4">
        
        <div>
          <label class="block text-xs font-bold text-gray-500 uppercase tracking-wider mb-1">Certificate Name</label>
          <input type="text" id="cert-name" class="w-full border border-gray-300 rounded-lg px-4 py-2.5 text-sm focus:border-BTrustOn-accent focus:ring-1 focus:ring-BTrustOn-accent outline-none transition" placeholder="e.g. ISO 9001:2015" required>
        </div>

        <div>
          <label class="block text-xs font-bold text-gray-500 uppercase tracking-wider mb-1">Issuer / Organization</label>
          <input type="text" id="cert-issuer" class="w-full border border-gray-300 rounded-lg px-4 py-2.5 text-sm outline-none transition" placeholder="e.g. TUV NORD">
        </div>

        <div class="pt-4 flex gap-3">
          <button type="button" onclick="closeCertModal()" class="flex-1 px-4 py-3 rounded-xl border border-gray-300 text-gray-600 font-bold text-xs hover:bg-gray-50 transition">
            CANCEL
          </button>
          <button type="submit" class="flex-1 px-4 py-3 rounded-xl bg-BTrustOn-accent text-white font-bold text-xs hover:bg-BTrustOn-darkAccent transition shadow-lg shadow-cyan-500/20">
            SAVE
          </button>
        </div>

      </form>
    </div>
  </div>
</div>
<div id="delete-modal" class="fixed inset-0 z-[70] flex items-center justify-center opacity-0 pointer-events-none transition-opacity duration-300">
  <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm" onclick="closeDeleteModal()"></div>
  
  <div class="bg-white w-full max-w-sm mx-4 rounded-2xl shadow-2xl z-20 overflow-hidden transform transition-all scale-95" id="delete-modal-content">
    <div class="p-6 text-center">
      
      <div class="w-16 h-16 bg-red-50 rounded-full flex items-center justify-center mx-auto mb-4">
        <i class="fa-solid fa-triangle-exclamation text-2xl text-red-500"></i>
      </div>

      <h3 class="text-lg font-bold text-gray-800 mb-2">Are you sure?</h3>
      <p id="delete-modal-msg" class="text-sm text-gray-500 mb-6 leading-relaxed">
        Do you really want to delete this item? This process cannot be undone.
      </p>

      <div class="flex gap-3">
        <button onclick="closeDeleteModal()" class="flex-1 px-4 py-3 rounded-xl border border-gray-200 text-gray-600 font-bold text-xs hover:bg-gray-50 transition">
          CANCEL
        </button>
        <button id="btn-confirm-delete" class="flex-1 px-4 py-3 rounded-xl bg-red-500 text-white font-bold text-xs hover:bg-red-600 transition shadow-lg shadow-red-500/30">
          YES, DELETE
        </button>
      </div>

    </div>
  </div>
</div>

<div id="inbox-overlay" onclick="toggleInbox()" class="fixed inset-0 bg-slate-900/20 backdrop-blur-[2px] z-[9990] hidden transition-opacity opacity-0"></div>

<div id="inbox-panel" class="flex flex-col">
    <div class="h-24 bg-gradient-to-r from-BTrustOn-primary to-slate-800 flex flex-col justify-center px-6 shadow-lg relative overflow-hidden">
        <div class="absolute top-0 right-0 w-32 h-32 bg-cyan-500/10 rounded-full blur-2xl -mr-10 -mt-10"></div>
        
        <div class="relative z-10 flex justify-between items-center">
            <div>
                <h2 class="text-white font-header text-xl tracking-wide flex items-center gap-2">
                    INBOX
                    <span id="inbox-badge-count" class="bg-red-500 text-white text-[10px] font-bold px-2 py-0.5 rounded-full shadow-glow hidden">0</span>
                </h2>
                <p class="text-slate-400 text-xs mt-1">Quote requests & System alerts</p>
            </div>
            <button onclick="toggleInbox()" class="text-white/60 hover:text-white hover:rotate-90 transition transform">
                <i class="fa-solid fa-xmark text-xl"></i>
            </button>
        </div>
    </div>

    <div id="inbox-content" class="flex-1 overflow-y-auto custom-scrollbar p-2 space-y-2 bg-slate-50/50">
        </div>

    <div class="p-4 border-t border-gray-200 bg-white/80 backdrop-blur-sm">
        <button onclick="markAllInboxRead()" class="w-full py-3 rounded-xl border border-gray-200 text-gray-500 text-xs font-bold hover:bg-gray-50 transition flex items-center justify-center gap-2">
    <i class="fa-solid fa-check-double"></i> MARK ALL AS READ
</button>
    </div>
</div>
<div id="view-message" class="hidden-view fixed inset-0 z-[10000] bg-slate-50/95 backdrop-blur-sm overflow-y-auto">
    
    <div class="sticky top-0 bg-white/80 backdrop-blur-md border-b border-gray-200 px-6 py-4 flex justify-between items-center max-w-5xl mx-auto w-full z-10">
        <button onclick="closeMessageView()" class="flex items-center gap-2 text-gray-500 hover:text-BTrustOn-primary transition font-bold text-sm px-4 py-2 rounded-lg hover:bg-gray-100">
            <i class="fa-solid fa-arrow-left"></i> BACK TO INBOX
        </button>
        
        <div class="flex gap-2">
            <button onclick="deleteCurrentMessage()" class="w-9 h-9 rounded-full border border-gray-200 text-gray-400 hover:text-red-500 hover:bg-red-50 hover:border-red-200 transition flex items-center justify-center" title="Delete">
                <i class="fa-solid fa-trash-can text-sm"></i>
            </button>
            
            <button onclick="markAsUnreadCurrentMessage()" class="w-9 h-9 rounded-full border border-gray-200 text-gray-400 hover:text-BTrustOn-accent hover:bg-cyan-50 hover:border-BTrustOn-accent transition flex items-center justify-center" title="Mark Unread">
                <i class="fa-solid fa-envelope text-sm"></i>
            </button>
        </div>
    </div>

    <div class="max-w-4xl mx-auto mt-8 mb-20 px-4">
        <div class="bg-white rounded-2xl shadow-xl border border-gray-100 overflow-hidden min-h-[600px]">
            
            <div class="bg-slate-50 border-b border-gray-100 p-8 flex flex-col md:flex-row justify-between items-start gap-6">
                <div class="flex items-start gap-4">
                    <div id="msg-logo" class="w-16 h-16 rounded-xl bg-white border border-gray-200 shadow-sm flex items-center justify-center text-2xl font-bold text-BTrustOn-primary">
                        </div>
                    <div>
                        <h1 id="msg-subject" class="text-2xl font-header font-bold text-BTrustOn-primary mb-1">
                            </h1>
                        <div class="flex items-center gap-2 text-sm text-gray-500">
                            <span>From:</span>
                            <span id="msg-company" class="font-bold text-gray-700 bg-gray-200/50 px-2 py-0.5 rounded">
                                </span>
                            <span class="text-gray-300">â€¢</span>
                            <span id="msg-date" class="text-xs">
                                </span>
                        </div>
                    </div>
                </div>
                
                <div class="flex flex-col items-end">
                    <span id="msg-type-badge" class="px-3 py-1 rounded-full text-xs font-bold bg-cyan-50 text-BTrustOn-accent border border-cyan-100 uppercase tracking-wide">
                        QUOTE REQUEST
                    </span>
                </div>
            </div>

            <div class="p-8 md:p-12">
                <div class="prose max-w-none text-gray-600 leading-relaxed text-lg">
                    <p id="msg-body">
                        </p>
                    
                    <p class="mt-6 text-sm text-gray-400 italic">
                        This message was sent via Strabon Secure Network. <br>
                        Reference ID: #<span id="msg-id"></span>
                    </p>
                </div>

                <div class="mt-12 pt-8 border-t border-gray-100">
                    <h4 class="text-sm font-bold text-BTrustOn-primary mb-3 uppercase tracking-wider">Reply to Request</h4>
                    <div class="flex gap-4 items-start">
                        <div class="w-10 h-10 rounded-full bg-BTrustOn-primary text-white flex items-center justify-center shrink-0 text-sm">
                            ME
                        </div>
                        <div class="flex-1">
                
                <input type="file" id="reply-file-input" style="display: none;" onchange="handleFileSelect(this)" />

                <textarea id="reply-input" class="w-full border border-gray-200 rounded-xl p-4 text-sm focus:outline-none focus:border-BTrustOn-accent focus:ring-1 focus:ring-BTrustOn-accent transition bg-gray-50 focus:bg-white" rows="3" placeholder="Type your reply or attach a formal proposal..."></textarea>
                
                <div id="attachment-preview" class="hidden mt-3 flex items-center justify-between bg-cyan-50 border border-cyan-100 rounded-lg p-3">
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 rounded bg-white flex items-center justify-center text-BTrustOn-accent shadow-sm">
                            <i class="fa-solid fa-file-lines"></i>
                        </div>
                        <div>
                            <p id="attachment-name" class="text-xs font-bold text-gray-700 line-clamp-1">filename.pdf</p>
                            <p id="attachment-size" class="text-[10px] text-gray-400">0 MB</p>
                        </div>
                    </div>
                    <button type="button" onclick="removeAttachment()" class="text-gray-400 hover:text-red-500 transition px-2">
                        <i class="fa-solid fa-xmark"></i>
                    </button>
                </div>

                <div class="flex justify-end gap-3 mt-3">
                    <button type="button" onclick="document.getElementById('reply-file-input').click()" class="px-4 py-2 rounded-lg border border-gray-200 text-gray-500 text-xs font-bold hover:bg-gray-50 transition group">
                        <i class="fa-solid fa-paperclip mr-1 group-hover:text-BTrustOn-accent"></i> ATTACH FILE
                    </button>
                    
                    <button type="button" onclick="sendReply()" class="px-6 py-2 rounded-lg bg-BTrustOn-accent text-white text-xs font-bold hover:bg-BTrustOn-darkAccent transition shadow-lg shadow-cyan-500/20">
                        SEND REPLY <i class="fa-solid fa-paper-plane ml-1"></i>
                    </button>
                </div>
            </div>

            </div>
        </div>
    </div>
</div> 
<script>
  // Login modalÄ±nÄ± aÃ§/kapat
  function openLoginModal() {
    const modal = document.getElementById("login-modal");
    if (!modal) return;
    modal.classList.remove("hidden");
    modal.classList.add("flex");

    const err = document.getElementById("login-error");
    if (err) {
      err.classList.add("hidden");
      err.textContent = "";
    }
  }

  function closeLoginModal() {
    const modal = document.getElementById("login-modal");
    if (!modal) return;
    modal.classList.add("hidden");
    modal.classList.remove("flex");

    const err = document.getElementById("login-error");
    if (err) {
      err.classList.add("hidden");
      err.textContent = "";
    }
  }

  
  // Sayfa yÃ¼klendiÄŸinde login formunu hazÄ±rla
  document.addEventListener("DOMContentLoaded", () => {
    const form = document.getElementById("login-form");
    if (!form) return;

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const data = new FormData(form);
      const email = data.get("email");
      const password = data.get("password");

      const err = document.getElementById("login-error");
      if (err) {
        err.classList.add("hidden");
        err.textContent = "";
      }

      const { data: authData, error } = await supabaseClient.auth.signInWithPassword({
        email,
        password,
      });

      if (error) {
        if (err) {
          err.textContent = error.message || "Login failed";
          err.classList.remove("hidden");
        }
        return;
      }

      // âœ… Login baÅŸarÄ±lÄ± â†’ modalÄ± kapat ve "benim ÅŸirketimi" aÃ§
      closeLoginModal();
      checkUserAndOpenProfile(true);
    });
  });

  // Logout
  async function partnerLogout() {
    try {
      await supabaseClient.auth.signOut();
    } catch (err) {
      console.error("Logout error:", err);
    } finally {
      // Ä°stersen burada ana ekrana dÃ¶ndÃ¼rÃ¼rÃ¼z
      window.location.href = "/";
    }
  }
</script>


  <script>
    const translations = {
      en: {
        hero_title:
          "Source Smarter. <br> <span class='text-transparent bg-clip-text bg-gradient-to-r from-BTrustOn-accent to-blue-600'>Build Faster.</span>",
        hero_desc:
          "Discover verified industrial companies, trust scores and real project references â€“ all on a single screen.",
        search_ph:
          "Search companies, equipment & services...",
        btn_discover: "DISCOVER",
        join: "JOIN NETWORK",
        tab_certs: "CERTIFICATES",
        no_certs: "No certificates listed for this supplier.",
        asset_categories: "Asset categories:",
        join_title: "Join the Network",
        proj_key_ref: "Key Reference Projects",
        proj_selected_from_supplier: "Selected projects from this supplier",
        join_desc:
          "Create your company profile. Verification usually takes 24 hours.",
        quote_title: "Request Quote",
        btn_submit: "SUBMIT APPLICATION",
        btn_send_quote: "SEND REQUEST",
        back: "BACK TO LIST",
        req_quote: "REQUEST QUOTE",
        sec_all: "All Sectors",
        sec_const: "Construction",
        sec_mine: "Mining",
        sec_energy: "Energy",
        sec_drill: "Drilling",
        sec_manu: "Manufacturing",
        sec_tech: "Technology",
        sec_logi: "Logistics",
        sec_equip: "Equipment",
        tab_overview: "OVERVIEW",
        tab_projects: "PROJECTS",
        tab_certs: "CERTIFICATES",
        certs_title: "Certifications & Compliance",
        certs_sub: "Declared certificates of this supplier",
        tab_assets: "ASSETS",
        lbl_services: "Core Services",
        th_item: "Item",
        th_specs: "Specs",
        th_status: "Status",
        btn_view: "INSPECT",
        results_label: "Results",
        live_db: "Live Database",
        how_title: "How BTrustOn Works",
        how_sub:
          "Create your company profile, verify your references and let your BTrustOn Scoreâ„¢ increase your visibility.",
        how_step1_title: "Create your profile",
        how_step1_desc:
          "Add your company details, sectors, core services, assets and project highlights.",
        how_step2_title: "Verify references",
        how_step2_desc:
          "Send verification requests to past clients and partners to build a verified track record.",
        how_step3_title: "Grow with Trust Scoreâ„¢",
        how_step3_desc:
          "Higher BTrustOn Scores mean higher visibility in search results and more qualified leads.",
        pricing_title: "Pricing for Industrial Networks",
        pricing_sub:
          "Start free, then upgrade as your company grows. Every plan includes a public profile and access to the BTrustOn Scoreâ„¢ framework.",
        price_free_tag: "For small teams getting started.",
        price_pro_tag: "For growth-focused industrial suppliers.",
        price_ent_tag: "For EPCs and global industrial groups.",
        price_month: "/month",
        price_free_1: "Public company profile",
        price_free_2: "Up to 3 listed services",
        price_free_3: "Basic BTrustOn Scoreâ„¢",
        price_pro_1: "Unlimited services & assets",
        price_pro_2: "Verified reference module",
        price_pro_3: "Priority ranking in search",
        price_pro_4: "Advanced Trust Scoreâ„¢ insights",
        price_ent_1: "Multi-user access & SSO",
        price_ent_2: "API access to supplier data",
        price_ent_3: "Dedicated success manager",
        price_ent_4: "Custom Trust Scoreâ„¢ models",
        btn_get_started: "GET STARTED",
        btn_choose_pro: "CHOOSE PRO",
        btn_contact_sales: "CONTACT SALES",
        badge_popular: "MOST POPULAR",
        top_title: "Top Verified Companies by Trust Score",
        top_sub: "Updated in real-time",
        score_info_main:
          "Calculated from verified references, delivery performance, company age and digital signals.",
        score_info_verify:
          "Verified data can increase your score and ranking.",
        field_company: "Company Name",
        field_sector: "Sector",
        field_city: "City",
        field_website: "Website",
        field_size: "Company Size",
        field_services: "Core Services / Focus",
        field_note: "Additional Notes",
        field_your_name: "Your Name",
        field_project: "Project Details",
        footer_rights: "All rights reserved.",
        footer_about: "About",
        footer_pricing: "Pricing",
        footer_privacy: "Privacy",
        footer_terms: "Terms",
      },
      tr: {
        hero_title:
          "AkÄ±llÄ± Kaynak. <br> <span class='text-transparent bg-clip-text bg-gradient-to-r from-BTrustOn-accent to-blue-600'>HÄ±zlÄ± Ã‡Ã¶zÃ¼m.</span>",
        hero_desc:
          "EndÃ¼striyel ÅŸirketleri tek ekranda toplayÄ±n; gÃ¶rÃ¼nÃ¼rlÃ¼klerini, gÃ¼ven skorlarÄ±nÄ± ve doÄŸrulanmÄ±ÅŸ referanslarÄ±nÄ± birlikte gÃ¶rÃ¼n.",
        search_ph:
         "Firma, ekipman ve hizmet ara...",
        btn_discover: "KEÅžFET",
        join: "AÄžA KATIL",
        asset_categories: "VarlÄ±k kategorileri:",
        proj_key_ref: "Ã–ne Ã‡Ä±kan Referans Projeler",
        proj_selected_from_supplier: "Bu tedarikÃ§iden seÃ§ilmiÅŸ projeler",
        join_title: "AÄŸa KatÄ±lÄ±n",
        join_desc:
          "Firma profilinizi oluÅŸturun. DoÄŸrulama genelde 24 saat sÃ¼rer.",
        quote_title: "Teklif Ä°ste",
        btn_submit: "BAÅžVURUYU GÃ–NDER",
        btn_send_quote: "TALEBÄ° GÃ–NDER",
        back: "LÄ°STEYE DÃ–N",
        req_quote: "TEKLÄ°F Ä°STE",
        sec_all: "TÃ¼m SektÃ¶rler",
        sec_const: "Ä°nÅŸaat",
        sec_mine: "Maden",
        sec_energy: "Enerji",
        sec_drill: "Sondaj",
        sec_manu: "Ãœretim",
        sec_tech: "Teknoloji",
        sec_logi: "Lojistik",
        sec_equip: "Ekipman",
        tab_certs: "SERTÄ°FÄ°KALAR",
        no_certs: "Bu tedarikÃ§i iÃ§in listelenen sertifika yok.",
        sec_energy: "Enerji",
        sec_drill: "Sondaj",
        sec_equip: "Ekipman",
        tab_certs: "SERTÄ°FÄ°KALAR",
        tab_overview: "GENEL BAKIÅž",
        tab_projects: "PROJELER",
        tab_assets: "VARLIKLAR",
        lbl_services: "Hizmetler",
        th_item: "Ekipman",
        th_specs: "Ã–zellik",
        th_status: "Durum",
        btn_view: "Ä°NCELE",
        results_label: "SonuÃ§",
        live_db: "CanlÄ± VeritabanÄ±",
        certs_title: "Sertifikalar ve Uyum",
        certs_sub: "Bu tedarikÃ§inin beyan ettiÄŸi sertifikalar",
        how_title: "BTrustOn NasÄ±l Ã‡alÄ±ÅŸÄ±r?",
        how_sub:
          "Firma profilinizi oluÅŸturun, referanslarÄ±nÄ±zÄ± doÄŸrulatÄ±n ve BTrustOn Scoreâ„¢ ile gÃ¶rÃ¼nÃ¼rlÃ¼ÄŸÃ¼nÃ¼zÃ¼ artÄ±rÄ±n.",
        how_step1_title: "Profilinizi oluÅŸturun",
        how_step1_desc:
          "Firma bilgilerinizi, sektÃ¶rlerinizi, temel hizmetlerinizi, varlÄ±klarÄ±nÄ±zÄ± ve Ã¶ne Ã§Ä±kan projelerinizi ekleyin.",
        how_step2_title: "ReferanslarÄ± doÄŸrulayÄ±n",
        how_step2_desc:
          "GeÃ§miÅŸ iÅŸ ortaklarÄ±nÄ±za doÄŸrulama isteÄŸi gÃ¶ndererek doÄŸrulanmÄ±ÅŸ bir geÃ§miÅŸ oluÅŸturun.",
        how_step3_title: "Trust Scoreâ„¢ ile bÃ¼yÃ¼yÃ¼n",
        how_step3_desc:
          "YÃ¼ksek BTrustOn Score, arama sonuÃ§larÄ±nda daha yÃ¼ksek gÃ¶rÃ¼nÃ¼rlÃ¼k ve daha nitelikli talepler demektir.",
        pricing_title: "EndÃ¼striyel AÄŸlar iÃ§in FiyatlandÄ±rma",
        pricing_sub:
          "Ãœcretsiz baÅŸlayÄ±n, ÅŸirketiniz bÃ¼yÃ¼dÃ¼kÃ§e yÃ¼kseltin. TÃ¼m paketlerde herkese aÃ§Ä±k profil ve BTrustOn Scoreâ„¢ altyapÄ±sÄ± dahildir.",
        price_free_tag: "Yeni baÅŸlayan kÃ¼Ã§Ã¼k ekipler iÃ§in.",
        price_pro_tag: "BÃ¼yÃ¼me odaklÄ± tedarikÃ§iler iÃ§in.",
        price_ent_tag: "EPC'ler ve global endÃ¼striyel gruplar iÃ§in.",
        price_month: "/ay",
        price_free_1: "Herkese aÃ§Ä±k firma profili",
        price_free_2: "En fazla 3 hizmet giriÅŸi",
        price_free_3: "Temel BTrustOn Scoreâ„¢",
        price_pro_1: "SÄ±nÄ±rsÄ±z hizmet ve varlÄ±k giriÅŸi",
        price_pro_2: "DoÄŸrulanmÄ±ÅŸ referans modÃ¼lÃ¼",
        price_pro_3: "Aramalarda Ã¶ncelikli sÄ±ralama",
        price_pro_4: "GeliÅŸmiÅŸ Trust Scoreâ„¢ iÃ§gÃ¶rÃ¼leri",
        price_ent_1: "Ã‡ok kullanÄ±cÄ±lÄ± eriÅŸim ve SSO",
        price_ent_2: "TedarikÃ§i verisine API eriÅŸimi",
        price_ent_3: "Ã–zel mÃ¼ÅŸteri yÃ¶neticisi",
        price_ent_4: "Kuruma Ã¶zel Trust Scoreâ„¢ modelleri",
        btn_get_started: "BAÅžLA",
        btn_choose_pro: "PRO PAKETÄ° SEÃ‡",
        btn_contact_sales: "SATIÅž ile Ä°LETÄ°ÅžÄ°ME GEÃ‡",
        badge_popular: "EN POPÃœLER",
        top_title: "Trust Score'a GÃ¶re Ã–ne Ã‡Ä±kan Firmalar",
        top_sub: "GerÃ§ek zamanlÄ± gÃ¼ncellenir",
        score_info_main:
          "DoÄŸrulanmÄ±ÅŸ referanslar, teslimat performansÄ±, ÅŸirket yaÅŸÄ± ve dijital sinyallerden hesaplanÄ±r.",
        score_info_verify:
          "DoÄŸrulanmÄ±ÅŸ veriler skorunuzu ve sÄ±ralamanÄ±zÄ± artÄ±rabilir.",
        field_company: "Firma AdÄ±",
        field_sector: "SektÃ¶r",
        field_city: "Åžehir",
        field_website: "Web Sitesi",
        field_size: "Firma BÃ¼yÃ¼klÃ¼ÄŸÃ¼",
        field_services: "Temel Hizmetler / Odak AlanÄ±",
        field_note: "Ek Notlar",
        field_your_name: "Ä°sminiz",
        field_project: "Proje DetaylarÄ±",
        footer_rights: "TÃ¼m haklarÄ± saklÄ±dÄ±r.",
        footer_about: "HakkÄ±nda",
        footer_pricing: "FiyatlandÄ±rma",
        footer_privacy: "Gizlilik",
        footer_terms: "Åžartlar",
      },
    };

    let currentLang = "en";
    let currentSector = "all";
    let selectedCompany = null;

    // Top band animasyon & canlÄ± gÃ¶rÃ¼nÃ¼m iÃ§in
    let topCompaniesOrder = [];
    let topScrollInterval = null;
    let topRotateInterval = null;

    // Ana grid iÃ§in hafif "canlÄ±lÄ±k" (boÅŸ aramada hafif shuffle)
    let gridShuffleInterval = null;

    // *** DATABASE: TAM LÄ°STE ***
    const database = [
      {
        id: 101,
        name: "RÃ¶nesans Holding",
        city: "Ankara, TR",
        sector: "construction",
        type: "contractor",
        trust: "global",
        meta: {
          references: 96,
          delivery: 94,
          years: 90,
          financial: 92,
          digital: 85,
        },
        desc:
          "Global contractor in large-scale infrastructure, industrial and healthcare projects.",
        desc_tr:
          "BÃ¼yÃ¼k Ã¶lÃ§ekli altyapÄ±, endÃ¼striyel tesis ve saÄŸlÄ±k projelerinde faaliyet gÃ¶steren global yÃ¼klenici.",
        services: ["EPC Contracts", "Healthcare Projects", "Industrial Facilities"],
        services_tr: ["EPC SÃ¶zleÅŸmeleri", "SaÄŸlÄ±k Projeleri", "EndÃ¼striyel Tesisler"],
        certificates: ["ISO 9001:2015", "ISO 14001:2015", "ISO 45001:2018", "LEED Platinum"],
        projects: [
          {
            title: "Yamal LNG",
            title_tr: "Yamal LNG",
            loc: "Russia",
            loc_tr: "Rusya",
            desc: "Mega-scale LNG plant project in the Arctic region.",
            desc_tr: "Arktik bÃ¶lgede mega Ã¶lÃ§ekli LNG tesis projesi.",
          },
        ],
        assets: [
          {
            type: "Tower Crane Fleet",
            type_tr: "Kule vinÃ§ filosu",
            spec: "Liebherr & Terex, >30 units",
            spec_tr: "Liebherr & Terex, 30+ Ã¼nite",
            status: "Available",
            status_tr: "MÃ¼sait",
          },
        ],
      },
      {
        id: 102,
        name: "Bechtel Corporation",
        city: "USA",
        sector: "construction",
        type: "contractor",
        trust: "global",
        meta: {
          references: 98,
          delivery: 96,
          years: 95,
          financial: 95,
          digital: 88,
        },
        desc:
          "US-based engineering and construction company delivering complex megaprojects worldwide.",
        desc_tr:
          "DÃ¼nya genelinde karmaÅŸÄ±k mega projeler gerÃ§ekleÅŸtiren ABD merkezli mÃ¼hendislik ve inÅŸaat ÅŸirketi.",
        certificates: ["ASME N-Stamp", "ISO 9001", "ISO 14001", "OSHA VPP Star"],
        services: ["Nuclear Power", "Infrastructure EPC", "Rail & Transit"],
        services_tr: [
          "NÃ¼kleer enerji santralleri",
          "AltyapÄ± EPC projeleri",
          "Demiryolu ve ulaÅŸÄ±m projeleri",
        ],
        projects: [
          {
            title: "Hoover Dam",
            title_tr: "Hoover BarajÄ±",
            loc: "USA",
            loc_tr: "ABD",
            desc: "Iconic hydroelectric dam and infrastructure project.",
            desc_tr: "Ä°konik hidroelektrik baraj ve altyapÄ± projesi.",
          },
        ],
        assets: [],
      },
      {
        id: 103,
        name: "Rio Tinto",
        city: "UK/AUS",
        sector: "mining",
        type: "operator",
        trust: "global",
        meta: {
          references: 97,
          delivery: 94,
          years: 95,
          financial: 96,
          digital: 82,
        },
        desc:
          "Global mining corporation with diversified portfolio across iron ore, copper and more.",
        desc_tr:
          "Demir cevheri, bakÄ±r ve diÄŸer emtialarda Ã§eÅŸitlendirilmiÅŸ portfÃ¶ye sahip global madencilik ÅŸirketi.",
        services: ["Copper Operations", "Iron Ore", "Project Development"],
        services_tr: ["BakÄ±r iÅŸletmeleri", "Demir cevheri", "Proje geliÅŸtirme"],
        certificates: ["The Copper Mark", "ICMM Member", "ISO 14001", "TSM Protocol"],
        projects: [
          {
            title: "Oyu Tolgoi",
            title_tr: "Oyu Tolgoi",
            loc: "Mongolia",
            loc_tr: "MoÄŸolistan",
            desc: "World-class copper-gold mine development.",
            desc_tr: "DÃ¼nya Ã¶lÃ§eÄŸinde bakÄ±r-altÄ±n madeni geliÅŸtirme projesi.",
          },
        ],
        assets: [],
      },
      {
        id: 104,
        name: "Schlumberger",
        city: "USA/FR",
        sector: "drilling",
        type: "tech",
        trust: "global",
        meta: {
          references: 94,
          delivery: 93,
          years: 90,
          financial: 92,
          digital: 90,
        },
        desc:
          "Technology leader in oilfield services, digital solutions and subsurface data.",
        desc_tr:
          "Sondaj ve petrol sahasÄ± hizmetleri, dijital Ã§Ã¶zÃ¼mler ve yeraltÄ± verilerinde teknoloji lideri.",
        services: ["Directional Drilling", "Digital Oilfield", "Well Logging"],
        services_tr: [
          "YÃ¶nlÃ¼ sondaj hizmetleri",
          "Dijital petrol sahasÄ± Ã§Ã¶zÃ¼mleri",
          "Kuyu loglama hizmetleri",
        ],
        certificates: ["API Spec Q1", "API Spec Q2", "ISO 27001", "ISO 14001"],
        projects: [],
        assets: [],
      },
      {
        id: 105,
        name: "Demir Export",
        city: "Ankara, TR",
        sector: "mining",
        type: "operator",
        trust: "verified",
        meta: {
          references: 90,
          delivery: 88,
          years: 85,
          financial: 86,
          digital: 75,
        },
        desc:
          "Turkish mining operator focused on gold, iron and base metals.",
        desc_tr:
          "AltÄ±n, demir ve baz metaller odaklÄ± faaliyet gÃ¶steren TÃ¼rk madencilik ÅŸirketi.",
        services: ["Gold Mining", "Iron Ore", "Feasibility & Development"],
        services_tr: [
          "AltÄ±n madenciliÄŸi",
          "Demir cevheri Ã¼retimi",
          "Fizibilite ve geliÅŸtirme",
        ],
        certificates: ["ISO 50001", "ISO 14001", "ISO 45001", "Gold Standard"],
        projects: [
          {
            title: "BakÄ±rtepe",
            title_tr: "BakÄ±rtepe",
            loc: "Sivas, TR",
            loc_tr: "Sivas, TÃ¼rkiye",
            desc: "Gold mine operation and development.",
            desc_tr: "AltÄ±n madeni iÅŸletmesi ve geliÅŸtirme projesi.",
          },
        ],
        assets: [],
      },
      {
        id: 106,
        name: "Siemens Energy",
        city: "Germany",
        sector: "energy",
        type: "tech",
        trust: "verified",
        meta: {
          references: 95,
          delivery: 93,
          years: 92,
          financial: 94,
          digital: 88,
        },
        desc:
          "Energy technology company delivering turbines, grid solutions and services.",
        desc_tr:
          "TÃ¼rbinler, ÅŸebeke Ã§Ã¶zÃ¼mleri ve servis hizmetleri sunan enerji teknolojileri ÅŸirketi.",
        services: ["Gas Turbines", "Grid Solutions", "Service & Maintenance"],
        services_tr: [
          "Gaz tÃ¼rbinleri",
          "Åžebeke Ã§Ã¶zÃ¼mleri",
          "Servis ve bakÄ±m hizmetleri",
        ],
        certificates: ["ISO 50001", "ISO 27001", "IEC 62443", "ISO 9001"],
        projects: [],
        assets: [],
      },
      {
        id: 107,
        name: "Borusan CAT",
        city: "Istanbul, TR",
        sector: "equipment",
        type: "manufacturer",
        trust: "verified",
        meta: {
          references: 92,
          delivery: 90,
          years: 88,
          financial: 87,
          digital: 80,
        },
        desc:
          "Authorized CAT dealer for heavy equipment sales, rental and service.",
        desc_tr:
          "AÄŸÄ±r iÅŸ makineleri satÄ±ÅŸ, kiralama ve servisinde yetkili CAT distribÃ¼tÃ¶rÃ¼.",
        services: ["Equipment Sales", "Rental Fleet", "After-Sales Service"],
        services_tr: [
          "Makina satÄ±ÅŸÄ±",
          "Kiralama filosu",
          "SatÄ±ÅŸ sonrasÄ± servis",
        ],
        certificates: ["Caterpillar 5-Star Dealer", "ISO 9001", "ISO 27001", "ISO 14001"],
        projects: [],
        assets: [
          {
            type: "CAT Excavator Fleet",
            type_tr: "CAT ekskavatÃ¶r filosu",
            spec: "CAT 336 / 352",
            spec_tr: "CAT 336 / 352",
            status: "In Stock",
            status_tr: "Stokta",
          },
        ],
      },
      {
        id: 108,
        name: "OrtadoÄŸu Sondaj",
        city: "Ankara, TR",
        sector: "drilling",
        type: "contractor",
        trust: "emerging",
        meta: {
          references: 88,
          delivery: 86,
          years: 82,
          financial: 80,
          digital: 72,
        },
        desc:
          "Drilling contractor specialized in core drilling and geothermal exploration.",
        desc_tr:
          "Karot sondajÄ± ve jeotermal arama projelerinde uzman sondaj yÃ¼klenicisi.",
        services: ["Core Drilling", "Geothermal Wells", "Exploration Support"],
        services_tr: [
          "Karot sondajÄ±",
          "Jeotermal kuyu aÃ§ma",
          "Arama saha desteÄŸi",
        ],
        certificates: ["ISO 9001:2015", "ISO 14001:2015", "OHSAS 18001"],
        projects: [],
        assets: [],
      },
      {
        id: 109,
        name: "Enka Ä°nÅŸaat",
        city: "Istanbul, TR",
        sector: "construction",
        type: "contractor",
        trust: "global",
        meta: {
          references: 97,
          delivery: 95,
          years: 93,
          financial: 94,
          digital: 86,
        },
        desc:
          "Engineering and construction company active in power, infrastructure and industrial plants.",
        desc_tr:
          "Enerji santralleri, altyapÄ± ve endÃ¼striyel tesis projelerinde faaliyet gÃ¶steren mÃ¼hendislik ve inÅŸaat ÅŸirketi.",
        services: ["Power Plants", "Infrastructure EPC", "Industrial Projects"],
        services_tr: [
          "Enerji santrali projeleri",
          "AltyapÄ± EPC projeleri",
          "EndÃ¼striyel tesis projeleri",
        ],
        certificates: ["ASME S/U/PP Stamps", "ISO 9001", "ISO 14001", "OHSAS 18001"],
        projects: [],
        assets: [],
      },
      {
        id: 110,
        name: "Sandvik Mining",
        city: "Sweden",
        sector: "equipment",
        type: "manufacturer",
        trust: "premium",
        meta: {
          references: 95,
          delivery: 93,
          years: 91,
          financial: 92,
          digital: 84,
        },
        desc:
          "Manufacturer of mining equipment including crushers and underground drills.",
        desc_tr:
          "KÄ±rÄ±cÄ±lar ve yeraltÄ± delici makineler dahil madencilik ekipmanlarÄ± Ã¼reticisi.",
        services: ["Crushers", "Underground Drills", "OEM Parts"],
        services_tr: [
          "KÄ±rÄ±cÄ± ekipmanlar",
          "YeraltÄ± delici makineler",
          "Orijinal yedek parÃ§a (OEM)",
        ],
        certificates: ["ISO 9001", "CE Marking", "EcoVadis Gold", "ISO 45001"],
        projects: [],
        assets: [],
      },
      {
        id: 111,
        name: "HÄ°DROMEK",
        city: "Ankara, TR",
        sector: "equipment",
        type: "manufacturer",
        trust: "verified",
        meta: {
          references: 90,
          delivery: 88,
          years: 86,
          financial: 85,
          digital: 78,
        },
        desc:
          "Construction machinery manufacturer with backhoe loaders and motor graders.",
        desc_tr:
          "KazÄ±cÄ± yÃ¼kleyici ve greyder Ã¼retiminde uzman inÅŸaat makinalarÄ± Ã¼reticisi.",
        services: ["Backhoe Loaders", "Motor Graders", "Excavators"],
        services_tr: [
          "KazÄ±cÄ± yÃ¼kleyiciler",
          "Greyderler",
          "EkskavatÃ¶rler",
        ],
        certificates: ["ISO 9001", "TSE-ISO-EN 9000", "Turquality"],
        projects: [],
        assets: [],
      },
// const database = [ dizisinin iÃ§ine, diÄŸer ÅŸirketlerin altÄ±na virgÃ¼l koyup bunlarÄ± ekle:

      {
        id: 112,
        name: "ABB Industrial",
        city: "Zurich, CH",
        sector: "technology",  // YENÄ° SEKTÃ–R
        type: "tech",
        trust: "global",
        meta: { references: 96, delivery: 95, years: 98, financial: 94, digital: 92 },
        desc: "Industrial automation, robotics and electrification technology leader.",
        services: ["Robotics", "Automation", "Electrification"],
        certificates: ["ISO 9001", "ISO 14001", "IEC 62443"],
        projects: [],
        assets: []
      },
      {
        id: 113,
        name: "Kuehne+Nagel",
        city: "Hamburg, DE",
        sector: "logistics", // YENÄ° SEKTÃ–R
        type: "service",
        trust: "global",
        meta: { references: 94, delivery: 98, years: 95, financial: 92, digital: 88 },
        desc: "Global transport and logistics company specialized in sea and air freight.",
        services: ["Project Logistics", "Sea Freight", "Heavy Lift Transport"],
        certificates: ["ISO 9001", "AEO Status", "IATA Agent"],
        projects: [],
        assets: []
      },
      {
        id: 114,
        name: "ArcelorMittal",
        city: "Luxembourg",
        sector: "manufacturing", // YENÄ° SEKTÃ–R
        type: "manufacturer",
        trust: "global",
        meta: { references: 95, delivery: 92, years: 94, financial: 90, digital: 85 },
        desc: "The world's leading steel and mining company.",
        services: ["Steel Production", "Mining", "R&D"],
        certificates: ["IATF 16949", "ISO 14001", "ResponsibleSteel"],
        projects: [],
        assets: []
      },
    ];

    function t(key) {
      return translations[currentLang][key] || translations.en[key] || "";
    }

    function computeScore(meta) {
      const sum =
        meta.references +
        meta.delivery +
        meta.years +
        meta.financial +
        meta.digital;
      return Math.round(sum / 5);
    }

    function getTrustBadge(company) {
      const trust = company.trust || "verified";
      let label = "";
      let classes =
        "bg-gray-100 text-gray-700 border border-gray-200";

      if (trust === "global") {
        label = "Global Partner";
        classes = "bg-blue-50 text-blue-800 border border-blue-200";
      } else if (trust === "premium") {
        label = "Premium Verified";
        classes = "bg-purple-50 text-purple-800 border border-purple-200";
      } else if (trust === "verified") {
        label = "Verified Partner";
        classes = "bg-emerald-50 text-emerald-800 border border-emerald-200";
      } else if (trust === "emerging") {
        label = "Emerging Partner";
        classes = "bg-amber-50 text-amber-800 border border-amber-200";
      }

      return `
        <span class="${classes} text-[11px] font-bold px-3 py-1 rounded-full flex items-center gap-1">
          <i class="fa-solid fa-shield-halved text-[10px]"></i>
          <span>${label}</span>
        </span>
      `;
    }

// ðŸ‘‡ YENÄ° FONKSÄ°YON: Åžirket Tipine GÃ¶re Rozet Ãœretir ðŸ‘‡
    function getCompanyTypeBadge(rawType) {
      const type = (rawType || "company").toLowerCase();
      let label = rawType;
      let icon = "fa-building";
      let colorClass = "bg-gray-50 text-gray-500 border-gray-200";

      // Tiplere gÃ¶re renk ve ikon ayarlarÄ±
      if (type.includes("manufacturer") || type.includes("Ã¼retici")) {
        label = "Manufacturer";
        icon = "fa-industry";
        colorClass = "bg-purple-50 text-purple-700 border-purple-100";
      } else if (type.includes("contractor") || type.includes("yÃ¼klenici")) {
        label = "Contractor";
        icon = "fa-helmet-safety";
        colorClass = "bg-orange-50 text-orange-700 border-orange-100";
      } else if (type.includes("distributor") || type.includes("supplier") || type.includes("tedarikÃ§i")) {
        label = "Distributor / Supplier";
        icon = "fa-truck-ramp-box";
        colorClass = "bg-indigo-50 text-indigo-700 border-indigo-100";
      } else if (type.includes("tech") || type.includes("software")) {
        label = "Tech & Service";
        icon = "fa-microchip";
        colorClass = "bg-blue-50 text-blue-700 border-blue-100";
      } else if (type.includes("operator") || type.includes("mining")) {
        label = "Operator";
        icon = "fa-gem";
        colorClass = "bg-emerald-50 text-emerald-700 border-emerald-100";
      }

      // TR desteÄŸi (Ä°sterseniz burayÄ± geniÅŸletebiliriz)
      if (currentLang === "tr") {
          if(label === "Manufacturer") label = "Ãœretici";
          if(label === "Contractor") label = "YÃ¼klenici";
          if(label === "Distributor / Supplier") label = "TedarikÃ§i / DistribÃ¼tÃ¶r";
          if(label === "Tech & Service") label = "Teknoloji & Servis";
          if(label === "Operator") label = "Ä°ÅŸletmeci";
      }

      return `
        <span class="inline-flex items-center gap-1.5 px-2 py-0.5 rounded-md text-[10px] font-bold border ${colorClass} uppercase tracking-wide">
           <i class="fa-solid ${icon}"></i> ${label}
        </span>
      `;
    }

    function getScoreLabel(score) {
      if (currentLang === "tr") {
        if (score >= 95) return "MÃœKEMMEL";
        if (score >= 90) return "GÃœÃ‡LÃœ";
        if (score >= 80) return "SAÄžLAM";
        return "GELÄ°ÅžMEKTE";
      } else {
        if (score >= 95) return "EXCELLENT";
        if (score >= 90) return "STRONG";
        if (score >= 80) return "SOLID";
        return "GROWING";
      }
    }

    function sectorToTr(sector) {
      if (currentLang === "en") {
        // Ä°ngilizce modda baÅŸ harfi bÃ¼yÃ¼tÃ¼p dÃ¶ndÃ¼rÃ¼r
        if (sector === "manufacturing") return "Manufacturing";
        if (sector === "technology") return "Technology";
        if (sector === "logistics") return "Logistics";
        return sector.charAt(0).toUpperCase() + sector.slice(1);
      }
      
      // TÃ¼rkÃ§e mod iÃ§in karÅŸÄ±lÄ±klar
      if (sector === "construction") return "Ä°nÅŸaat";
      if (sector === "mining") return "Maden";
      if (sector === "energy") return "Enerji";
      if (sector === "drilling") return "Sondaj";
      if (sector === "equipment") return "Ekipman";
      if (sector === "manufacturing") return "Ãœretim & Sanayi";
      if (sector === "technology") return "Teknoloji";
      if (sector === "logistics") return "Lojistik";
      
      return sector;
    }

    function applyTranslations() {
      document.querySelectorAll("[data-i18n]").forEach((el) => {
        const key = el.getAttribute("data-i18n");
        if (!key) return;
        const value = t(key);
        if (value) {
          el.innerHTML = value;
        }
      });

      const heroTitle = document.getElementById("hero-title");
      const heroDesc = document.getElementById("hero-desc");
      if (heroTitle) heroTitle.innerHTML = t("hero_title");
      if (heroDesc) heroDesc.innerHTML = t("hero_desc");

      const searchInput = document.getElementById("search-input");
      if (searchInput) searchInput.placeholder = t("search_ph");

      const yearSpan = document.getElementById("year-span");
      if (yearSpan) yearSpan.textContent = new Date().getFullYear().toString();
    }

    // TOP COMPANIES BAND

    // TOP COMPANIES (AKILLI ROTASYON MANTIÄžI)
    function initTopCompaniesOrder() {
      // 1. ADIM: HAVUZU OLUÅžTUR (Kriterlere uyan herkesi al)
      let qualifiedCompanies = database.filter(company => {
          const score = computeScore(company.meta);
          
          // Kriter 1: PuanÄ± 80 ve Ã¼zeri olsun (BarajÄ± biraz esnetebiliriz)
          if (score < 80) return false;

          // Kriter 2: StatÃ¼sÃ¼ gÃ¼venilir olsun
          const validTrustLevels = ["verified", "premium", "global"];
          if (!validTrustLevels.includes(company.trust)) return false;

          return true; 
      });

      // GÃ¼venlik Ã–nlemi: EÄŸer veritabanÄ± Ã§ok yeniyse ve kimse kriteri geÃ§emediyse,
      // vitrin boÅŸ kalmasÄ±n diye en yÃ¼ksek puanlÄ±larÄ± mecburen al.
      if (qualifiedCompanies.length < 5) {
         qualifiedCompanies = [...database].sort((a, b) => computeScore(b.meta) - computeScore(a.meta));
      }

      // 2. ADIM: KARIÅžTIR (SHUFFLE)
      // Bu sayede her sayfa yenilemede farklÄ± firmalar ÅŸans bulur.
      qualifiedCompanies.sort(() => Math.random() - 0.5);

      // 3. ADIM: LÄ°MÄ°TLE (Performans Ä°Ã§in)
      // Havuzda 1000 kiÅŸi olsa bile o an sadece ÅŸanslÄ± 30 kiÅŸiyi gÃ¶ster.
      // Bir sonraki giren kiÅŸi diÄŸer 30'u gÃ¶recek.
      topCompaniesOrder = qualifiedCompanies.slice(0, 30);
    }

function renderTopCompanies() {
      const container = document.getElementById("top-companies");
      if (!container) return;
      container.innerHTML = "";

      if (!topCompaniesOrder.length) {
        initTopCompaniesOrder();
      }

      // AKILLI LÄ°STELEME MANTIÄžI:
      // EÄŸer veritabanÄ±nda az ÅŸirket varsa (10'dan az), ekran dolsun ve animasyon aksÄ±n diye listeyi Ã§oÄŸaltÄ±yoruz.
      // EÄŸer zaten Ã§ok ÅŸirket varsa, sistemi yormamak iÃ§in olduÄŸu gibi bÄ±rakÄ±yoruz.
      let topList;
      if (topCompaniesOrder.length < 10) {
         const baseTop = topCompaniesOrder.slice(0, 5); // En iyi 5 ÅŸirketi al
         topList = [...baseTop, ...baseTop, ...baseTop, ...baseTop]; // 4 kere arka arkaya ekle
      } else {
         topList = topCompaniesOrder.slice(0, 20); // Zaten Ã§ok varsa ilk 20 tanesi yeter
      }

      topList.forEach((company) => {
        const score = computeScore(company.meta);
        const desc =
          currentLang === "tr" && company.desc_tr
            ? company.desc_tr
            : company.desc;

        const card = document.createElement("button");
        // Mobilde ve PC'de dÃ¼zgÃ¼n durmasÄ± iÃ§in geniÅŸlik ayarÄ±
        card.className =
          "min-w-[260px] bg-slate-900 text-white rounded-xl px-4 py-3 flex flex-col justify-between shadow-md hover:shadow-lg hover:-translate-y-0.5 transition transform border border-slate-700/50";
        card.onclick = () => openProfile(company.id);

        card.innerHTML = `
          <div class="flex items-center justify-between mb-1.5">
            <span class="text-[13px] font-bold line-clamp-1 text-cyan-50">
              ${company.name}
            </span>
            <span class="text-[11px] font-semibold bg-cyan-900/50 text-cyan-200 px-2 py-0.5 rounded-full border border-cyan-800">
              ${score}
            </span>
          </div>
          <p class="text-[11px] text-slate-400 line-clamp-2 mb-2 text-left font-light leading-relaxed">
            ${desc}
          </p>
          <div class="flex items-center justify-between mt-auto w-full">
            <span class="flex items-center gap-1.5 text-[10px] text-slate-500">
              <i class="fa-solid fa-location-dot"></i>
              <span class="line-clamp-1 max-w-[80px]">${company.city}</span>
            </span>
            <span class="text-[10px] font-bold text-emerald-400 flex items-center gap-1">
              <div class="w-1.5 h-1.5 rounded-full bg-emerald-500 animate-pulse"></div>
              ${getScoreLabel(score)}
            </span>
          </div>
        `;
        container.appendChild(card);
      });
    }

    function rotateTopCompanies() {
      if (!topCompaniesOrder.length) return;
      const first = topCompaniesOrder.shift();
      topCompaniesOrder.push(first);
      renderTopCompanies();
    }

    function startTopAnimations() {
      const container = document.getElementById("top-companies");
      if (!container) return;

      if (topScrollInterval) clearInterval(topScrollInterval);
      if (topRotateInterval) clearInterval(topRotateInterval);

      // AKIÅž HIZI AYARI BURADA:
      // 20 = Ã‡ok HÄ±zlÄ± | 30 = Ä°deal/AkÄ±cÄ± | 50 = YavaÅŸ
      const speed = 30; 

      topScrollInterval = setInterval(() => {
        if (!container) return;
        container.scrollLeft += 1; // Her seferinde 1 piksel kaydÄ±r
        
        // Sona geldiyse baÅŸa sar (Sonsuz dÃ¶ngÃ¼ hissi)
        if (
          container.scrollLeft >=
          container.scrollWidth - container.clientWidth - 1
        ) {
          container.scrollLeft = 0;
        }
      }, speed); // <-- HÄ±z deÄŸiÅŸkenini buraya verdik

      // KartlarÄ±n iÃ§indeki verileri (Skor, Ä°sim vb.) belirli aralÄ±klarla karÄ±ÅŸtÄ±rÄ±p canlÄ±lÄ±k katmak iÃ§in:
      topRotateInterval = setInterval(() => {
        rotateTopCompanies();
      }, 10000); // 10 saniyede bir veri yenileme (Bu kalabilir)
    }

    // MAIN GRID

    function renderCards(searchQuery = "") {
      const container = document.getElementById("card-container");
      const resultCount = document.getElementById("result-count");
      if (!container) return;
      container.innerHTML = "";

      const query = (searchQuery || "").toLowerCase().trim();

      let filtered = database.filter((company) => {
        if (currentSector !== "all" && company.sector !== currentSector) {
          return false;
        }

        if (!query) return true;

        const desc =
          currentLang === "tr" && company.desc_tr
            ? company.desc_tr
            : company.desc;

        const services =
          currentLang === "tr" && company.services_tr
            ? company.services_tr
            : company.services;

        const haystack = [
          company.name,
          company.city,
          company.sector,
          desc,
          ...(services || []),
        ]
          .join(" ")
          .toLowerCase();

        return haystack.includes(query);
      });

      if (resultCount) {
        resultCount.textContent = `${filtered.length} ${t("results_label")}`;
      }

      if (filtered.length === 0) {
        const empty = document.createElement("div");
        empty.className =
          "col-span-full text-center text-sm text-gray-500";
        empty.textContent =
          currentLang === "tr"
            ? "Kriterlere uygun firma bulunamadÄ±."
            : "No companies match the selected filters.";
        container.appendChild(empty);
        return;
      }

      filtered.forEach((company) => {
        const score = computeScore(company.meta);
        const desc =
          currentLang === "tr" && company.desc_tr
            ? company.desc_tr
            : company.desc;

        const services =
          currentLang === "tr" && company.services_tr
            ? company.services_tr
            : company.services;

        const card = document.createElement("div");
        card.className =
          "bg-white/90 border border-gray-100 rounded-2xl p-5 shadow-glass flex flex-col justify-between hover:border-BTrustOn-accent hover:shadow-lg hover:-translate-y-1 transition cursor-pointer";
        card.onclick = () => openProfile(company.id);

        card.innerHTML = `
          <div class="flex items-start justify-between gap-2 mb-3">
            <div>
              <h3 class="text-sm font-bold text-BTrustOn-primary mb-0.5 line-clamp-1">
                ${company.name}
              </h3>
              <p class="text-[11px] text-gray-400 mb-1 line-clamp-1">
                ${company.city}
              </p>
            </div>
            <div class="text-right">
              <div class="text-xs font-header font-bold text-BTrustOn-primary leading-none">
                ${score}<span class="text-[10px] text-gray-400">/100</span>
              </div>
              <div class="text-[10px] text-emerald-500 font-semibold mt-0.5">
                ${getScoreLabel(score)}
              </div>
            </div>
          </div>
          <p class="text-xs text-gray-600 mb-3 line-clamp-3">
            ${desc}
          </p>
          <div class="flex flex-wrap gap-1.5 mb-3">
            ${(services || [])
              .slice(0, 3)
              .map(
                (s) => `
              <span class="text-[10px] px-2 py-1 rounded-full bg-slate-50 border border-slate-200 text-slate-600">
                ${s}
              </span>
            `
              )
              .join("")}
          </div>
          <div class="flex items-center justify-between mt-auto pt-2 border-t border-slate-100">
            <div class="flex items-center gap-2">
              ${getTrustBadge(company)}
            </div>
            <button
              class="text-[11px] font-bold text-BTrustOn-accent flex items-center gap-1"
              type="button"
            >
              <span>${t("btn_view")}</span>
              <i class="fa-solid fa-arrow-right text-[10px]"></i>
            </button>
          </div>
        `;
        container.appendChild(card);
      });
    }

    // Hafif "canlÄ±lÄ±k": sadece default durumda (tÃ¼m sektÃ¶rler + boÅŸ arama) diziyi shuffle et
    function startGridShuffle() {
      const searchInput = document.getElementById("search-input");

      if (gridShuffleInterval) clearInterval(gridShuffleInterval);

      gridShuffleInterval = setInterval(() => {
        if (!searchInput) return;
        const query = (searchInput.value || "").trim();
        if (query !== "" || currentSector !== "all") {
          return; // kullanÄ±cÄ± filtre kullanÄ±yorsa karÄ±ÅŸmasÄ±n
        }

        // Rastgele hafif karÄ±ÅŸtÄ±r
        database.sort(() => Math.random() - 0.5);
        renderCards("");
      }, 15000); // 15 sn'de bir hafif deÄŸiÅŸim
    }

function filterSector(sector, btnEl) {
      currentSector = sector;

      // 1. ButonlarÄ±n renklerini sÄ±fÄ±rla/ayarla
      document.querySelectorAll(".filter-btn").forEach((btn) => {
        btn.classList.remove("border-BTrustOn-accent", "bg-BTrustOn-accent/10", "text-BTrustOn-accent", "shadow-glow");
        btn.classList.add("border-gray-300", "bg-transparent", "text-gray-500");
      });

      // TÄ±klanan butonu boya
      if (btnEl) {
        btnEl.classList.remove("border-gray-300", "bg-transparent", "text-gray-500");
        btnEl.classList.add("border-BTrustOn-accent", "bg-BTrustOn-accent/10", "text-BTrustOn-accent", "shadow-glow");
      }

      // 2. Arama ve Listeleme MantÄ±ÄŸÄ±
      const searchInput = document.getElementById("search-input");
      const value = searchInput ? searchInput.value : "";
      
      if (sector === "all" && value.trim() === "") {
          isSearchActive = false;
          renderShowcase();
      } else {
          isSearchActive = true;
          renderSearchResults(value);
      }

      // 3. ðŸ‘‡ AÅžAÄžI KAYDIRMA KODU (YENÄ° EKLENDÄ°) ðŸ‘‡
      // SonuÃ§larÄ±n olduÄŸu ana kÄ±sma yumuÅŸakÃ§a in
      const mainSection = document.querySelector("main");
      if(mainSection) {
          // Biraz gecikmeli yapÄ±yoruz ki Ã¶nce filtreleme iÅŸlemi bitsin, gÃ¶z yormasÄ±n
          setTimeout(() => {
              mainSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
          }, 100);
      }
    }
    // Status badge renkleri (Available / Under Maintenance / Out of Service)
    function getStatusBadge(baseStatusRaw, displayStatus) {
      const base = (baseStatusRaw || "").toLowerCase();
      const disp = (displayStatus || baseStatusRaw || "").toLowerCase();

      let classes = "bg-slate-50 text-slate-600";

      // Available / MÃ¼sait â†’ YeÅŸil
      if (base.includes("available") || disp.includes("mÃ¼sait")) {
        classes = "bg-emerald-50 text-emerald-700";
      }
      // Under Maintenance / bakÄ±m â†’ SarÄ±
      else if (
        base.includes("maintenance") ||
        base.includes("maint") ||
        disp.includes("bakÄ±m")
      ) {
        classes = "bg-amber-50 text-amber-700";
      }
      // Out of Service / Servis dÄ±ÅŸÄ± â†’ KÄ±rmÄ±zÄ±
      else if (
        base.includes("out of service") ||
        base.includes("oos") ||
        disp.includes("servis dÄ±ÅŸÄ±")
      ) {
        classes = "bg-rose-50 text-rose-700";
      }

      const label = displayStatus || baseStatusRaw || "";

      return `
        <span class="inline-flex items-center px-2 py-1 rounded-full text-[10px] font-semibold ${classes}">
          ${label}
        </span>
      `;
    }

    // --- CERTIFICATES (Dynamic) ---
    // --- CERTIFICATES (Dynamic with Edit/Delete) ---
    // --- CERTIFICATES (GÃœNCELLENMÄ°Åž TASARIM - KUTULU BUTONLAR) ---
    function renderCertificates(company) {
      const certList = document.getElementById("p-certs-list");
      const btnAddCert = document.getElementById("btn-add-cert");
      const myId = localStorage.getItem("BTrustOn_my_company_id");
      const isOwner = (myId && String(company.id) === String(myId));

      // Ekle butonu kontrolÃ¼
      if (btnAddCert) {
         if (isOwner) btnAddCert.classList.remove("hidden-view");
         else btnAddCert.classList.add("hidden-view");
      }

      if (!certList) return;
      certList.innerHTML = "";

      const certs = company.certificates || [];

      if (certs.length === 0) {
        certList.innerHTML = `
          <div class="col-span-2 bg-white border border-gray-200 rounded-xl p-8 text-center text-gray-400 text-xs italic">
            ${t("no_certs")}
          </div>`;
        return;
      }

      certs.forEach((cert, index) => {
        // Veri yapÄ±sÄ± kontrolÃ¼
        let name = "";
        let issuer = "";
        let id = null;

        if (typeof cert === 'string') {
            name = cert;
            id = index;
        } else {
            name = cert.name;
            issuer = cert.issuer || "";
            id = cert.id;
        }

        // DÃ¼zenleme ButonlarÄ± (GÃœNCELLENEN KISIM BURASI)
        let actionBtns = "";
        if(isOwner) {
            actionBtns = `
              <div class="flex gap-2 ml-auto pl-3 border-l border-gray-100 items-center">
                <button onclick="openCertModal(${typeof cert === 'object' ? id : -1})" class="w-7 h-7 rounded-lg bg-cyan-50 text-BTrustOn-accent hover:bg-BTrustOn-accent hover:text-white flex items-center justify-center transition" title="Edit">
                    <i class="fa-solid fa-pen text-[10px]"></i>
                </button>
                
                <button onclick="deleteCert(${typeof cert === 'object' ? id : -1}, '${name}')" class="w-7 h-7 rounded-lg bg-red-50 text-red-500 hover:bg-red-500 hover:text-white flex items-center justify-center transition" title="Delete">
                    <i class="fa-solid fa-trash text-[10px]"></i>
                </button>
              </div>
            `;
        }

        certList.innerHTML += `
          <div class="bg-white border border-gray-200 rounded-xl p-4 shadow-sm flex items-center gap-3 hover:shadow-md transition group">
            <div class="w-10 h-10 rounded-lg bg-cyan-50 flex items-center justify-center shrink-0 border border-cyan-100">
               <i class="fa-solid fa-award text-cyan-600 text-lg"></i>
            </div>
            <div class="flex-grow">
              <div class="text-BTrustOn-primary font-bold text-sm leading-tight">
                ${name}
              </div>
              ${issuer ? `<div class="text-[10px] text-gray-400 mt-0.5">${issuer}</div>` : ''}
            </div>
            ${actionBtns}
          </div>`;
      });
    }

    function openProfile(companyId) {
      const company = database.find((c) => c.id === companyId);
      if (!company) return;
      selectedCompany = company;

      const viewDashboard = document.getElementById("view-dashboard");
      const viewProfile = document.getElementById("view-profile");
      const viewEditor = document.getElementById("view-editor"); // Editor
      const backBtn = document.getElementById("back-btn");

      if (viewDashboard) viewDashboard.classList.add("hidden-view");
      if (viewEditor) viewEditor.classList.add("hidden-view"); // Hide editor if open
      if (viewProfile) viewProfile.classList.remove("hidden-view");
      if (backBtn) backBtn.classList.remove("hidden", "hidden-view");
      window.scrollTo(0, 0);
// --- D. LOGO GÃ–STERÄ°MÄ° (BUNU EKLEYÄ°N) ---
      const pLogoImg = document.getElementById("p-logo-image");
      const pDefaultIcon = document.getElementById("p-default-icon");
      
      if (pLogoImg && pDefaultIcon) {
          if (company.logo_url) {
              // Logo varsa: Resmi gÃ¶ster, ikonu gizle
              pLogoImg.src = company.logo_url;
              pLogoImg.classList.remove("hidden");
              pDefaultIcon.classList.add("hidden");
          } else {
              // Logo yoksa: Resmi gizle, varsayÄ±lan ikonu gÃ¶ster
              pLogoImg.classList.add("hidden");
              pDefaultIcon.classList.remove("hidden");
          }
      }

      const nameEl = document.getElementById("p-name");
      const descEl = document.getElementById("p-desc");
      const cityEl = document.getElementById("p-city");
      const sectorEl = document.getElementById("p-sector");
      const badgeEl = document.getElementById("p-badge");
      // âœ… openProfile Ä°Ã‡Ä°NE EKLENECEK PARÃ‡A
      const pType = document.getElementById("p-type-tag");
      const pSize = document.getElementById("p-size-tag");
      const pYear = document.getElementById("p-year-tag");

      // Verileri ekrana yaz
      if (pType) pType.textContent = company.type_label || "Industrial Supplier";
      if (pSize) pSize.textContent = company.size_label || "Size N/A";
      if (pYear) pYear.textContent = company.year_label ? `Founded ${company.year_label}` : "";

      if (nameEl) nameEl.textContent = company.name;
      if (cityEl) cityEl.textContent = company.city;
      if (sectorEl)
        sectorEl.textContent =
          currentLang === "tr"
            ? sectorToTr(company.sector)
            : company.sector.charAt(0).toUpperCase() +
              company.sector.slice(1);

      const desc =
        currentLang === "tr" && company.desc_tr
          ? company.desc_tr
          : company.desc;
      if (descEl) descEl.textContent = desc;
      // ðŸ‘‡ BURADAN BAÅžLA ðŸ‘‡
      
      // --- TAGLINE (SLOGAN) GÃ–STERÄ°MÄ° ---
      const taglineContainer = document.getElementById("p-tagline-container");
      const taglineText = document.getElementById("p-tagline");

      if (taglineContainer && taglineText) {
          if (company.tagline && company.tagline.trim() !== "") {
              // Slogan varsa: TÄ±rnak iÃ§ine al ve kutuyu gÃ¶ster
              taglineText.textContent = `"${company.tagline}"`; 
              taglineContainer.classList.remove("hidden");
          } else {
              // Yoksa: Kutuyu gizle
              taglineContainer.classList.add("hidden");
          }
      }

      // ðŸ‘† BURADA BÄ°TÄ°YOR ðŸ‘†

      if (badgeEl) badgeEl.innerHTML = getTrustBadge(company);

      // YENÄ° KOD (Dairesel Ã‡ubuk Ä°Ã§in)
const score = computeScore(company.meta);
const pScore = document.getElementById("p-score");
const pScoreLabel = document.getElementById("p-score-label");
const pScoreRing = document.getElementById("p-score-ring"); // Yeni element

if (pScore) pScore.textContent = score.toString();
if (pScoreLabel) pScoreLabel.textContent = getScoreLabel(score);

if (pScoreRing) {
  // Dairenin Ã§evresi (2 * pi * r) = 2 * 3.14159 * 42 â‰ˆ 263.89
  const circumference = 263.89;
  // Skora gÃ¶re doluluk oranÄ±nÄ± hesapla (Tersi alÄ±nÄ±r Ã§Ã¼nkÃ¼ stroke-dashoffset boÅŸluÄŸu ifade eder)
  const offset = circumference - (score / 100) * circumference;
  
  // Animasyonun Ã§alÄ±ÅŸmasÄ± iÃ§in kÃ¼Ã§Ã¼k bir gecikme ekle
  setTimeout(() => {
      pScoreRing.style.strokeDashoffset = offset;
  }, 100);
}

      // --- CORE SERVICES (GÃœNCELLENMÄ°Åž KISIM) ---
      const servicesGrid = document.getElementById("p-services-grid");
      if (servicesGrid) {
        servicesGrid.innerHTML = "";
        
        // Ã–nce veriyi saÄŸlamlaÅŸtÄ±r: TÃ¼rkÃ§e yoksa Ä°ngilizceyi gÃ¶ster
        let displayServices = [];
        if (currentLang === "tr" && company.services_tr && company.services_tr.length > 0) {
            displayServices = company.services_tr;
        } else {
            displayServices = company.services || [];
        }

        if (displayServices.length === 0) {
          servicesGrid.innerHTML =
            '<div class="col-span-full py-4 text-center border border-dashed border-gray-200 rounded-xl bg-gray-50"><p class="text-sm text-gray-400 italic">Hizmet bilgisi girilmemiÅŸ.</p></div>';
        } else {
          displayServices.forEach((s) => {
            const div = document.createElement("div");
            // GÃ–RÃœNÃœR KART TASARIMI
            div.className =
              "bg-white border border-gray-200 rounded-xl p-4 flex items-center gap-4 shadow-sm hover:shadow-md hover:border-BTrustOn-accent transition group cursor-default";

            div.innerHTML = `
              <div class="w-10 h-10 rounded-lg bg-cyan-50 flex items-center justify-center shrink-0 text-BTrustOn-accent group-hover:bg-BTrustOn-accent group-hover:text-white transition duration-300">
                 <i class="fa-solid fa-check text-lg"></i>
              </div>
              <span class="text-sm font-bold text-gray-700 group-hover:text-BTrustOn-primary transition">${s}</span>
            `;
            servicesGrid.appendChild(div);
          });
        }
      }

      // --- PROJELERÄ° LÄ°STELE (GÃœNCELLENMÄ°Åž - BUTONLU VERSÄ°YON) ---
      const pProjectsList = document.getElementById("p-projects-list");

      // Yetki KontrolÃ¼: Bu profil benim mi?
      const isMyProfileForProj = (localStorage.getItem("BTrustOn_my_company_id") && String(companyId) === String(localStorage.getItem("BTrustOn_my_company_id")));

      // "ADD NEW PROJECT" butonunu bul ve duruma gÃ¶re gizle/gÃ¶ster
      const btnAddProject = document.getElementById("btn-add-project");
      if(btnAddProject) {
        if(isMyProfileForProj) btnAddProject.classList.remove("hidden-view");
        else btnAddProject.classList.add("hidden-view");
      }

      if (pProjectsList) {
        pProjectsList.innerHTML = "";
        const projects = company.projects || [];
        
        if (projects.length === 0) {
          pProjectsList.innerHTML = '<div class="col-span-2 text-center py-8 text-gray-400 text-xs italic">HenÃ¼z proje eklenmemiÅŸ.</div>';
        } else {
          projects.forEach((p) => {
            const title = currentLang === "tr" && p.title_tr ? p.title_tr : p.title;
            const loc = currentLang === "tr" && p.loc_tr ? p.loc_tr : p.loc;
            const desc = currentLang === "tr" && p.desc_tr ? p.desc_tr : p.desc;
            const pId = p.id;

            // DÃœZENLEME BUTONLARI (Sadece sahibiysen kartÄ±n Ã¼stÃ¼ne ekle)
            let actionBtns = "";
            if(isMyProfileForProj) {
                actionBtns = `
                  <div class="flex gap-2 ml-2 shrink-0">
                    <button onclick="openProjectModal(${pId})" class="w-7 h-7 rounded-lg bg-cyan-50 text-BTrustOn-accent hover:bg-BTrustOn-accent hover:text-white flex items-center justify-center transition" title="DÃ¼zenle">
                        <i class="fa-solid fa-pen text-[10px]"></i>
                    </button>
                    <button onclick="deleteProject(${pId})" class="w-7 h-7 rounded-lg bg-red-50 text-red-500 hover:bg-red-500 hover:text-white flex items-center justify-center transition" title="Sil">
                        <i class="fa-solid fa-trash text-[10px]"></i>
                    </button>
                  </div>
                `;
            }

            const card = document.createElement("div");
            // Kart tasarÄ±mÄ± (flex-col ve h-full ile hizayÄ± koruduk)
            card.className = "bg-white/90 border border-gray-100 rounded-2xl p-5 shadow-sm hover:shadow-md hover:border-BTrustOn-accent transition group relative flex flex-col h-full";

            card.innerHTML = `
              <div class="flex items-start justify-between mb-3">
                <div class="flex items-start gap-3">
                  <div class="w-10 h-10 rounded-xl bg-cyan-50 flex items-center justify-center shrink-0">
                    <i class="fa-solid fa-diagram-project text-BTrustOn-accent"></i>
                  </div>
                  <div>
                    <h4 class="text-sm font-bold text-BTrustOn-primary leading-snug pr-2 line-clamp-2">
                      ${title}
                    </h4>
                    <p class="text-[11px] text-gray-400 mt-0.5 flex items-center gap-1">
                      <i class="fa-solid fa-location-dot text-BTrustOn-accent text-[10px]"></i>
                      <span class="line-clamp-1">${loc}</span>
                    </p>
                  </div>
                </div>
                ${actionBtns}
              </div>

              <p class="text-xs text-gray-600 leading-relaxed pl-1 line-clamp-3">
                ${desc}
              </p>
            `;

            pProjectsList.appendChild(card);
          });
        }
      }

      // --- RENDER CERTIFICATES ---
      renderCertificates(company);

      // âœ… GÃœNCELLENMÄ°Åž ASSET TABLOSU KODU
      const assetsList = document.getElementById("p-assets-list");
      if (assetsList) {
        assetsList.innerHTML = "";
        const assets = company.assets || [];
        
        // Bu profili gÃ¶rÃ¼ntÃ¼leyen kiÅŸi sahibi mi?
        const myId = localStorage.getItem("BTrustOn_my_company_id");
        const isOwner = (myId && String(company.id) === String(myId));

        if (assets.length === 0) {
          // Colspan 6 yaptÄ±k Ã§Ã¼nkÃ¼ tabloda artÄ±k 6 sÃ¼tun var
          assetsList.innerHTML = `<tr><td colspan="6" class="py-8 text-center text-xs text-gray-400 italic">No assets listed yet.</td></tr>`;
        } else {
          assets.forEach((a) => {
            const type = a.type || a.type_tr || "";
            const spec = a.spec || a.spec_tr || "";
            const status = a.status || "";
            const qty = a.qty || "1";
            const loc = a.location || "-";
            const assetId = a.id; 

            // Status Rengi
            let badgeClass = "bg-slate-50 text-slate-600 border-slate-100";
            if(status === "Available") badgeClass = "bg-emerald-50 text-emerald-700 border-emerald-100";
            else if(status === "Under Maintenance") badgeClass = "bg-amber-50 text-amber-700 border-amber-100";
            else if(status === "Out of Service") badgeClass = "bg-rose-50 text-rose-700 border-rose-100";

            // BUTONLAR (Sadece sahipsen gÃ¶rÃ¼nÃ¼r)
            let actionButtons = "";
            if (isOwner) {
                actionButtons = `
                  <div class="flex items-center justify-end gap-2">
                    <button onclick="openAssetModal(${assetId})" class="w-7 h-7 rounded-lg bg-cyan-50 text-BTrustOn-accent hover:bg-BTrustOn-accent hover:text-white transition flex items-center justify-center" title="Edit">
                      <i class="fa-solid fa-pen text-[10px]"></i>
                    </button>
                    <button onclick="deleteAsset(${assetId})" class="w-7 h-7 rounded-lg bg-red-50 text-red-500 hover:bg-red-500 hover:text-white transition flex items-center justify-center" title="Delete">
                      <i class="fa-solid fa-trash text-[10px]"></i>
                    </button>
                  </div>
                `;
            }

            const row = document.createElement("tr");
            row.className = "hover:bg-cyan-50/30 transition group border-b border-gray-50 last:border-0";
            row.innerHTML = `
              <td class="py-3 px-6 font-bold text-BTrustOn-primary text-xs">${type}</td>
              <td class="py-3 px-6 text-gray-500 text-xs">${spec}</td>
              <td class="py-3 px-6 text-center font-mono text-xs">${qty}</td>
              <td class="py-3 px-6 text-gray-500 text-xs">${loc}</td>
              <td class="py-3 px-6">
                <span class="inline-flex items-center px-2.5 py-1 rounded-md text-[10px] font-bold border ${badgeClass}">
                  ${status}
                </span>
              </td>
              <td class="py-3 px-6 text-right">
                ${actionButtons}
              </td>
            `;
            assetsList.appendChild(row);
          });
        }
      }
// --- C. CONTACT INFO GÃ–STERÄ°MÄ° (BUNU EKLEYÄ°N) ---
      const pWebsite = document.getElementById("p-website-link");
      const pEmail = document.getElementById("p-email-text");
      const pPhone = document.getElementById("p-phone-text");

      // 1. Website
      if (pWebsite) {
          if (company.website) {
              let href = company.website.startsWith("http") ? company.website : "https://" + company.website;
              pWebsite.href = href;
              pWebsite.textContent = company.website.replace(/^https?:\/\//, '').replace(/\/$/, '');
              pWebsite.classList.remove("text-gray-400", "italic", "pointer-events-none");
              pWebsite.classList.add("text-BTrustOn-accent", "hover:underline");
          } else {
              pWebsite.textContent = "-";
              pWebsite.removeAttribute("href");
              pWebsite.classList.add("text-gray-400", "italic", "pointer-events-none");
              pWebsite.classList.remove("text-BTrustOn-accent", "hover:underline");
          }
      }

      // 2. Email
      // 2. Email (GÃœNCELLENMÄ°Åž MANTIK)
      if (pEmail) {
          // Ã–ncelik: contact_email (varsa). Yoksa: email (login). O da yoksa: "-"
          const displayEmail = company.contact_email || company.email || "-";
          
          pEmail.textContent = displayEmail;
          
          if(displayEmail !== "-") {
              // TÄ±klayÄ±nca mail atma Ã¶zelliÄŸi
              pEmail.parentElement.onclick = () => window.location.href = "mailto:" + displayEmail;
              pEmail.parentElement.classList.remove("text-gray-400"); // Gri rengi kaldÄ±r
              pEmail.parentElement.classList.add("cursor-pointer", "hover:bg-gray-50", "text-gray-700"); // Siyah yap ve tÄ±klanabilir kÄ±l
          } else {
              // Mail yoksa pasif yap
               pEmail.parentElement.onclick = null;
               pEmail.parentElement.classList.remove("cursor-pointer", "hover:bg-gray-50", "text-gray-700");
               pEmail.parentElement.classList.add("text-gray-400");
          }
      }

      // 3. Telefon
      if (pPhone) {
          pPhone.textContent = company.phone || "-";
      }
      switchProfileTab("overview");
// âœ… YENÄ° TOPLU BUTON KONTROLÃœ (Edit, Asset ve Teklif ButonlarÄ±)
      
      // 1. Kimlik KontrolÃ¼: Bu profil benim mi?
      const myCurrentId = localStorage.getItem("BTrustOn_my_company_id");
      const isMyProfile = (myCurrentId && String(companyId) === String(myCurrentId));

      // 2. ButonlarÄ± SeÃ§
      const btnEdit = document.getElementById("btn-edit-profile");
      const btnAddAsset = document.getElementById("btn-add-asset");
      const btnQuote = document.getElementById("btn-req-quote"); // Teklif butonu
// ... (Mevcut openProfile kodlarÄ±nÄ±zÄ±n devamÄ±) ...

      // --- LOGO TIKLAMA YETKÄ°SÄ° AYARI ---
      const logoContainer = document.getElementById("p-logo-container");
      const logoOverlay = document.getElementById("p-logo-overlay");
      const logoInput = document.getElementById("profile-logo-input");

      if (logoContainer && logoOverlay) {
          if (isMyProfile) {
              // EÄŸer benim profilimse: TÄ±klamaya izin ver ve Hover efektini aÃ§
              logoContainer.classList.add("cursor-pointer", "hover:scale-105");
              logoContainer.setAttribute("onclick", "document.getElementById('profile-logo-input').click()");
              logoOverlay.classList.remove("hidden"); // Overlay HTML'de group-hover ile Ã§alÄ±ÅŸacak ama class olarak varlÄ±ÄŸÄ±nÄ± aÃ§alÄ±m
              logoOverlay.className = "absolute inset-0 bg-slate-900/60 hidden group-hover:flex flex-col items-center justify-center text-white backdrop-blur-[1px] cursor-pointer";
          } else {
              // BaÅŸkasÄ±nÄ±n profili: TÄ±klamayÄ± kapat
              logoContainer.classList.remove("cursor-pointer", "hover:scale-105");
              logoContainer.removeAttribute("onclick");
              logoOverlay.className = "hidden"; // Tamamen gizle
          }
      }

      if (isMyProfile) {
          // --- EÄžER BENÄ°M PROFÄ°LÄ°MSE ---
          if(btnEdit) btnEdit.classList.remove("hidden-view");         // DÃ¼zenle: GÃ–STER
          if(btnAddAsset) btnAddAsset.classList.remove("hidden-view"); // Ekle: GÃ–STER
          if(btnQuote) btnQuote.classList.add("hidden-view");          // Teklif Ä°ste: GÄ°ZLE (Kendinden istemezsin)
      } else {
          // --- EÄžER BAÅžKASININ PROFÄ°LÄ°YSE ---
          if(btnEdit) btnEdit.classList.add("hidden-view");            // DÃ¼zenle: GÄ°ZLE
          if(btnAddAsset) btnAddAsset.classList.add("hidden-view");    // Ekle: GÄ°ZLE
          if(btnQuote) btnQuote.classList.remove("hidden-view");       // Teklif Ä°ste: GÃ–STER
      }
    }

    // --- EDITOR FUNCTIONS ---
    function showEditorView() {
        document.getElementById("view-dashboard").classList.add("hidden-view");
        document.getElementById("view-profile").classList.add("hidden-view");
        document.getElementById("view-editor").classList.remove("hidden-view");
        document.getElementById("back-btn").classList.remove("hidden", "hidden-view");
        window.scrollTo(0,0);
    }

   // âœ… YENÄ° KAYDETME FONKSÄ°YONU (Supabase Uyumlu)
// âœ… 1. GÃœNCELLENMÄ°Åž KAYDETME FONKSÄ°YONU
/* --- B. KAYDETME (GÃœNCEL - CONTACT INFO DAHÄ°L) --- */
/* --- GÃœNCELLENMÄ°Åž saveProfileData (Toast'lÄ±) --- */
/* --- B. KAYDETME (GÃœNCEL - EMAIL DAHÄ°L) --- */
async function saveProfileData() {
  const btn = document.querySelector("#editor-form button[type='submit']");
  const originalText = btn.textContent;
  btn.textContent = "Uploading...";
  btn.disabled = true;

  try {
    const { data: { user } } = await supabaseClient.auth.getUser();
    if (!user) throw new Error("No active session found!");

    let finalLogoUrl = selectedCompany.logo_url || null;

    // 1. LOGO VARSA Ã–NCE ONU YÃœKLE
    if (selectedLogoFile) {
        const fileExt = selectedLogoFile.name.split('.').pop();
        const fileName = `${user.id}-${Date.now()}.${fileExt}`;
        const filePath = `${fileName}`;

        // Supabase Storage'a yÃ¼kle
        const { error: uploadError } = await supabaseClient.storage
            .from('logos') // 1. AdÄ±mda aÃ§tÄ±ÄŸÄ±mÄ±z bucket ismi
            .upload(filePath, selectedLogoFile);

        if (uploadError) throw uploadError;

        // Public URL al
        const { data: { publicUrl } } = supabaseClient.storage
            .from('logos')
            .getPublicUrl(filePath);
            
        finalLogoUrl = publicUrl;
    }

    // 2. DÄ°ÄžER VERÄ°LERÄ° HAZIRLA
    const name = document.getElementById("edit-name").value.trim();
    const city = document.getElementById("edit-city").value.trim();
    const sector = document.getElementById("edit-sector").value;
    const desc = document.getElementById("edit-desc").value.trim();
    const servicesStr = document.getElementById("edit-services").value.trim();
    const website = document.getElementById("edit-website").value.trim();
    const phone = document.getElementById("edit-phone").value.trim();
    const contactEmail = document.getElementById("edit-email").value.trim();
    const typeVal = document.getElementById("edit-type").value;
    const sizeVal = document.getElementById("edit-size").value;
    const yearVal = document.getElementById("edit-year").value;
    const tagline = document.getElementById("edit-tagline").value.trim();
    const updates = {
      company_name: name,
      city: city,
      tagline: tagline,
      sector: sector,
      description: desc,
      services: servicesStr,
      website: website,
      phone: phone,
      contact_email: contactEmail,
      company_type: typeVal,
      company_size: sizeVal,
      founded_year: yearVal,
      logo_url: finalLogoUrl, // Logo URL'ini kaydet
      updated_at: new Date(),
    };

    // 3. VERÄ°TABANINI GÃœNCELLE
    const { error } = await supabaseClient
      .from('profiles')
      .update(updates)
      .eq('id', user.id);

    if (error) throw error;

    showToast("Success", "Profile and logo updated successfully!", "success");

    // Local veriyi gÃ¼ncelle (Ekran yenilenmeden gÃ¶rÃ¼nsÃ¼n diye)
    const localCompany = database.find(c => c.id == user.id);
    if (localCompany) {
        Object.assign(localCompany, {
            name, city, sector, desc, tagline,
            website, phone, contact_email: contactEmail,
            type_label: typeVal, size_label: sizeVal, year_label: yearVal,
            logo_url: finalLogoUrl,
            services: servicesStr.split(',').map(s => s.trim()).filter(s => s)
        });
    }

    openProfile(user.id);
    
    document.getElementById("view-editor").classList.add("hidden-view");
    document.getElementById("view-profile").classList.remove("hidden-view");
    document.getElementById("back-btn").classList.remove("hidden", "hidden-view");

  } catch (error) {
    console.error("Error:", error);
    showToast("Error", error.message, "error");
  } finally {
    btn.textContent = originalText;
    btn.disabled = false;
  }
}
    function showMainView() {
      const viewDashboard = document.getElementById("view-dashboard");
      const viewProfile = document.getElementById("view-profile");
      const viewEditor = document.getElementById("view-editor");
      const backBtn = document.getElementById("back-btn");

      if (viewDashboard) viewDashboard.classList.remove("hidden-view");
      if (viewProfile) viewProfile.classList.add("hidden-view");
      if (viewEditor) viewEditor.classList.add("hidden-view");
      if (backBtn) backBtn.classList.add("hidden", "hidden-view");
    }

    function toggleModal(id) {
      const modal = document.getElementById(id);
      if (!modal) return;
      modal.classList.toggle("opacity-0");
      modal.classList.toggle("pointer-events-none");
      document.body.classList.toggle("modal-active");
    }

    function openQuoteModal(companyName) {
      const targetEl = document.getElementById("quote-target-company");
      const inputTarget = document.getElementById("input-target-company");
      if (targetEl) targetEl.textContent = companyName || "";
      if (inputTarget) inputTarget.value = companyName || "";
      toggleModal("modal-quote");
    }

    function switchProfileTab(tab) {
      const tabs = ["overview", "projects", "certs", "assets"];
      tabs.forEach((tName) => {
        const btn = document.getElementById(`tab-${tName}`);
        const content = document.getElementById(`content-${tName}`);
        if (!btn || !content) return;

        if (tName === tab) {
          btn.classList.add(
            "border-BTrustOn-accent",
            "text-BTrustOn-primary",
            "bg-cyan-50/50"
          );
          btn.classList.remove("border-transparent");
          content.classList.remove("hidden-view");
        } else {
          btn.classList.remove(
            "border-BTrustOn-accent",
            "text-BTrustOn-primary",
            "bg-cyan-50/50"
          );
          btn.classList.add("border-transparent");
          content.classList.add("hidden-view");
        }
      });
    }

    function switchLanguage(lang) {
      currentLang = lang === "tr" ? "tr" : "en";

      const btnEn = document.getElementById("lang-en");
      const btnTr = document.getElementById("lang-tr");

      if (btnEn && btnTr) {
        if (currentLang === "en") {
          btnEn.classList.add("bg-white", "text-BTrustOn-primary", "shadow-sm");
          btnEn.classList.remove("text-gray-500");
          btnTr.classList.remove(
            "bg-white",
            "text-BTrustOn-primary",
            "shadow-sm"
          );
          btnTr.classList.add("text-gray-500");
        } else {
          btnTr.classList.add("bg-white", "text-BTrustOn-primary", "shadow-sm");
          btnTr.classList.remove("text-gray-500");
          btnEn.classList.remove(
            "bg-white",
            "text-BTrustOn-primary",
            "shadow-sm"
          );
          btnEn.classList.add("text-gray-500");
        }
      }

      applyTranslations();
      renderTopCompanies();
      const searchInput = document.getElementById("search-input");
      const value = searchInput ? searchInput.value : "";
      renderCards(value);

        // Åžu an profil ekranÄ±nda mÄ±yÄ±z, kontrol et
  const viewProfile = document.getElementById("view-profile");
  const isProfileVisible =
    viewProfile && !viewProfile.classList.contains("hidden-view");

  // Sadece profil ekranÄ±ndaysak ilgili ÅŸirket profilini yeniden Ã§iz
  if (isProfileVisible && selectedCompany) {
    openProfile(selectedCompany.id);
  }

    }
      
    document.addEventListener("DOMContentLoaded", () => {
      applyTranslations();
      initTopCompaniesOrder();
      renderTopCompanies();
      

      startTopAnimations();
      

      switchLanguage("en");
      initRealData();
      initShowcaseSystem();
    });
/* --- GELÄ°ÅžMÄ°Åž ASSET YÃ–NETÄ°MÄ° (EKLE - DÃœZENLE - SÄ°L) --- */

let currentEditingAssetId = null;

// 1. MODALI AÃ‡ (Ekleme veya DÃ¼zenleme)
function openAssetModal(assetId = null) {
  const modal = document.getElementById("asset-modal");
  const form = document.getElementById("asset-form");
  const title = document.getElementById("asset-modal-title");
  
  if (!modal) return;
  modal.classList.remove("pointer-events-none", "opacity-0");
  
  // Formu temizle
  if(form) form.reset();
  
  if (assetId) {
    // --- DÃœZENLEME MODU ---
    currentEditingAssetId = assetId;
    if(title) title.textContent = "Edit Asset Details";
    
    // Veriyi bul ve kutulara doldur
    const asset = selectedCompany.assets.find(a => a.id === assetId);
    if (asset) {
        document.getElementById("asset-item").value = asset.type || asset.type_tr || "";
        document.getElementById("asset-specs").value = asset.spec || asset.spec_tr || "";
        document.getElementById("asset-qty").value = asset.qty || "1";
        document.getElementById("asset-location").value = asset.location || "";
        document.getElementById("asset-status").value = asset.status || "Available";
    }
  } else {
    // --- EKLEME MODU ---
    currentEditingAssetId = null;
    if(title) title.textContent = "Add New Asset";
  }
}

function closeAssetModal() {
  const modal = document.getElementById("asset-modal");
  if (modal) modal.classList.add("pointer-events-none", "opacity-0");
  currentEditingAssetId = null;
}

// 2. KAYDET (Hem Yeni Ekleme Hem GÃ¼ncelleme)
// 2. KAYDET (ASSET - ENGLISH)
/* --- GÃœNCELLENMÄ°Åž saveAsset (Toast'lÄ±) --- */
async function saveAsset() {
  const btn = document.querySelector("#asset-form button[type='submit']");
  const originalText = btn.textContent;
  btn.textContent = "Processing...";
  btn.disabled = true;

  try {
    const item = document.getElementById("asset-item").value.trim();
    const specs = document.getElementById("asset-specs").value.trim();
    const qty = document.getElementById("asset-qty").value.trim();
    const location = document.getElementById("asset-location").value.trim();
    const status = document.getElementById("asset-status").value;

    if (!item) { showToast("Missing Info", "Please enter an item name.", "error"); return; }

    let currentAssets = [...(selectedCompany.assets || [])];

    if (currentEditingAssetId) {
        const index = currentAssets.findIndex(a => a.id === currentEditingAssetId);
        if (index > -1) {
            currentAssets[index] = {
                ...currentAssets[index],
                type: item, spec: specs, qty: qty, location: location, status: status,
                updated_at: new Date().toISOString()
            };
        }
    } else {
        const newAsset = {
            id: Date.now(),
            type: item, spec: specs, qty: qty, location: location, status: status,
            date_added: new Date().toISOString()
        };
        currentAssets.push(newAsset);
    }

    const { data: { user } } = await supabaseClient.auth.getUser();
    if (!user) throw new Error("No session.");

    const { error } = await supabaseClient
      .from('profiles')
      .update({ assets: currentAssets, updated_at: new Date() })
      .eq('id', user.id);

    if (error) throw error;

    selectedCompany.assets = currentAssets;
    const localRef = database.find(c => c.id == user.id);
    if(localRef) localRef.assets = currentAssets;

    openProfile(user.id);
    switchProfileTab('assets');
    closeAssetModal();
    showToast("Success", "Asset saved successfully.", "success");

  } catch (error) {
    console.error(error);
    showToast("Error", error.message, "error");
  } finally {
    btn.textContent = originalText;
    btn.disabled = false;
  }
}
// 3. SÄ°LME (ASSET - ENGLISH)
// 3. SÄ°LME (ASSET) - YENÄ° MODAL Ä°LE
function deleteAsset(assetId) {
    openDeleteModal("Are you sure you want to remove this asset from inventory?", async () => {
        try {
            let currentAssets = selectedCompany.assets.filter(a => a.id !== assetId);

            const { data: { user } } = await supabaseClient.auth.getUser();
            
            const { error } = await supabaseClient
                .from('profiles')
                .update({ assets: currentAssets, updated_at: new Date() })
                .eq('id', user.id);

            if (error) throw error;

            selectedCompany.assets = currentAssets;
            const localRef = database.find(c => c.id == user.id);
            if(localRef) localRef.assets = currentAssets;

            openProfile(user.id);
            switchProfileTab('assets');
            showToast("Deleted", "Asset removed successfully.", "success");

        } catch (error) {
            showToast("Error", error.message, "error");
        }
    });
}
/* --- PROJECT YÃ–NETÄ°MÄ° (EKLE - DÃœZENLE - SÄ°L) --- */

let currentEditingProjectId = null;

// 1. MODALI AÃ‡
function openProjectModal(projectId = null) {
  const modal = document.getElementById("project-modal");
  const form = document.getElementById("project-form");
  const title = document.getElementById("project-modal-title");
  
  if (!modal) return;
  modal.classList.remove("pointer-events-none", "opacity-0");
  
  // Formu temizle
  if(form) form.reset();
  
  if (projectId) {
    // --- DÃœZENLEME MODU ---
    currentEditingProjectId = projectId;
    if(title) title.textContent = "Edit Project";
    
    // Veriyi bul ve doldur
    // Not: selectedCompany global deÄŸiÅŸkeni aÃ§Ä±k olan profili tutar
    if (selectedCompany && selectedCompany.projects) {
        const proj = selectedCompany.projects.find(p => p.id === projectId);
        if (proj) {
            document.getElementById("proj-title").value = proj.title || proj.title_tr || "";
            document.getElementById("proj-loc").value = proj.loc || proj.loc_tr || "";
            document.getElementById("proj-desc").value = proj.desc || proj.desc_tr || "";
        }
    }
  } else {
    // --- EKLEME MODU ---
    currentEditingProjectId = null;
    if(title) title.textContent = "Add New Project";
  }
}

function closeProjectModal() {
  const modal = document.getElementById("project-modal");
  if (modal) modal.classList.add("pointer-events-none", "opacity-0");
  currentEditingProjectId = null;
}

// 2. KAYDET (Supabase)
// 2. KAYDET (PROJECT - ENGLISH)
/* --- GÃœNCELLENMÄ°Åž saveProject (Toast'lÄ±) --- */
async function saveProject() {
  const btn = document.querySelector("#project-form button[type='submit']");
  const originalText = btn.textContent;
  btn.textContent = "Saving...";
  btn.disabled = true;

  try {
    const title = document.getElementById("proj-title").value.trim();
    const loc = document.getElementById("proj-loc").value.trim();
    const desc = document.getElementById("proj-desc").value.trim();

    if (!title) { showToast("Missing Info", "Please enter a project title.", "error"); return; }

    let currentProjects = [...(selectedCompany.projects || [])];

    if (currentEditingProjectId) {
        const index = currentProjects.findIndex(p => p.id === currentEditingProjectId);
        if (index > -1) {
            currentProjects[index] = { ...currentProjects[index], title: title, loc: loc, desc: desc };
        }
    } else {
        currentProjects.push({ id: Date.now(), title: title, loc: loc, desc: desc });
    }

    const { data: { user } } = await supabaseClient.auth.getUser();
    if (!user) throw new Error("Session expired.");

    const { error } = await supabaseClient
      .from('profiles')
      .update({ projects: currentProjects, updated_at: new Date() })
      .eq('id', user.id);

    if (error) throw error;

    selectedCompany.projects = currentProjects;
    const localRef = database.find(c => c.id == user.id);
    if(localRef) localRef.projects = currentProjects;

    openProfile(user.id);
    switchProfileTab('projects');
    closeProjectModal();
    showToast("Success", "Project saved successfully.", "success");

  } catch (error) {
    showToast("Error", error.message, "error");
  } finally {
    btn.textContent = originalText;
    btn.disabled = false;
  }
}
// 3. SÄ°LME (PROJECT - ENGLISH)
// 3. SÄ°LME (PROJECT) - YENÄ° MODAL Ä°LE
function deleteProject(projectId) {
    openDeleteModal("Are you sure you want to delete this project?", async () => {
        try {
            let currentProjects = (selectedCompany.projects || []).filter(p => p.id !== projectId);
            
            const { data: { user } } = await supabaseClient.auth.getUser();
            if (!user) throw new Error("No session.");

            const { error } = await supabaseClient
                .from('profiles')
                .update({ projects: currentProjects, updated_at: new Date() })
                .eq('id', user.id);

            if (error) throw error;

            selectedCompany.projects = currentProjects;
            const localRef = database.find(c => c.id == user.id);
            if(localRef) localRef.projects = currentProjects;

            openProfile(user.id);
            switchProfileTab('projects');
            showToast("Deleted", "Project removed successfully.", "success");

        } catch (error) {
            showToast("Error", error.message, "error");
        }
    });
}
// 3. SÄ°LME (CERTIFICATE) - YENÄ° MODAL Ä°LE
function deleteCert(certId, certName) {
    // TarayÄ±cÄ± confirm'i yerine kendi modalÄ±mÄ±zÄ± Ã§aÄŸÄ±rÄ±yoruz
    openDeleteModal(`Are you sure you want to delete "${certName}"?`, async () => {
        
        // --- ASIL SÄ°LME Ä°ÅžLEMÄ° BURADA BAÅžLIYOR ---
        try {
            let currentCerts = [];
            
            if (certId === -1) {
                currentCerts = selectedCompany.certificates.filter(c => c !== certName);
            } else {
                currentCerts = selectedCompany.certificates.filter(c => c.id !== certId);
            }

            const { data: { user } } = await supabaseClient.auth.getUser();
            
            const { error } = await supabaseClient
                .from('profiles')
                .update({ certificates: currentCerts, updated_at: new Date() })
                .eq('id', user.id);

            if (error) throw error;

            selectedCompany.certificates = currentCerts;
            const localRef = database.find(c => c.id == user.id);
            if(localRef) localRef.certificates = currentCerts;

            openProfile(user.id);
            showToast("Deleted", "Certificate removed successfully.", "success");
            
        } catch (error) {
            showToast("Error", "Delete failed: " + error.message, "error");
        }
    });
}
  </script>
<script>
// 1. YENÄ° KAYIT (JOIN) Ä°ÅžLEMÄ°
// GÃœNCELLENMÄ°Åž KAYIT FONKSÄ°YONU (Type Bilgisini Kaydeder)
/* --- GÃœNCELLENMÄ°Åž handleJoin (Toast'lÄ±) --- */
async function handleJoin() {
  const btn = document.querySelector("#join-form button");
  const originalText = btn.textContent;
  btn.textContent = "Processing...";
  btn.disabled = true;

  try {
    const email = document.getElementById("join-email").value;
    const password = document.getElementById("join-password").value;
    const companyName = document.getElementById("join-companyName").value;
    const sector = document.getElementById("join-sector").value;
    const typeVal = document.getElementById("join-type").value;
    const city = document.getElementById("join-city").value;
    const services = document.getElementById("join-services").value;
    const errEl = document.getElementById("join-error");

    if(errEl) errEl.classList.add("hidden");

    const { data: authData, error: authError } = await supabaseClient.auth.signUp({ email, password });
    if (authError) throw authError;

    const { error: dbError } = await supabaseClient.from('profiles').insert([
      {
        id: authData.user.id,
        email: email,
        company_name: companyName,
        sector: sector,
        company_type: typeVal,
        city: city,
        services: services,
        description: "",
        size: "1-10"
      }
    ]);

    if (dbError) throw dbError;

    toggleModal('modal-join');
    showToast("Welcome!", "Registration successful. Profile created.", "success");
    checkUserAndOpenProfile();

  } catch (error) {
    const errEl = document.getElementById("join-error");
    if(errEl) {
      errEl.textContent = "Error: " + (error.message || error);
      errEl.classList.remove("hidden");
    }
    showToast("Registration Failed", error.message || "Please check details.", "error");
  } finally {
    btn.textContent = originalText;
    btn.disabled = false;
  }
}
// --- YENÄ° EKLENECEK FONKSÄ°YON BAÅžLANGIÃ‡ ---
async function fetchAllPublicProfiles() {
  // 1. Supabase'den profilleri Ã§ek
  const { data: profiles, error } = await supabaseClient
    .from('profiles')
    .select('*');

  if (error || !profiles) {
    console.log("HenÃ¼z kayÄ±tlÄ± ÅŸirket yok veya hata oluÅŸtu.");
    return;
  }

  // 2. Gelen veriyi site formatÄ±na uydur
  profiles.forEach(profile => {
    // Listede zaten var mÄ±? Varsa Ã¼stÃ¼ne yazmayalÄ±m, sadece eksikleri gÃ¼ncelleyelim.
    const exists = database.find(c => c.id == profile.id);
    
    const formattedProfile = {
      id: profile.id,
      name: profile.company_name || "New Company",
      city: profile.city || "Konum Yok",
      tagline: profile.tagline || "",
      sector: profile.sector || "construction",
      desc: profile.description || "",
      type_label: profile.company_type || "Industrial Supplier", // Type verisi buradan geliyor
      size_label: profile.company_size || "Size N/A",
      year_label: profile.founded_year || "",
      services: profile.services ? profile.services.split(',') : [],
      logo_url: profile.logo_url || null,
      website: profile.website || "",
      phone: profile.phone || "",
      contact_email: profile.contact_email || "",
      trust: "emerging", 
      meta: { references: 60, delivery: 70, years: 1, financial: 60, digital: 50 }, 
      certificates: profile.certificates || [],
      assets: profile.assets || [],
      projects: profile.projects || [] 
    };

    if (exists) {
        // Varsa gÃ¼ncelle
        Object.assign(exists, formattedProfile);
    } else {
        // Yoksa ekle
        database.unshift(formattedProfile);
    }
  });

  // 3. EKRANI YENÄ°LE (DÃœZELTME BURADA YAPILDI)
  // Eski renderCards("") yerine akÄ±llÄ± vitrini Ã§aÄŸÄ±rÄ±yoruz.
  if (typeof isSearchActive !== 'undefined' && !isSearchActive) {
      renderShowcase(); // Rozetleri destekleyen fonksiyon
  } else {
      // EÄŸer kullanÄ±cÄ± o sÄ±rada arama yapÄ±yorsa arama sonucunu gÃ¼ncelle
      const q = document.getElementById("search-input") ? document.getElementById("search-input").value : "";
      renderSearchResults(q);
  }
  
  renderTopCompanies();
}
// --- YENÄ° EKLENECEK FONKSÄ°YON BÄ°TÄ°Åž ---
// âœ… BUNU YAPIÅžTIR
// âœ… 2. GÃœNCELLENMÄ°Åž VERÄ° Ã‡EKME FONKSÄ°YONU
// âœ… YENÄ° GÃœNCELLENMÄ°Åž VERSÄ°YON (Grup KontrollÃ¼)
async function checkUserAndOpenProfile(forceOpen = false) {
  const { data: { session } } = await supabaseClient.auth.getSession();
  
  // 1. GruplarÄ± SeÃ§ (ArtÄ±k tek tek buton deÄŸil, grup yÃ¶netiyoruz)
  const guestGroup = document.getElementById("guest-actions"); // Misafirler
  const userGroup = document.getElementById("user-actions");   // Ãœyeler

  if (!session) {
    // --- OTURUM YOKSA ---
    // Misafir grubunu gÃ¶ster (Flex yaparak hizayÄ± koru)
    if(guestGroup) {
        guestGroup.classList.remove("hidden");
        guestGroup.classList.add("flex");
    }
    // Ãœye grubunu gizle
    if(userGroup) {
        userGroup.classList.add("hidden");
        userGroup.classList.remove("flex");
    }
    return;
  } else {
    // --- OTURUM VARSA ---
    // Misafir grubunu (Join + Login) gizle
    if(guestGroup) {
        guestGroup.classList.add("hidden");
        guestGroup.classList.remove("flex");
    }
    // Ãœye grubunu (My Company + Logout) gÃ¶ster
    if(userGroup) {
        userGroup.classList.remove("hidden");
        userGroup.classList.add("flex");
    }
  }

  // 2. VeritabanÄ±ndan veriyi Ã§ek
  const { data: profile, error } = await supabaseClient
    .from('profiles')
    .select('*')
    .eq('id', session.user.id)
    .single();

  if (error || !profile) { console.log("Profil verisi Ã§ekilemedi."); return; }

  // 3. Veriyi site formatÄ±na Ã§evir
  const mappedProfile = {
    id: profile.id,
    name: profile.company_name,
    city: profile.city,
    tagline: profile.tagline || "",
    sector: profile.sector || "construction",
    desc: profile.description || "",
    
    // Yeni alanlar
    type_label: profile.company_type || "Industrial Supplier",
    size_label: profile.company_size || "Size N/A",
    year_label: profile.founded_year || "",

    services: profile.services ? profile.services.split(',') : [],
    logo_url: profile.logo_url || null,
    website: profile.website || "",
    phone: profile.phone || "",
    contact_email: profile.contact_email || "",
    trust: "verified",
    meta: { references: 50, delivery: 50, years: 1, financial: 50, digital: 50 },
    // ...
    certificates: profile.certificates || [],
    assets: profile.assets || [],
    projects: profile.projects || [] // <--- DÃœZELTÄ°LDÄ°
  };

  if (typeof database !== 'undefined') {
      const idx = database.findIndex(c => c.id == profile.id);
      if (idx > -1) { database[idx] = mappedProfile; } 
      else { database.unshift(mappedProfile); }
      
      localStorage.setItem("BTrustOn_my_company_id", profile.id);

      if (forceOpen === true) { openProfile(profile.id); }
  }
}
// 3. SAYFA YÃœKLENÄ°NCE Ã‡ALIÅžTIR
document.addEventListener("DOMContentLoaded", () => {
    
    // YENÄ° EKLEDÄ°ÄžÄ°MÄ°Z SATIR: Herkesi veritabanÄ±ndan Ã§ek
    setTimeout(fetchAllPublicProfiles, 100);

    // SENDEKÄ° MEVCUT KOD:
    setTimeout(checkUserAndOpenProfile, 500);
});
// Oturum durumu deÄŸiÅŸirse (GiriÅŸ/Ã‡Ä±kÄ±ÅŸ) tetikle
supabaseClient.auth.onAuthStateChange((event, session) => {
  if (event === 'SIGNED_IN') {
    checkUserAndOpenProfile();
  } else if (event === 'SIGNED_OUT') {
    window.location.reload();
  }
});
/* --- MY COMPANY BUTONU DÃœZELTME --- */

// Eski fonksiyonu bununla deÄŸiÅŸtiriyoruz/eziyoruz:
function openMyCompanyIfExists() {
  // 1. LocalStorage'dan ID'yi al
  const myId = localStorage.getItem("BTrustOn_my_company_id");
  
  if (!myId) {
    console.warn("KayÄ±tlÄ± ÅŸirket ID'si bulunamadÄ±, oturum kontrol ediliyor...");
    checkUserAndOpenProfile(); // ID yoksa tekrar giriÅŸ kontrolÃ¼ yap
    return;
  }

  console.log("Åžirket profili aÃ§Ä±lÄ±yor, ID:", myId);

  // 2. EÄŸer bu ÅŸirket veritabanÄ± listemizde yoksa (Sayfa yenilendiyse kaybolmuÅŸ olabilir)
  // Ã–nce listeye ekleyip sonra aÃ§mamÄ±z gerekebilir.
  // Ama checkUserAndOpenProfile zaten Ã§alÄ±ÅŸÄ±p eklemiÅŸ olmalÄ±.
  
  const companyExists = typeof database !== 'undefined' && database.find(c => c.id == myId);

  if (companyExists) {
    // Åžirket listede var, direkt aÃ§
    openProfile(myId);
  } else {
    // Åžirket listede yoksa, verileri tekrar Ã§ekip aÃ§masÄ± iÃ§in checkUser'Ä± tetikle
    checkUserAndOpenProfile();
  }
}

/* --- PROFÄ°L DÃœZENLEME FONKSÄ°YONLARI --- */
/* =========================================
   1. GÃœNCELLENMÄ°Åž EDÄ°TÃ–R AÃ‡MA FONKSÄ°YONU
   ========================================= */
/* =========================================
   GÃœNCELLENMÄ°Åž EDÄ°TÃ–R FONKSÄ°YONU (SertifikasÄ±z & Temiz)
   ========================================= */
/* --- A. EDÄ°TÃ–RÃœ DOLDURMA (GÃœNCEL) --- */
/* --- A. EDÄ°TÃ–RÃœ DOLDURMA (GÃœNCEL - EMAIL DAHÄ°L) --- */
function editMyProfile() {
  if (!selectedCompany) return;

  document.getElementById("edit-name").value = selectedCompany.name || "";
  document.getElementById("edit-city").value = selectedCompany.city || "";
  document.getElementById("edit-tagline").value = selectedCompany.tagline || "";
  document.getElementById("edit-desc").value = selectedCompany.desc || "";
  
// LOGO GÃ–STERÄ°MÄ° (EditÃ¶rde)
  const logoUrl = selectedCompany.logo_url;
  if (logoUrl) {
      document.getElementById("edit-logo-img").src = logoUrl;
      document.getElementById("edit-logo-img").classList.remove("hidden");
      document.getElementById("edit-logo-icon").classList.add("hidden");
  } else {
      // Logo yoksa sÄ±fÄ±rla
      document.getElementById("edit-logo-img").src = "";
      document.getElementById("edit-logo-img").classList.add("hidden");
      document.getElementById("edit-logo-icon").classList.remove("hidden");
  }
  selectedLogoFile = null; // SeÃ§imi sÄ±fÄ±rla
  // Ä°LETÄ°ÅžÄ°M BÄ°LGÄ°LERÄ°
  document.getElementById("edit-website").value = selectedCompany.website || "";
  document.getElementById("edit-phone").value = selectedCompany.phone || "";
  
  // YENÄ°: Contact Email (Varsa onu getir, yoksa ana login mailini getir)
  document.getElementById("edit-email").value = selectedCompany.contact_email || selectedCompany.email || "";

  const sectorSelect = document.getElementById("edit-sector");
  if(sectorSelect) sectorSelect.value = selectedCompany.sector;

  const typeEl = document.getElementById("edit-type");
  const sizeEl = document.getElementById("edit-size");
  const yearEl = document.getElementById("edit-year");

  if(typeEl) typeEl.value = selectedCompany.type_label || "Industrial Supplier";
  if(sizeEl) sizeEl.value = selectedCompany.size_label || "1-10 employees";
  if(yearEl) yearEl.value = selectedCompany.year_label || "";

  const services = selectedCompany.services || []; 
  document.getElementById("edit-services").value = Array.isArray(services) ? services.join(", ") : services;

  showEditorView();
  setTimeout(initEditorListeners, 100); 
}
/* =========================================
   2. YENÄ° EKLENEN FONKSÄ°YONLAR (AltÄ±na Gelecek)
   ========================================= */

// A. Sol menÃ¼den tÄ±klayÄ±nca ilgili yere kaydÄ±rma
/* --- PROFILE STRENGTH HESAPLAMA (GÃœNCEL) --- */
function calculateProfileStatus() {
  // 1. ADIM: FORM ALANLARINI KONTROL ET
  // Yeni eklenen "edit-website" ve "edit-phone" listeye eklendi
  const fields = [
    "edit-name", "edit-city", "edit-sector", "edit-desc", 
    "edit-services", "edit-type", "edit-size", "edit-year",
    "edit-website", "edit-phone" 
  ];

  let filledCount = 0;
  fields.forEach(id => {
    const el = document.getElementById(id);
    // BoÅŸluklarÄ± temizle ve dolu mu bak
    if (el && el.value && el.value.trim().length > 0) {
      filledCount++;
    }
  });
  
  // Form puanÄ± (Toplam skorun %60'Ä± formdan gelir)
  const formScore = Math.round((filledCount / fields.length) * 60);

  // 2. ADIM: PROJE VE VARLIK KONTROLÃœ
  let projectScore = 0;
  let assetScore = 0;

  if (selectedCompany) {
      // En az 1 proje varsa +20 Puan
      if (selectedCompany.projects && selectedCompany.projects.length > 0) {
          projectScore = 20;
      }
      // En az 1 varlÄ±k varsa +20 Puan
      if (selectedCompany.assets && selectedCompany.assets.length > 0) {
          assetScore = 20;
      }
  }

  // TOPLAM PUAN
  const totalPercent = formScore + projectScore + assetScore;

  // UI GÃœNCELLEME
  const bar = document.getElementById("progress-bar");
  const text = document.getElementById("status-percent");
  const msg = document.getElementById("status-text");

  if (bar) bar.style.width = `${totalPercent}%`;
  if (text) text.textContent = `${totalPercent}%`;

  // RENK VE MESAJ AYARLARI
  if (totalPercent >= 100) {
      if(msg) msg.textContent = "Excellent! Your profile is fully optimized.";
      if(bar) bar.className = "h-1.5 rounded-full transition-all duration-700 bg-emerald-500 shadow-[0_0_10px_rgba(16,185,129,0.5)]";
      if(text) text.classList.replace("text-blue-600", "text-emerald-600");
  } else if (totalPercent >= 70) {
      if(msg) msg.textContent = "Strong profile. Fill missing info to reach 100%.";
      if(bar) bar.className = "h-1.5 rounded-full transition-all duration-700 bg-blue-600";
  } else {
      if(msg) msg.textContent = "Low trust score. Add projects & assets to boost visibility.";
      if(bar) bar.className = "h-1.5 rounded-full transition-all duration-700 bg-amber-500";
      if(text) text.classList.replace("text-blue-600", "text-amber-600");
  }
}
// C. EditÃ¶r aÃ§Ä±ldÄ±ÄŸÄ±nda ve yazÄ± yazÄ±ldÄ±ÄŸÄ±nda hesaplamayÄ± tetikle
function initEditorListeners() {
  const inputs = document.querySelectorAll("#editor-form input, #editor-form select, #editor-form textarea");
  inputs.forEach(input => {
    // Her tuÅŸa basÄ±ldÄ±ÄŸÄ±nda veya seÃ§im deÄŸiÅŸtiÄŸinde hesapla
    input.addEventListener("input", calculateProfileStatus);
    input.addEventListener("change", calculateProfileStatus);
  });
  
  // Ä°lk aÃ§Ä±lÄ±ÅŸta bir kere hesapla
  calculateProfileStatus();
}
/* --- TOAST BÄ°LDÄ°RÄ°M SÄ°STEMÄ° (En alta ekleyin) --- */
function showToast(title, message, type = 'success') {
  const container = document.getElementById('toast-container');
  if (!container) return;

  const toast = document.createElement('div');
  toast.className = `toast ${type}`;
  
  const icon = type === 'success' ? 'fa-circle-check' : 'fa-circle-xmark';
  
  toast.innerHTML = `
    <i class="fa-solid ${icon}"></i>
    <div class="toast-content">
      <span class="toast-title">${title}</span>
      <span class="toast-msg">${message}</span>
    </div>
    <button onclick="this.parentElement.remove()" class="text-gray-400 hover:text-gray-600">
      <i class="fa-solid fa-xmark text-sm"></i>
    </button>
  `;

  container.appendChild(toast);

  // 4 saniye sonra sil
  setTimeout(() => {
    toast.style.animation = 'fadeOut 0.3s ease-out forwards';
    setTimeout(() => toast.remove(), 300);
  }, 4000);
}
/* --- SÄ°LME ONAY SÄ°STEMÄ° --- */
let pendingDeleteAction = null; // Silme fonksiyonunu burada tutacaÄŸÄ±z

function openDeleteModal(message, actionCallback) {
  const modal = document.getElementById("delete-modal");
  const msgEl = document.getElementById("delete-modal-msg");
  const btn = document.getElementById("btn-confirm-delete");

  if (!modal) return;

  // MesajÄ± ayarla
  if(msgEl) msgEl.textContent = message;

  // YapÄ±lacak iÅŸlemi hafÄ±zaya al
  pendingDeleteAction = actionCallback;

  // Butona tÄ±klanÄ±nca iÅŸlemi Ã§alÄ±ÅŸtÄ±r
  btn.onclick = () => {
    if (pendingDeleteAction) pendingDeleteAction();
    closeDeleteModal();
  };

  // ModalÄ± gÃ¶ster
  modal.classList.remove("pointer-events-none", "opacity-0");
  document.getElementById("delete-modal-content").classList.remove("scale-95");
  document.getElementById("delete-modal-content").classList.add("scale-100");
}

function closeDeleteModal() {
  const modal = document.getElementById("delete-modal");
  if (modal) modal.classList.add("pointer-events-none", "opacity-0");
  
  // Efekt sÄ±fÄ±rlama
  const content = document.getElementById("delete-modal-content");
  if(content) {
      content.classList.remove("scale-100");
      content.classList.add("scale-95");
  }
  
  pendingDeleteAction = null;
}
/* --- PREMIUM INBOX ENGINE (EN ALTA EKLE) --- */

// Demo Veriler (GerÃ§ek hayatta Supabase'den gelir)
const inboxData = [
  {
    id: 101,
    company: "RÃ¶nesans Holding",
    type: "quote", // quote, system, alert
    title: "Project RFQ: Steel Structure",
    desc: "Requesting quotation for 500 tons of structural steel for Izmir project.",
    time: "12 mins ago",
    unread: true,
    logo: "R"
  },
  {
    id: 102,
    company: "System",
    type: "system",
    title: "Profile Verified",
    desc: "Your company documents have been approved. Trust Score updated.",
    time: "2 hours ago",
    unread: true,
    logo: "S"
  },
  {
    id: 103,
    company: "Tekfen Construction",
    type: "quote",
    title: "Equipment Rental Inquiry",
    desc: "Looking for 3x CAT 336 Excavators for 6 months lease.",
    time: "Yesterday",
    unread: false,
    logo: "T"
  }
];

function toggleInbox() {
  const panel = document.getElementById("inbox-panel");
  const overlay = document.getElementById("inbox-overlay");
  
  if (!panel || !overlay) return;

  const isOpen = panel.classList.contains("open");

  if (isOpen) {
    // Kapat
    panel.classList.remove("open");
    overlay.classList.remove("opacity-100");
    overlay.classList.add("opacity-0");
    setTimeout(() => overlay.classList.add("hidden"), 300);
  } else {
    // AÃ§
    renderInboxItems(); // Verileri tazeleyerek aÃ§
    overlay.classList.remove("hidden");
    // Animasyon iÃ§in minik gecikme
    setTimeout(() => {
        overlay.classList.remove("opacity-0");
        overlay.classList.add("opacity-100");
        panel.classList.add("open");
    }, 10);
  }
}

function renderInboxItems() {
  const container = document.getElementById("inbox-content");
  const badgeNav = document.getElementById("nav-badge");
  const badgeHeader = document.getElementById("inbox-badge-count");
  
  if (!container) return;
  container.innerHTML = "";

  let unreadCount = 0;

  inboxData.forEach(item => {
    if(item.unread) unreadCount++;

    // Kart Elementi OluÅŸtur
    const card = document.createElement("div");
    
    // TasarÄ±m SÄ±nÄ±flarÄ±
    card.className = `inbox-item p-4 mb-1 cursor-pointer group ${item.unread ? 'unread' : 'bg-white/60 opacity-80'}`;
    
    // --- KRÄ°TÄ°K DEÄžÄ°ÅžÄ°KLÄ°K: TIKLAMA Ã–ZELLÄ°ÄžÄ° TÃœM KARTA VERÄ°LDÄ° ---
    card.onclick = () => openMessage(item.id); 
    // -----------------------------------------------------------
    
    // Ä°kon Rengi (Type'a gÃ¶re)
    let iconBg = "bg-gray-100 text-gray-500";
    let icon = "fa-building";
    
    if(item.type === 'quote') { iconBg = "bg-cyan-50 text-BTrustOn-accent"; icon = "fa-file-invoice-dollar"; }
    if(item.type === 'system') { iconBg = "bg-emerald-50 text-emerald-600"; icon = "fa-shield-halved"; }
    if(item.type === 'alert') { iconBg = "bg-amber-50 text-amber-600"; icon = "fa-triangle-exclamation"; }

    card.innerHTML = `
      <div class="flex gap-4 pointer-events-none"> <div class="w-10 h-10 rounded-xl ${iconBg} flex items-center justify-center shrink-0 shadow-sm group-hover:scale-110 transition-transform duration-300">
           <i class="fa-solid ${icon}"></i>
        </div>

        <div class="flex-1">
           <div class="flex justify-between items-start mb-1">
              <h4 class="text-xs font-bold text-BTrustOn-primary leading-tight">${item.title}</h4>
              <span class="text-[10px] text-gray-400 whitespace-nowrap ml-2">${item.time}</span>
           </div>
           
           <p class="text-xs text-gray-500 leading-relaxed mb-2 line-clamp-2">${item.desc}</p>
           
           <div class="flex items-center justify-between">
              <span class="text-[10px] font-bold text-gray-400 bg-gray-100 px-1.5 py-0.5 rounded uppercase tracking-wide">
                 ${item.company}
              </span>
              
              <div class="opacity-0 group-hover:opacity-100 transition-opacity flex gap-2">
                 <button class="text-BTrustOn-accent hover:text-BTrustOn-darkAccent text-[10px] font-bold flex items-center gap-1">
                    VIEW <i class="fa-solid fa-arrow-right"></i>
                 </button>
              </div>
           </div>
        </div>
      </div>
    `;
    
    container.appendChild(card);
  });

  // Badge GÃ¼ncelleme
  if(badgeNav) {
      if(unreadCount > 0) {
          badgeNav.textContent = unreadCount;
          badgeNav.classList.remove("hidden");
      } else {
          badgeNav.classList.add("hidden");
      }
  }
  
  if(badgeHeader) {
      if(unreadCount > 0) {
        badgeHeader.textContent = `${unreadCount} NEW`;
        badgeHeader.classList.remove("hidden");
      } else {
        badgeHeader.classList.add("hidden");
      }
  }
}
// Sayfa aÃ§Ä±lÄ±nca badge'i kontrol et
document.addEventListener("DOMContentLoaded", () => {
    // Hafif bir gecikmeyle Ã§alÄ±ÅŸtÄ±r ki diÄŸer yÃ¼klemeler bitsin
    setTimeout(renderInboxItems, 800);
});
/* --- MESSAGE READER LOGIC (YENÄ° EKLENECEK KISIM) --- */

function openMessage(msgId) {
    // 1. MesajÄ± veriden bul
    const msg = inboxData.find(m => m.id === msgId);
    if (!msg) return;

    // 2. HTML elemanlarÄ±nÄ± doldur
    document.getElementById("msg-subject").textContent = msg.title;
    document.getElementById("msg-company").textContent = msg.company;
    document.getElementById("msg-date").textContent = msg.time; 
    document.getElementById("msg-body").textContent = msg.desc + " We are looking forward to your prompt response regarding this matter. Please include your best offer and delivery timeline."; 
    document.getElementById("msg-id").textContent = msg.id;
    document.getElementById("msg-logo").textContent = msg.logo || msg.company.charAt(0);

    // Badge Rengi Ayarla
    const badge = document.getElementById("msg-type-badge");
    if(badge) {
        if(msg.type === 'quote') {
            badge.className = "px-3 py-1 rounded-full text-xs font-bold bg-cyan-50 text-BTrustOn-accent border border-cyan-100 uppercase tracking-wide";
            badge.textContent = "QUOTE REQUEST";
        } else if (msg.type === 'system') {
            badge.className = "px-3 py-1 rounded-full text-xs font-bold bg-emerald-50 text-emerald-600 border border-emerald-100 uppercase tracking-wide";
            badge.textContent = "SYSTEM NOTIFICATION";
        }
    }

    // 3. Okundu olarak iÅŸaretle
    msg.unread = false;
    renderInboxItems(); // Listeyi gÃ¼ncelle

    // 4. EkranÄ± AÃ§
    const viewer = document.getElementById("view-message");
    if(viewer) viewer.classList.remove("hidden-view");
    
    // Arkadaki scroll'u kilitle
    document.body.style.overflow = "hidden"; 

    // Inbox panelini kapat
    const panel = document.getElementById("inbox-panel");
    const overlay = document.getElementById("inbox-overlay");
    if(panel) panel.classList.remove("open");
    if(overlay) overlay.classList.add("hidden");
}

function closeMessageView() {
    const viewer = document.getElementById("view-message");
    if(viewer) viewer.classList.add("hidden-view");
    document.body.style.overflow = "auto"; // Scroll'u aÃ§
}

/* --- GERÃ‡EK MESAJLAÅžMA SÄ°STEMÄ° (Supabase Entegreli) --- */

let currentMessageContext = null; // Hangi mesajÄ± cevaplÄ±yoruz?

// 1. MESAJI AÃ‡MA FONKSÄ°YONU
function openMessage(msgId) {
    const msg = inboxData.find(m => m.id === msgId);
    if (!msg) return;

    // --- CONTEXT KAYDETME ---
    currentMessageContext = {
        original_msg_id: msg.id,
        target_company_name: msg.company,
        // Demo ortamÄ±nda olduÄŸumuz iÃ§in 'fake' bir ID atÄ±yoruz. 
        // GerÃ§ek sistemde burasÄ± msg.sender_id (UUID) olmalÄ±.
        target_user_id: msg.sender_id || "demo-receiver-id" 
    };

    // HTML Doldur
    document.getElementById("msg-subject").textContent = msg.title;
    document.getElementById("msg-company").textContent = msg.company;
    document.getElementById("msg-date").textContent = msg.time; 
    document.getElementById("msg-body").textContent = msg.desc + "\n\n(System: Waiting for your reply...)"; 
    document.getElementById("msg-id").textContent = msg.id;
    document.getElementById("msg-logo").textContent = msg.logo || msg.company.charAt(0);

    // Badge Ayarla
    const badge = document.getElementById("msg-type-badge");
    if(badge) {
        if(msg.type === 'quote') {
            badge.className = "px-3 py-1 rounded-full text-xs font-bold bg-cyan-50 text-BTrustOn-accent border border-cyan-100 uppercase tracking-wide";
            badge.textContent = "QUOTE REQUEST";
        } else {
            badge.className = "px-3 py-1 rounded-full text-xs font-bold bg-gray-100 text-gray-500 border border-gray-200 uppercase tracking-wide";
            badge.textContent = "MESSAGE";
        }
    }

    // Okundu yap
    msg.unread = false;
    renderInboxItems(); 

    // EkranÄ± AÃ§
    const viewer = document.getElementById("view-message");
    if(viewer) viewer.classList.remove("hidden-view");
    document.body.style.overflow = "hidden"; 

    // Inbox panelini kapat
    const panel = document.getElementById("inbox-panel");
    const overlay = document.getElementById("inbox-overlay");
    if(panel) panel.classList.remove("open");
    if(overlay) overlay.classList.add("hidden");
}

// 2. MESAJI KAPATMA
function closeMessageView() {
    const viewer = document.getElementById("view-message");
    if(viewer) viewer.classList.add("hidden-view");
    document.body.style.overflow = "auto";
}

// 3. CEVAP GÃ–NDERME (VeritabanÄ±na Yazar)
// GÃœNCELLENMÄ°Åž sendReply (Dosya Destekli)
async function sendReply() {
    const inputEl = document.getElementById("reply-input");
    const content = inputEl.value.trim();
    const btn = document.querySelector("button[onclick='sendReply()']");

    // Kontrol: Hem mesaj hem dosya yoksa hata ver
    if (!content && !currentAttachmentFile) {
        showToast("Error", "Please write a message or attach a file.", "error");
        return;
    }
    if (!currentMessageContext) {
        showToast("Error", "Context lost. Reopen message.", "error");
        return;
    }

    // Butonu Kilitle
    const originalText = btn.innerHTML;
    btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Sending...';
    btn.disabled = true;

    try {
        const { data: { user } } = await supabaseClient.auth.getUser();
        if (!user) throw new Error("Login required.");

        // --- DOSYA VARSA BÄ°LGÄ° NOTU EKLE ---
        let finalContent = content;
        if (currentAttachmentFile) {
            finalContent += `\n\n[ðŸ“Ž ATTACHMENT: ${currentAttachmentFile.name}]`;
        }
        // -----------------------------------

        if (currentMessageContext.target_user_id === "demo-receiver-id") {
            // Demo SimÃ¼lasyon
            await new Promise(r => setTimeout(r, 1500));
            showToast("Sent", "Reply sent with attachment (Demo)", "success");
        } else {
            // GerÃ§ek GÃ¶nderim
            const { error } = await supabaseClient
                .from('messages')
                .insert([{
                    sender_id: user.id,
                    receiver_id: currentMessageContext.target_user_id,
                    content: finalContent,
                    subject: "Re: " + document.getElementById("msg-subject").textContent,
                    is_read: false
                }]);

            if (error) throw error;
            showToast("Sent", "Message sent successfully!", "success");
        }

        // Temizlik
        inputEl.value = "";
        removeAttachment(); // DosyayÄ± temizle (Yeni eklenen fonksiyonu Ã§aÄŸÄ±rÄ±yoruz)
        closeMessageView();

    } catch (error) {
        showToast("Error", error.message, "error");
    } finally {
        btn.innerHTML = originalText;
        btn.disabled = false;
    }
}
/* --- MESAJ AKSÄ°YONLARI (SÄ°LME & OKUNMADI YAPMA) --- */

// 1. MEVCUT MESAJI SÄ°L
function deleteCurrentMessage() {
    // AÃ§Ä±k olan bir mesaj var mÄ± kontrol et
    if (!currentMessageContext || !currentMessageContext.original_msg_id) return;

    if (!confirm("Are you sure you want to delete this conversation?")) return;

    // Listeden bul ve sil
    const index = inboxData.findIndex(m => m.id === currentMessageContext.original_msg_id);
    if (index > -1) {
        inboxData.splice(index, 1); // Diziden Ã§Ä±kar
    }

    // EkranÄ± gÃ¼ncelle ve kapat
    renderInboxItems(); // Listeyi yenile (silinen gitsin)
    closeMessageView(); // Okuma ekranÄ±nÄ± kapat
    
    // Bildirim ver
    showToast("Deleted", "Conversation moved to trash.", "success");
}

// 2. OKUNMADI OLARAK Ä°ÅžARETLE
function markAsUnreadCurrentMessage() {
    if (!currentMessageContext || !currentMessageContext.original_msg_id) return;

    // MesajÄ± bul
    const msg = inboxData.find(m => m.id === currentMessageContext.original_msg_id);
    
    if (msg) {
        msg.unread = true; // Durumu deÄŸiÅŸtir
    }

    // EkranÄ± gÃ¼ncelle ve kapat
    renderInboxItems(); // Listeyi yenile (KÄ±rmÄ±zÄ± nokta/badge geri gelsin)
    closeMessageView(); // Okuma ekranÄ±nÄ± kapat
    
    // Bildirim ver
    showToast("Marked Unread", "Conversation marked as unread.", "success");
}
/* --- DOSYA EKLEME YÃ–NETÄ°MÄ° --- */

let currentAttachmentFile = null; // SeÃ§ilen dosyayÄ± hafÄ±zada tut

// 1. DOSYA SEÃ‡Ä°LÄ°NCE Ã‡ALIÅžIR
function handleFileSelect(input) {
    if (input.files && input.files[0]) {
        currentAttachmentFile = input.files[0];
        
        // Ã–nizleme alanÄ±nÄ± doldur
        const preview = document.getElementById("attachment-preview");
        const nameEl = document.getElementById("attachment-name");
        const sizeEl = document.getElementById("attachment-size");
        
        if (preview && nameEl) {
            nameEl.textContent = currentAttachmentFile.name;
            // Boyutu hesapla (KB veya MB)
            let size = currentAttachmentFile.size / 1024;
            let label = " KB";
            if(size > 1024) { size = size / 1024; label = " MB"; }
            
            if(sizeEl) sizeEl.textContent = size.toFixed(1) + label;

            // Kutuyu gÃ¶ster
            preview.classList.remove("hidden");
        }
    }
}

// 2. DOSYAYI KALDIR (X Butonu)
function removeAttachment() {
    currentAttachmentFile = null;
    document.getElementById("reply-file-input").value = ""; // Inputu sÄ±fÄ±rla
    
    // Kutuyu gizle
    const preview = document.getElementById("attachment-preview");
    if (preview) preview.classList.add("hidden");
}
let selectedLogoFile = null; // SeÃ§ilen dosyayÄ± tutar

function handleLogoSelect(input) {
  if (input.files && input.files[0]) {
    selectedLogoFile = input.files[0];
    
    // TarayÄ±cÄ±da Ã¶nizleme yap (Server'a gitmeden)
    const reader = new FileReader();
    reader.onload = function(e) {
      document.getElementById("edit-logo-img").src = e.target.result;
      document.getElementById("edit-logo-img").classList.remove("hidden");
      document.getElementById("edit-logo-icon").classList.add("hidden");
    }
    reader.readAsDataURL(selectedLogoFile);
  }
}
/* --- PROFÄ°L EKRANINDAN HIZLI LOGO DEÄžÄ°ÅžTÄ°RME --- */

async function uploadLogoDirectly(input) {
  if (!input.files || !input.files[0]) return;

  const file = input.files[0];
  
  // 1. KullanÄ±cÄ±ya hemen Ã¶nizleme gÃ¶ster (Bekletme)
  const reader = new FileReader();
  reader.onload = function(e) {
      const img = document.getElementById("p-logo-image");
      const icon = document.getElementById("p-default-icon");
      if(img) { img.src = e.target.result; img.classList.remove("hidden"); }
      if(icon) icon.classList.add("hidden");
  }
  reader.readAsDataURL(file);

  // 2. YÃ¼kleme Ä°ÅŸlemi BaÅŸlasÄ±n
  showToast("Uploading...", "Updating your logo...", "info");

  try {
      const { data: { user } } = await supabaseClient.auth.getUser();
      if (!user) throw new Error("Login required");

      const fileExt = file.name.split('.').pop();
      const fileName = `${user.id}-${Date.now()}.${fileExt}`;
      const filePath = `${fileName}`;

      // A. Storage'a YÃ¼kle
      const { error: uploadError } = await supabaseClient.storage
          .from('logos')
          .upload(filePath, file);

      if (uploadError) throw uploadError;

      // B. Public URL Al
      const { data: { publicUrl } } = supabaseClient.storage
          .from('logos')
          .getPublicUrl(filePath);

      // C. Sadece Profil Tablosundaki 'logo_url' alanÄ±nÄ± gÃ¼ncelle
      const { error: dbError } = await supabaseClient
          .from('profiles')
          .update({ logo_url: publicUrl, updated_at: new Date() })
          .eq('id', user.id);

      if (dbError) throw dbError;

      // D. BaÅŸarÄ±lÄ±
      showToast("Success", "Logo updated successfully!", "success");

      // E. Local Database'i GÃ¼ncelle (Sayfa yenilenmeden hafÄ±zada kalsÄ±n)
      const localCompany = database.find(c => c.id == user.id);
      if (localCompany) {
          localCompany.logo_url = publicUrl;
      }

  } catch (error) {
      console.error(error);
      showToast("Error", "Logo upload failed: " + error.message, "error");
      // Hata olursa eski haline dÃ¶ndÃ¼rmek iÃ§in sayfayÄ± yenileyebilir veya eski URL'i geri yÃ¼kleyebiliriz
  }
}
/* --- SERTÄ°FÄ°KA YÃ–NETÄ°MÄ° (EKLE - DÃœZENLE - SÄ°L) --- */

let currentEditingCertId = null;

// 1. MODALI AÃ‡
function openCertModal(certId = null) {
  const modal = document.getElementById("cert-modal");
  const form = document.getElementById("cert-form");
  const title = document.getElementById("cert-modal-title");
  
  if (!modal) return;
  modal.classList.remove("pointer-events-none", "opacity-0");
  
  if(form) form.reset();
  
  // EÄŸer certId -1 ise (string veri dÃ¼zenlenmeye Ã§alÄ±ÅŸÄ±lÄ±yorsa) veya yeni ekleme ise
  if (certId && certId !== -1) {
    // --- DÃœZENLEME MODU (Sadece Obje veriler iÃ§in) ---
    currentEditingCertId = certId;
    if(title) title.textContent = "Edit Certificate";
    
    // Veriyi bul
    const cert = selectedCompany.certificates.find(c => c.id === certId);
    if (cert) {
        document.getElementById("cert-name").value = cert.name || "";
        document.getElementById("cert-issuer").value = cert.issuer || "";
    }
  } else {
    // --- EKLEME MODU ---
    currentEditingCertId = null;
    if(title) title.textContent = "Add New Certificate";
  }
}

function closeCertModal() {
  const modal = document.getElementById("cert-modal");
  if (modal) modal.classList.add("pointer-events-none", "opacity-0");
  currentEditingCertId = null;
}

// 2. KAYDET (Supabase)
async function saveCert() {
  const btn = document.querySelector("#cert-form button[type='submit']");
  const originalText = btn.textContent;
  btn.textContent = "Saving...";
  btn.disabled = true;

  try {
    const name = document.getElementById("cert-name").value.trim();
    const issuer = document.getElementById("cert-issuer").value.trim();

    if (!name) { showToast("Missing Info", "Certificate name is required.", "error"); return; }

    // Mevcut sertifikalarÄ± al (EÄŸer string array ise objeye Ã§evirmemiz gerekebilir ama ÅŸimdilik karÄ±ÅŸÄ±k destekleyelim)
    let currentCerts = [...(selectedCompany.certificates || [])];

    if (currentEditingCertId) {
        // DÃ¼zenleme
        const index = currentCerts.findIndex(c => c.id === currentEditingCertId);
        if (index > -1) {
            currentCerts[index] = { ...currentCerts[index], name: name, issuer: issuer };
        }
    } else {
        // Yeni Ekleme
        // Eski string verileri bozmamak iÃ§in yeni veriyi obje olarak ekliyoruz
        const newCert = { 
            id: Date.now(), 
            name: name, 
            issuer: issuer 
        };
        currentCerts.push(newCert);
    }

    const { data: { user } } = await supabaseClient.auth.getUser();
    if (!user) throw new Error("Session expired.");

    // Supabase Update
    const { error } = await supabaseClient
      .from('profiles')
      .update({ certificates: currentCerts, updated_at: new Date() })
      .eq('id', user.id);

    if (error) throw error;

    // Local Update
    selectedCompany.certificates = currentCerts;
    const localRef = database.find(c => c.id == user.id);
    if(localRef) localRef.certificates = currentCerts;

    openProfile(user.id);
    switchProfileTab('certs');
    closeCertModal();
    showToast("Success", "Certificate saved successfully.", "success");

  } catch (error) {
    showToast("Error", error.message, "error");
  } finally {
    btn.textContent = originalText;
    btn.disabled = false;
  }
}

// 3. SÄ°LME
// 3. SÄ°LME (CERTIFICATE) - YENÄ° MODAL Ä°LE
function deleteCert(certId, certName) {
    // TarayÄ±cÄ± confirm'i yerine kendi modalÄ±mÄ±zÄ± Ã§aÄŸÄ±rÄ±yoruz
    openDeleteModal(`Are you sure you want to delete "${certName}"?`, async () => {
        
        // --- ASIL SÄ°LME Ä°ÅžLEMÄ° BURADA BAÅžLIYOR ---
        try {
            let currentCerts = [];
            
            if (certId === -1) {
                currentCerts = selectedCompany.certificates.filter(c => c !== certName);
            } else {
                currentCerts = selectedCompany.certificates.filter(c => c.id !== certId);
            }

            const { data: { user } } = await supabaseClient.auth.getUser();
            
            const { error } = await supabaseClient
                .from('profiles')
                .update({ certificates: currentCerts, updated_at: new Date() })
                .eq('id', user.id);

            if (error) throw error;

            selectedCompany.certificates = currentCerts;
            const localRef = database.find(c => c.id == user.id);
            if(localRef) localRef.certificates = currentCerts;

            openProfile(user.id);
            showToast("Deleted", "Certificate removed successfully.", "success");
            
        } catch (error) {
            showToast("Error", "Delete failed: " + error.message, "error");
        }
    });
}
// --- VERÄ°TABANINDAN GÃœNCEL VERÄ°LERÄ° Ã‡EKME ---
async function initRealData() {
  console.log("Supabase'den veriler Ã§ekiliyor...");
  
  // 1. Supabase'den tÃ¼m profilleri al
  const { data: profiles, error } = await supabaseClient
    .from('profiles')
    .select('*');

  if (error) { console.error("Veri Ã§ekme hatasÄ±:", error); return; }
  if (!profiles) return;

  // 2. Verileri formatla
  profiles.forEach(p => {
    const pId = p.id;
    const realData = {
      id: pId,
      name: p.company_name || "New Company",
      city: p.city || "Konum Yok",
      sector: p.sector || "construction",
      desc: p.description || "",
      tagline: p.tagline || "",
      type_label: p.company_type, // Type verisi
      size_label: p.company_size,
      year_label: p.founded_year,
      services: p.services ? p.services.split(',').map(s=>s.trim()) : [],
      logo_url: p.logo_url,
      website: p.website,
      phone: p.phone,
      contact_email: p.contact_email,
      certificates: p.certificates || [],
      projects: p.projects || [],
      assets: p.assets || [],
      trust: "verified",
      meta: { references: 80, delivery: 85, years: 5, financial: 80, digital: 70 }
    };

    const existingIndex = database.findIndex(c => c.id == pId);
    if (existingIndex > -1) {
      database[existingIndex] = { ...database[existingIndex], ...realData };
    } else {
      database.unshift(realData);
    }
  });

  // 4. EkranÄ± Yenile (DÃœZELTME: renderCards kaldÄ±rÄ±ldÄ±)
  populateCountryFilter();
  
  if (typeof isSearchActive !== 'undefined' && !isSearchActive) {
      renderShowcase(); // Rozetleri hemen gÃ¶sterir
  }
  
  renderTopCompanies();

  // AÃ§Ä±k profil varsa gÃ¼ncelle
  if (selectedCompany) {
      const updatedCompany = database.find(c => c.id === selectedCompany.id);
      if(updatedCompany) {
          selectedCompany = updatedCompany;
          openProfile(selectedCompany.id);
      }
  }
}
// TÃœMÃœNÃœ OKUNDU OLARAK Ä°ÅžARETLE
function markAllInboxRead() {
  // OkunmamÄ±ÅŸ mesaj var mÄ± kontrol et
  const unreadExists = inboxData.some(item => item.unread === true);

  if (!unreadExists) {
    showToast("Info", "All messages are already read.", "info");
    return;
  }

  // Hepsini okundu yap
  inboxData.forEach(item => {
    item.unread = false;
  });

  // ArayÃ¼zÃ¼ gÃ¼ncelle (KÄ±rmÄ±zÄ± noktalarÄ± kaldÄ±r)
  renderInboxItems();
  
  showToast("Success", "All messages marked as read.", "success");
}
/* --- AKILLI VÄ°TRÄ°N VE ARAMA SÄ°STEMÄ° --- */

    let showcaseInterval = null; // 5 saniyelik zamanlayÄ±cÄ±
    let isSearchActive = false;  // Arama modunda mÄ±yÄ±z?

    // 1. ANA RENDER FONKSÄ°YONU (KartlarÄ± Ã‡izer)
    // Bu fonksiyon sadece "Verilen Listeyi Ekrana Basmakla" gÃ¶revlidir.
    // 1. ANA RENDER FONKSÄ°YONU (KartlarÄ± Ã‡izer) - DÃœZELTÄ°LMÄ°Åž VERSÄ°YON
    // 1. ANA RENDER FONKSÄ°YONU (GÃœNCELLENMÄ°Åž - TÄ°P ROZETLÄ°)
    function drawCardsToScreen(companyList, mode = "showcase") {
        const container = document.getElementById("card-container");
        const resultCount = document.getElementById("result-count");
        
        if (!container) return;
        container.innerHTML = "";

        // BaÅŸlÄ±k ve SayÄ± GÃ¼ncelleme
        if (resultCount) {
            if (mode === "search") {
                resultCount.innerHTML = `
                    <span class="text-sm text-gray-500 font-normal">Search Results:</span> 
                    <span class="text-BTrustOn-accent">${companyList.length}</span> 
                    <span class="text-sm text-gray-500 font-normal">companies found</span>`;
            } else {
                resultCount.innerHTML = `
                    <span class="text-sm text-gray-500 font-normal">Live Showcase:</span> 
                    <span class="text-emerald-600 animate-pulse">Active</span> 
                    <span class="text-[10px] text-gray-400 ml-2">(Refreshing every 5s)</span>`;
            }
        }

        if (companyList.length === 0) {
            container.innerHTML = `
                <div class="col-span-full text-center py-12">
                    <p class="text-gray-500">No companies found matching your criteria.</p>
                </div>`;
            return;
        }

        companyList.forEach((company) => {
            const score = computeScore(company.meta);
            const desc = currentLang === "tr" && company.desc_tr ? company.desc_tr : company.desc;
            const services = currentLang === "tr" && company.services_tr ? company.services_tr : company.services;
            
            // VeritabanÄ±ndaki "type" veya "type_label" alanÄ±nÄ± kullanÄ±yoruz
            const compType = company.type_label || company.type || "Company";

            const card = document.createElement("div");
            card.className = "bg-white/90 border border-gray-100 rounded-2xl p-5 shadow-glass flex flex-col h-full hover:border-BTrustOn-accent hover:shadow-lg hover:-translate-y-1 transition cursor-pointer fade-in";
            
            card.onclick = () => openProfile(company.id);

            card.innerHTML = `
              <div class="flex-1 flex flex-col gap-3"> 
                  <div class="flex items-start justify-between gap-2">
                    <div class="flex-1 min-w-0"> <h3 class="text-sm font-bold text-BTrustOn-primary mb-1.5 truncate pr-2">
                        ${company.name}
                      </h3>
                      
                      <div class="flex flex-wrap items-center gap-2 mb-1">
                        ${getCompanyTypeBadge(compType)}
                        <span class="text-[10px] text-gray-400 flex items-center gap-1 shrink-0">
                           <span class="w-1 h-1 rounded-full bg-gray-300"></span> 
                           ${company.city}
                        </span>
                      </div>

                    </div>
                    <div class="text-right shrink-0 pl-2">
                      <div class="text-xs font-header font-bold text-BTrustOn-primary leading-none">
                        ${score}<span class="text-[10px] text-gray-400">/100</span>
                      </div>
                      <div class="text-[10px] text-emerald-500 font-semibold mt-0.5">
                        ${getScoreLabel(score)}
                      </div>
                    </div>
                  </div>

                  <p class="text-xs text-gray-600 line-clamp-3 leading-relaxed">
                    ${desc}
                  </p>

                  <div class="flex flex-wrap gap-1.5">
                    ${(services || []).slice(0, 3).map(s => `
                      <span class="text-[10px] px-2 py-1 rounded-full bg-slate-50 border border-slate-200 text-slate-600">${s}</span>
                    `).join("")}
                  </div>
              </div>

              <div class="flex items-center justify-between mt-auto pt-4 border-t border-slate-100">
                <div class="flex items-center gap-2">
                  ${getTrustBadge(company)}
                </div>
                <button class="text-[11px] font-bold text-BTrustOn-accent flex items-center gap-1 group">
                  <span>${t("btn_view")}</span> <i class="fa-solid fa-arrow-right text-[10px] group-hover:translate-x-1 transition-transform"></i>
                </button>
              </div>
            `;
            container.appendChild(card);
        });
    }

    // 2. VÄ°TRÄ°N MODU (Rastgele 12 Åžirket)
    function renderShowcase() {
        // EÄŸer arama yapÄ±lÄ±yorsa vitrin Ã§alÄ±ÅŸmasÄ±n
        if (isSearchActive) return;

        // VeritabanÄ±nÄ± karÄ±ÅŸtÄ±r
        const shuffled = [...database].sort(() => Math.random() - 0.5);
        
        // Ä°lk 12 tanesini al
        const showcaseList = shuffled.slice(0, 12);
        
        drawCardsToScreen(showcaseList, "showcase");
    }

    // 3. ARAMA MODU (Filtreli Liste)
    // 3. ARAMA VE LÄ°STELEME MODU (GÃœNCELLENMÄ°Åž)
    function renderSearchResults(query) {
        const q = (query || "").toLowerCase().trim();

        // A. FÄ°LTRELEME
        let filtered = database.filter((company) => {
            // 1. SektÃ¶r Filtresi
            if (currentSector !== "all" && company.sector !== currentSector) return false;
            
            // 2. Ãœlke Filtresi (YENÄ°)
            if (currentCountryFilter !== "all") {
                const companyCountry = getCountryFromCity(company.city);
                if (companyCountry !== currentCountryFilter) return false;
            }

            // 3. Metin AramasÄ±
            if (!q) return true; // Metin yoksa geÃ§

            const desc = currentLang === "tr" && company.desc_tr ? company.desc_tr : company.desc;
            const services = currentLang === "tr" && company.services_tr ? company.services_tr : company.services;
            
            const haystack = [
                company.name, company.city, company.sector, desc, ...(services || [])
            ].join(" ").toLowerCase();

            return haystack.includes(q);
        });

        // B. SIRALAMA (YENÄ°)
        filtered = sortCompanyList(filtered);

        // C. EKRANA BASMA
        drawCardsToScreen(filtered, "search");
    }

    // 4. BAÅžLATICI VE YÃ–NETÄ°CÄ° (Controller)
    function initShowcaseSystem() {
        // Ä°lk aÃ§Ä±lÄ±ÅŸta bir kere vitrini gÃ¶ster
        renderShowcase();

        // 5 Saniyede bir deÄŸiÅŸtiren zamanlayÄ±cÄ±yÄ± baÅŸlat
        startShowcaseTimer();
    }

    function startShowcaseTimer() {
        if (showcaseInterval) clearInterval(showcaseInterval);
        
        showcaseInterval = setInterval(() => {
            // Sadece arama yapÄ±lmÄ±yorsa vitrini yenile
            if (!isSearchActive) {
                renderShowcase();
            }
        }, 5000); // 5000 ms = 5 saniye
    }

    // Arama kutusuna her basÄ±ldÄ±ÄŸÄ±nda bu Ã§alÄ±ÅŸacak
    // (Eski renderCards yerine bunu kullanacaÄŸÄ±z)
    function handleSearchInput(value) {
        const query = value.trim();

        if (query === "" && currentSector === "all") {
            // Arama kutusu boÅŸaldÄ± -> VÄ°TRÄ°N MODUNA DÃ–N
            isSearchActive = false;
            renderShowcase();
            // ZamanlayÄ±cÄ± devam etsin
        } else {
            // Bir ÅŸeyler yazÄ±ldÄ± -> ARAMA MODUNA GEÃ‡
            isSearchActive = true;
            // Otomatik deÄŸiÅŸtirmeyi durdur (KullanÄ±cÄ± okuyabilsin diye)
            // Ä°sterseniz clearInterval yapabiliriz ama isSearchActive bayraÄŸÄ± yeterli.
            renderSearchResults(query);
        }
    }
    
    // SektÃ¶r ButonlarÄ± iÃ§in GÃ¼ncelleme
    // (Mevcut filterSector fonksiyonunuzun iÃ§inden burayÄ± Ã§aÄŸÄ±racaÄŸÄ±z)
    // AÅŸaÄŸÄ±daki fonksiyonu eskisiyle deÄŸiÅŸtirin veya entegre edin.
/* --- FÄ°LTRELEME VE SIRALAMA SÄ°STEMÄ° (ÃœLKE & SORT) --- */
    
    let currentCountryFilter = "all";
    let currentSortOption = "score_desc";

    // 1. Åžehirden Ãœlkeyi AyÄ±kla (Ã–rn: "Ankara, TR" -> "TR")
    function getCountryFromCity(cityString) {
        if (!cityString) return "";
        if (cityString.includes(",")) {
            return cityString.split(",")[1].trim(); 
        }
        return cityString.trim(); // VirgÃ¼l yoksa direkt kendisini al
    }

    // 2. Ãœlke Kutusunu Doldur
    function populateCountryFilter() {
        const countrySet = new Set();
        
        // TÃ¼m ÅŸirketleri tara ve Ã¼lkeleri bul
        database.forEach(c => {
            const country = getCountryFromCity(c.city);
            if(country && country.length < 20) { // Ã‡ok uzun hatalÄ± verileri alma
                countrySet.add(country);
            }
        });

        const select = document.getElementById("country-filter");
        if(select) {
            // Ã–nce temizle
            select.innerHTML = '<option value="all">All Countries</option>';
            
            // Alfabetik sÄ±rayla ekle
            Array.from(countrySet).sort().forEach(country => {
                const option = document.createElement("option");
                option.value = country;
                option.textContent = country;
                select.appendChild(option);
            });
        }
    }

    // 3. Ãœlke DeÄŸiÅŸince Ã‡alÄ±ÅŸÄ±r
    function handleCountryChange(countryVal) {
        currentCountryFilter = countryVal;
        
        // Vitrini durdur, arama moduna geÃ§ (Ã‡Ã¼nkÃ¼ filtreliyoruz)
        isSearchActive = true; 
        
        // Listeyi yenile
        const searchInput = document.getElementById("search-input");
        const query = searchInput ? searchInput.value.trim() : "";
        renderSearchResults(query);
    }

    // 4. SÄ±ralama DeÄŸiÅŸince Ã‡alÄ±ÅŸÄ±r
    function handleSortChange(sortValue) {
        currentSortOption = sortValue;
        
        // Vitrini durdur, arama moduna geÃ§ (SÄ±ralÄ± listeyi gÃ¶rmek istiyor)
        isSearchActive = true;
        
        // Listeyi yenile
        const searchInput = document.getElementById("search-input");
        const query = searchInput ? searchInput.value.trim() : "";
        renderSearchResults(query);
    }

    // 5. Listeyi SÄ±ralayan YardÄ±mcÄ± Fonksiyon
    function sortCompanyList(list) {
        let sorted = [...list]; // KopyasÄ±nÄ± al
        switch (currentSortOption) {
            case "score_desc": // Puan: YÃ¼ksekten DÃ¼ÅŸÃ¼ÄŸe
                sorted.sort((a, b) => computeScore(b.meta) - computeScore(a.meta));
                break;
            case "score_asc": // Puan: DÃ¼ÅŸÃ¼kten YÃ¼kseÄŸe
                sorted.sort((a, b) => computeScore(a.meta) - computeScore(b.meta));
                break;
            case "year_oldest": // YÄ±l: Eskiden Yeniye
                sorted.sort((a, b) => (parseInt(a.year_label)||2023) - (parseInt(b.year_label)||2023));
                break;
            case "year_newest": // YÄ±l: Yeniden Eskiye
                sorted.sort((a, b) => (parseInt(b.year_label)||2023) - (parseInt(a.year_label)||2023));
                break;
            case "name_asc": // Ä°sim: A-Z
                sorted.sort((a, b) => a.name.localeCompare(b.name));
                break;
        }
        return sorted;
    }
</script>
</html>